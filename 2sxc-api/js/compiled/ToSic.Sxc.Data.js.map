{"version":3,"file":"ToSic.Sxc.Data.js","sourceRoot":"","sources":["../ToSic.Sxc.Data.ts"],"names":[],"mappings":"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","sourcesContent":["import { SxcInstanceWithInternals } from \"./ToSic.Sxc.Instance\";\r\n\r\ndeclare const $: any;\r\n\r\n\r\nexport class SxcDataWithInternals {\r\n    source: any = undefined;\r\n\r\n    // in-streams\r\n    \"in\": any = {};\r\n\r\n    // will hold the default stream ([\"in\"][\"Default\"].List\r\n    List: any = [];\r\n\r\n    constructor(\r\n        private controller: SxcInstanceWithInternals,\r\n    ) {\r\n\r\n    }\r\n\r\n    // source path defaulting to current page + optional params\r\n    sourceUrl(params?: string): string {\r\n        let url = this.controller.resolveServiceUrl(\"app-sys/appcontent/GetContentBlockData\");\r\n        if (typeof params === \"string\") // text like 'id=7'\r\n            url += \"&\" + params;\r\n        return url;\r\n    }\r\n\r\n\r\n    // load data via ajax\r\n    load(source?: any) {\r\n        // if source is already the data, set it\r\n        if (source && source.List) {\r\n            // 2017-09-05 2dm: discoverd a call to an inexisting function\r\n            // since this is an old API which is being deprecated, please don't fix unless we get active feedback\r\n            // controller.data.setData(source);\r\n            return this.controller.data;\r\n        } else {\r\n            if (!source)\r\n                source = {};\r\n            if (!source.url)\r\n                source.url = this.controller.data.sourceUrl();\r\n            source.origSuccess = source.success;\r\n            source.success = (data: any) => {\r\n\r\n                for (const dataSetName in data) {\r\n                    if (data.hasOwnProperty(dataSetName))\r\n                        if (data[dataSetName].List !== null) {\r\n                            this.controller.data.in[dataSetName] = data[dataSetName];\r\n                            this.controller.data.in[dataSetName].name = dataSetName;\r\n                        }\r\n                }\r\n\r\n                if (this.controller.data.in.Default)\r\n                    // 2017-09-05 2dm: previously wrote it to controller.List, but this is almost certainly a mistake\r\n                    // since it's an old API which is being deprecated, we won't fix it\r\n                    this.List = this.in.Default.List;\r\n\r\n                if (source.origSuccess)\r\n                    source.origSuccess(this);\r\n\r\n                this.controller.isLoaded = true;\r\n                this.controller.lastRefresh = new Date();\r\n                (this as any)._triggerLoaded();\r\n            };\r\n            source.error = (request: any) => { alert(request.statusText); };\r\n            source.preventAutoFail = true; // use our fail message\r\n            this.source = source;\r\n            return this.reload();\r\n        }\r\n    }\r\n\r\n    reload(): SxcDataWithInternals {\r\n        this.controller.webApi.get(this.source)\r\n            .then(this.source.success, this.source.error);\r\n        return this;\r\n    }\r\n\r\n    on(events: Event, callback: () => void): Promise<any> {\r\n        return $(this).bind(\"2scLoad\", callback)[0]._triggerLoaded();\r\n    }\r\n\r\n    _triggerLoaded(): Promise<any> {\r\n        return this.controller.isLoaded\r\n            ? $(this).trigger(\"2scLoad\", [this])[0]\r\n            : this;\r\n    }\r\n\r\n    one(events: Event, callback: (x: any, y: any) => void): SxcDataWithInternals {\r\n        if (!this.controller.isLoaded)\r\n            return $(this).one(\"2scLoad\", callback)[0];\r\n        callback({}, this);\r\n        return this;\r\n    }\r\n}\r\n"]}
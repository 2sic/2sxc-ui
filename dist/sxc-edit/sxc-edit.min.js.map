{"version":3,"sources":["sxc-edit.min.js"],"names":["angular","module","directive","restrict","replace","transclude","templateUrl","factory","$http","eavConfig","sxc","svcCreator","appRoot","appId","contentType","entityGuid","field","subfolder","serviceConfig","svc","url","resolveServiceUrl","folders","adamRoot","substr","indexOf","uploadUrl","targetSubfolder","usePortalRoot","addFullPath","value","key","fullPath","Path","toLowerCase","extend","implementLiveList","get","params","then","result","forEach","data","addFolder","newfolder","post","newFolder","liveListReload","goIntoFolder","childFolder","push","pathParts","split","subPath","c","length","Subfolder","goUp","pop","item","isFolder","IsFolder","id","Id","rename","newName","reload","BrowserController","$scope","adamSvc","debugState","eavAdminDialogs","fileType","twoSxcFile","file","fileName","FormData","append","newFile","browser","prototype","_cachedResult","isOpera","window","opr","addons","opera","navigator","userAgent","isFirefox","InstallTrigger","isSafari","test","HTMLElement","p","toString","safari","pushNotification","isIE","document","documentMode","isEdge","StyleMedia","isChrome","chrome","webstore","isBlink","CSS","vm","this","debug","initConfig","contentTypeName","fieldName","subFolder","showImagesOnly","folderDepth","showFolders","allowAssetsInRoot","metadataContentTypes","show","adamModeConfig","disabled","ngDisabled","enableSelect","activate","autoLoad","toggle","registerSelf","refresh","items","liveList","newConfig","configChanged","JSON","stringify","oldConfig","openUpload","dropzone","select","fileItem","updateCallback","folderName","prompt","del","ok","confirm","Name","folder","currentFolderDepth","allowCreateFolder","editMetadata","_itemDefinition","getMetadataType","openEditItems","found","Type","match","metadataType","title","MetadataId","EntityId","Title","ContentTypeName","Metadata","Key","KeyType","TargetType","metadataOfCmsObject","Prefill","EntityTitle","icon","getIconClass","allowedFileTypes","fileFilter","map","i","trim","fileEndingFilter","extension","copyPasted","event","clipData","clipboardData","type","img","getAsFile","imageFileName","processFile","$inject","app","controller","require","link","scope","elem","attrs","dropzoneCtrl","adam","controllerAs","tabId","AppInstanceId","ContentBlockId","dragClass","$timeout","$translate","postLink","element","pasteImageInDropzone","ev","header","$parent","to","options","Guid","config","urlRoot","maxFilesize","paramName","maxThumbnailFilesize","headers","ModuleId","TabId","dictDefaultMessage","addRemoveLinks","previewsContainer","clickable","eventHandlers","addedfile","$apply","uploading","drop","console","log","processing","success","response","Success","afterUpload","alert","Error","error","xhr","instant","queuecomplete","getUploadingFiles","getQueuedFiles","Dropzone","handler","on","processDropzone","processQueue","resetDropzone","removeAllFiles","hiddenFileInput","click","pasteInstance","$","children","pastableTextarea","pastableNonInputable","pastableContenteditable","Paste","createHiddenEditable","dataURLtoBlob","isFocusable","jQuery","paste","pasteContainer","pm","mountNonInputable","_container","fn","el","j","len","ref","_pastable","is","mountTextarea","mountContenteditable","dataURL","sliceSize","b64Data","byteArray","byteArrays","byteCharacters","byteNumbers","m","offset","slice","atob","Array","charCodeAt","Uint8Array","Blob","createElement","attr","css","width","height","position","left","overflow","opacity","hasTabindex","fieldset","focusableIfVisible","mapName","nodeName","parentNode","name","href","closest","_target","addClass","_this","_i","k","l","len1","len2","pastedFilename","ref1","ref2","ref3","ref4","stringIsFilename","text","originalEvent","_paste_event_fired","pastedTypes","clipboardImageAsFile","trigger","preventDefault","getAsString","string","isFilename","call","types","getData","setTimeout","files","_checkImagesInContainer","src","nonInputable","appendTo","target","focus","removeClass","textarea","ctlDown","DataTransfer","Object","getOwnPropertyDescriptor","insertBefore","keyCode","ctrlKey","metaKey","_textarea_focus_stolen","content","curEnd","curStart","prop","val","setSelectionRange","contenteditable","cb","timespan","Math","floor","random","find","remove","$uibModal","promiseToastr","open","oldValue","callback","connector","valueChanged","dialogType","modalInstance","close","CurrentValue","resolve","bridge","windowClass","getUrlOfId","idCode","entityId","linkLowered","encodeURIComponent","portalRoot","webFormsBridgeUrl","$2sxc","urlParams","bridgeSyncHeight","keys","join","w","contentWindow","connectBridge","resize","body","scrollHeight","ready","formlyConfigProvider","defaultFieldWrappers","wrappers","splice","setType","wrapper","$controller","$filter","eavDefaultValueService","settings","merged","EnableRemove","AllowMultiValue","EnableAddExisting","EnableCreate","EnableEdit","EntityType","enableCollapseField","collapseField","model","Values","Value","fieldWrappersWithPreview","dnnBridgeSvc","ensureDefaultConfig","undefined","ShowAdam","Buttons","testLink","isImage","thumbnailUrl","size","quote","qt","tooltipUrl","str","$watch","newValue","promise","processResultOfPagePicker","openPageDialog","Paths","FileFilter","registerAdam","setValue","ServerResourceMapping","toggleAdam","imagesOnly","defaultFieldWrappersNoFloat","CHARS","uuid","radix","chars","r","uuidFast","rnd","uuidCompact","v","$ocLazyLoad","getIconClasses","className","charcount","foundList","duplicateDetector","ssSet","styleSheets","classes","rules","cssRules","x","selectorText","substring","txt","icnClass","rule","class","loadAdditionalResources","mapped","fileList","load","iconFilter","prefix","previewPrefix","icons","useTestValues","selectorIsOpen","setIcon","form","$setDirty","controlSettings","Files","CssPrefix","PreviewCss","templateOptions","cs","init","context","inj","$injector","appDialogConfigSvc","getDialogSettings","IsContent","formVm","formFields","SortOrder","appAssetsSvc","fieldMask","setFileConfig","typeWatcher","locWatcher","onLocationChange","templates","svcApp","svcGlobal","readyToUse","specs","Token","ext","suggestion","C# Razor","loc","svcCurrent","add","path","foundSlash","lastIndexOf","endsWith","create","filter","paths","out","initialValue","initialReadOnly","onChanged","setReadOnly","readOnly","FieldWysiwygTinyMceController","languages","tinyMceHelpers","tinyMceToolbars","tinyMceConfig","tinyMceAdam","tinyMceDnnBridge","tinyMceInitCallback","editor","tinymceOptions","language","addTranslations","addButtons","enableContentBlocksIfPossible","watchDisabled","ngscope","readonly","$broadcast","fields","index","nextField","enableContentBlocks","getDefaultOptions","setup","attachAdam","attach","lang2","currentLanguage","language_url","modeImage","adamModeImage","insertContent","addAdamButtons","e","addButton","onclick","menu","tooltip","execCommand","beta","buildModes","modes","standard","menubar","toolbar","contextmenu","advanced","cdnRoot","imgSizes","defaultLanguage","plugins","validateAlso","baseURL","inline","automatic_uploads","autosave_ask_before_unload","paste_as_text","extended_valid_elements","custom_elements","relative_urls","default_link_target","object_resizing","skin","theme","debounce","processResultOfDnnBridge","previouslySelected","selection","getContent","FileId","openDnnDialog","initLangResources","primaryLan","mceTranslations","pLen","all","getTranslationTable","translations","tinymce","addI18n","addTinyMceToolbarButtons","initOnPostRender","watchChange","formatter","formatChanged","state","self","active","registerTinyMceFormats","imgformats","selector","collapsed","styles","register","switchModes","mode","panel","renderUI","getElementById","makeImgFormatCall","apply","makeTagDetector","tagWeNeedInTheTagPath","currentElement","selectorMatched","dom","getBody","contains","linkgroup","onPostRender","linkgroupPro","copy","cmd","tag","buttons","h3","h4","h5","h6","guid","imgMenuArray","resizeimg100","addContextToolbar","run","$templateCache","put"],"mappings":"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","file":"sxc-edit.min.js","sourcesContent":["(function() { // TN: this is a helper construct, research iife or read https://github.com/johnpapa/angularjs-styleguide#iife\r\n\r\n    angular.module(\"Adam\", [\r\n        \"SxcServices\",\r\n        \"EavConfiguration\", // config\r\n        \"EavServices\", // multi-language stuff\r\n        ])\r\n        ;\r\n\r\n} ());\n(function() {\r\n    /* jshint laxbreak:true*/\r\n\r\n    angular.module(\"Adam\", [])\r\n        /*@ngInject*/\r\n        .directive(\"adamHint\", function () {\r\n            return {\r\n                restrict: \"E\",\r\n                replace: false,\r\n                transclude: false,\r\n                templateUrl: \"adam/adam-hint.html\"\r\n            };\r\n        });\r\n})();\n// note: don't prefix angular with window - something fails in production build if you do that\r\n// ReSharper disable PossiblyUnassignedProperty\r\nangular.module('Adam')\r\n    /*@ngInject*/\r\n    .factory('adamSvc', [\"$http\", \"eavConfig\", \"sxc\", \"svcCreator\", \"appRoot\", \"appId\", function ($http, eavConfig, sxc, svcCreator, appRoot, appId) {\r\n\r\n        // Construct a service for this specific appId\r\n        return function createSvc(contentType, entityGuid, field, subfolder, serviceConfig) {\r\n            var svc = {\r\n                url: sxc.resolveServiceUrl('app-content/' + contentType + '/' + entityGuid + '/' + field),\r\n                subfolder: subfolder,\r\n                folders: [],\r\n                adamRoot: appRoot.substr(0, appRoot.indexOf('2sxc'))\r\n            };\r\n\r\n            // get the correct url for uploading as it is needed by external services (dropzone)\r\n            svc.uploadUrl = function(targetSubfolder) {\r\n                var url = (targetSubfolder === '')\r\n                    ? svc.url\r\n                    : svc.url + '?subfolder=' + targetSubfolder;\r\n                url += (url.indexOf('?') === -1 ? '?' : '&')\r\n                    + 'usePortalRoot=' + serviceConfig.usePortalRoot\r\n                    + '&appId=' + appId;\r\n                return url;\r\n            };\r\n\r\n            // extend a json-response with a path (based on the adam-root) to also have a fullPath\r\n          svc.addFullPath = function(value, key) {\r\n            // 2dm 2018-03-29 special fix - sometimes the path already has the full path, sometimes not\r\n            // it should actually be resolved properly, but because I don't have time\r\n            // ATM (data comes from different web-services, which are also used in other places\r\n            // I'll just check if it's already in there\r\n            value.fullPath = value.Path;\r\n            // debugger;\r\n            if(value.Path && value.Path.toLowerCase().indexOf(svc.adamRoot.toLowerCase()) === -1)\r\n              value.fullPath = svc.adamRoot + value.Path;\r\n          };\r\n\r\n            svc = angular.extend(svc, svcCreator.implementLiveList(function getAll() {\r\n                return $http.get(svc.url + '/items',\r\n                        {\r\n                            params: {\r\n                                subfolder: svc.subfolder,\r\n                                usePortalRoot: serviceConfig.usePortalRoot,\r\n                                appId: appId\r\n                            }\r\n                        })\r\n                    .then(function(result) {\r\n                        angular.forEach(result.data, svc.addFullPath);\r\n                        return result;\r\n                    });\r\n            }));\r\n\r\n            // create folder\r\n            svc.addFolder = function (newfolder) {\r\n                return $http.post(svc.url + '/folder',\r\n                        {},\r\n                        {\r\n                            params: {\r\n                                subfolder: svc.subfolder,\r\n                                newFolder: newfolder,\r\n                                usePortalRoot: serviceConfig.usePortalRoot,\r\n                                appId: appId\r\n                            }\r\n                        })\r\n                    .then(svc.liveListReload);\r\n            };\r\n\r\n            svc.goIntoFolder = function(childFolder) {\r\n                svc.folders.push(childFolder);\r\n                var pathParts = childFolder.Path.split('/');\r\n                var subPath = '';\r\n                for (var c = 0; c < svc.folders.length; c++)\r\n                    subPath = pathParts[pathParts.length - c - 2] + '/' + subPath;\r\n\r\n                subPath = subPath.replace('//', '/');\r\n                if (subPath[subPath.length - 1] === '/')\r\n                    subPath = subPath.substr(0, subPath.length - 1);\r\n\r\n                childFolder.Subfolder = subPath;\r\n\r\n                // now assemble the correct subfolder based on the folders-array\r\n                svc.subfolder = subPath;\r\n                svc.liveListReload();\r\n                return subPath;\r\n            };\r\n\r\n            svc.goUp = function() {\r\n                if (svc.folders.length > 0)\r\n                    svc.folders.pop();\r\n                if (svc.folders.length > 0) {\r\n                    svc.subfolder = svc.folders[svc.folders.length - 1].Subfolder;\r\n                } else {\r\n                    svc.subfolder = '';\r\n                }\r\n                svc.liveListReload();\r\n                return svc.subfolder;\r\n            };\r\n\r\n            // delete, then reload\r\n            // IF verb DELETE fails, so I'm using get for now\r\n            svc.delete = function (item) {\r\n                return $http.get(svc.url + '/delete',\r\n                        {\r\n                            params: {\r\n                                subfolder: svc.subfolder,\r\n                                isFolder: item.IsFolder,\r\n                                id: item.Id,\r\n                                usePortalRoot: serviceConfig.usePortalRoot,\r\n                                appId: appId\r\n                            }\r\n                        })\r\n                    .then(svc.liveListReload);\r\n            };\r\n\r\n            // rename, then reload\r\n            svc.rename = function (item, newName) {\r\n                return $http.get(svc.url + '/rename',\r\n                        {\r\n                            params: {\r\n                                subfolder: svc.subfolder,\r\n                                isFolder: item.IsFolder,\r\n                                id: item.Id,\r\n                                usePortalRoot: serviceConfig.usePortalRoot,\r\n                                newName: newName,\r\n                                appId: appId\r\n                            }\r\n                        })\r\n                    .then(svc.liveListReload);\r\n            };\r\n            \r\n            svc.reload = svc.liveListReload;\r\n\r\n            return svc;\r\n        };\r\n    }]);\r\n// ReSharper restore PossiblyUnassignedProperty\r\n\n(function () {\r\n    /* jshint laxbreak:true */\r\n    \"use strict\";\r\n\r\n    BrowserController.$inject = [\"$scope\", \"adamSvc\", \"debugState\", \"eavConfig\", \"eavAdminDialogs\", \"appRoot\", \"fileType\"];\r\n    var app = angular.module(\"Adam\"); \r\n\r\n    // The controller for the main form directive\r\n    app.controller(\"BrowserController\", BrowserController);\r\n    \r\n    /*@ngInject*/\r\n    function BrowserController($scope, adamSvc, debugState, eavConfig, eavAdminDialogs, appRoot, fileType) {\r\n        var vm = this;\r\n        vm.debug = debugState;\r\n\r\n        var initConfig = function initConfig() {\r\n            vm.contentTypeName = $scope.contentTypeName;\r\n            vm.entityGuid = $scope.entityGuid;\r\n            vm.fieldName = $scope.fieldName;\r\n            vm.subFolder = $scope.subFolder || \"\";\r\n            vm.showImagesOnly = $scope.showImagesOnly = $scope.showImagesOnly || false;\r\n\r\n            vm.folderDepth = (typeof $scope.folderDepth !== 'undefined' && $scope.folderDepth !== null)\r\n                ? $scope.folderDepth\r\n                : 2;\r\n            vm.showFolders = !!vm.folderDepth;\r\n            vm.allowAssetsInRoot = $scope.allowAssetsInRoot || true;    // if true, the initial folder can have files, otherwise only subfolders\r\n            vm.metadataContentTypes = $scope.metadataContentTypes || \"\";\r\n        };\r\n\r\n        initConfig();\r\n        \r\n        vm.show = false;\r\n        vm.appRoot = appRoot;        \r\n        vm.adamModeConfig = $scope.adamModeConfig;\r\n\r\n        vm.disabled = $scope.ngDisabled;\r\n        vm.enableSelect = ($scope.enableSelect === false) ? false : true; // must do it like this, $scope.enableSelect || true will not work\r\n\r\n        vm.activate = function () {\r\n            if($scope.autoLoad)\r\n                vm.toggle();\r\n            if ($scope.registerSelf)\r\n                $scope.registerSelf(vm);\r\n        };\r\n\r\n        // load svc...\r\n        vm.svc = adamSvc(vm.contentTypeName, vm.entityGuid, vm.fieldName, vm.subFolder, $scope.adamModeConfig);\r\n\r\n        // refresh - also used by callback after an upload completed\r\n        vm.refresh = vm.svc.liveListReload;\r\n\r\n        vm.get = function () {\r\n            vm.items = vm.svc.liveList();\r\n            vm.folders = vm.svc.folders;\r\n            vm.svc.liveListReload();\r\n        };\r\n\r\n        vm.toggle = function toggle(newConfig) {\r\n            // Reload configuration\r\n            initConfig();\r\n            var configChanged = false;\r\n            if (newConfig) {\r\n                // Detect changes in config, allows correct toggle behaviour\r\n                if (JSON.stringify(newConfig) !== vm.oldConfig)\r\n                    configChanged = true;\r\n                vm.oldConfig = JSON.stringify(newConfig);\r\n\r\n                vm.showImagesOnly = newConfig.showImagesOnly;\r\n                $scope.adamModeConfig.usePortalRoot = !!(newConfig.usePortalRoot);\r\n            }\r\n\r\n            vm.show = configChanged || !vm.show;\r\n            \r\n            if (!vm.show)\r\n                $scope.adamModeConfig.usePortalRoot = false;\r\n\r\n            // Override configuration in portal mode\r\n            if ($scope.adamModeConfig.usePortalRoot) {\r\n                vm.showFolders = true;\r\n                vm.folderDepth = 99;\r\n            }\r\n\r\n            if (vm.show)\r\n                vm.get();\r\n        };\r\n\r\n        vm.openUpload = function () {\r\n            // debugger;\r\n            vm.dropzone.openUpload();\r\n        };\r\n\r\n        vm.select = function (fileItem) {\r\n            if (vm.disabled || !vm.enableSelect)\r\n                return;\r\n            $scope.updateCallback(fileItem);\r\n        };\r\n\r\n        vm.addFolder = function () {\r\n            if (vm.disabled)\r\n                return;\r\n            var folderName = window.prompt(\"Please enter a folder name\"); // todo i18n\r\n            if (folderName)\r\n                vm.svc.addFolder(folderName)\r\n                    .then(vm.refresh);\r\n        };\r\n\r\n        vm.del = function del(item) {\r\n            if (vm.disabled)\r\n                return;\r\n            var ok = window.confirm(\"Are you sure you want to delete this item?\"); // todo i18n\r\n            if (ok)\r\n                vm.svc.delete(item);\r\n        };\r\n\r\n        vm.rename = function rename(item) {\r\n            var newName = window.prompt('Rename the file / folder to: ', item.Name);\r\n            if (newName)\r\n                vm.svc.rename(item, newName);\r\n        };\r\n\r\n        //#region Folder Navigation\r\n        vm.goIntoFolder = function (folder) {\r\n            var subFolder = vm.svc.goIntoFolder(folder);\r\n            vm.subFolder = subFolder;\r\n        };\r\n\r\n        vm.goUp = function () {\r\n            vm.subFolder = vm.svc.goUp();\r\n        };\r\n\r\n        vm.currentFolderDepth = function() {\r\n            return vm.svc.folders.length;\r\n        };\r\n\r\n        vm.allowCreateFolder = function() {\r\n            return vm.svc.folders.length < vm.folderDepth;\r\n        };\r\n        //#endregion\r\n\r\n        //#region Metadata\r\n        vm.editMetadata = function(item) {\r\n            var items = [\r\n                vm._itemDefinition(item, vm.getMetadataType(item))\r\n            ];\r\n\r\n            eavAdminDialogs.openEditItems(items, vm.refresh);\r\n        };\r\n\r\n        vm.getMetadataType = function(item) {\r\n            var found;\r\n\r\n            // check if it's a folder and if this has a special registration\r\n            if (item.Type === \"folder\") {\r\n                found = vm.metadataContentTypes.match(/^(folder)(:)([^\\n]*)/im);\r\n                if (found)\r\n                    return found[3];\r\n                else \r\n                    return null;\r\n            }\r\n\r\n            // check if the extension has a special registration\r\n            // -- not implemented yet\r\n\r\n            // check if the type \"image\" or \"document\" has a special registration\r\n            // -- not implemneted yet\r\n\r\n\r\n            // nothing found so far, go for the default with nothing as the prefix \r\n            found = vm.metadataContentTypes.match(/^([^:\\n]*)(\\n|$)/im);\r\n            if (found)\r\n                return found[1];\r\n\r\n            // this is if we don't find anything\r\n            return null;\r\n        };\r\n\r\n        // todo: move to service, shouldn't be part of the application\r\n        vm._itemDefinition = function (item, metadataType) {\r\n            var title = \"EditFormTitle.Metadata\"; // todo: i18n\r\n            return item.MetadataId !== 0\r\n                ? { EntityId: item.MetadataId, Title: title } // if defined, return the entity-number to edit\r\n                : {\r\n                    ContentTypeName: metadataType, // otherwise the content type for new-assegnment\r\n                    Metadata: {\r\n                        Key: (item.Type === \"folder\" ? \"folder\" : \"file\") + \":\" + item.Id,\r\n                        KeyType: \"string\",\r\n                        TargetType: eavConfig.metadataOfCmsObject\r\n                    },\r\n                    Title: title,\r\n                    Prefill: { EntityTitle: item.Name } // possibly prefill the entity title \r\n                };\r\n\r\n        };\r\n\r\n        //#endregion\r\n\r\n        //#region icons\r\n        vm.icon = function (item) {\r\n            return fileType.getIconClass(item.Name);\r\n        };\r\n        //#endregion\r\n\r\n        vm.allowedFileTypes = [];\r\n        if ($scope.fileFilter) {\r\n            vm.allowedFileTypes = $scope.fileFilter.split(',').map(function (i) {\r\n                return i.replace('*', '').trim();\r\n            });\r\n        }\r\n\r\n        vm.fileEndingFilter = function (item) {\r\n            if (vm.allowedFileTypes.length === 0)\r\n                return true;\r\n            var extension = item.Name.match(/(?:\\.([^.]+))?$/)[0];\r\n            return vm.allowedFileTypes.indexOf(extension) != -1;\r\n        };\r\n\r\n        vm.activate();\r\n\r\n        $scope.copyPasted = function (event) {\r\n            var clipData = event.clipboardData;\r\n            angular.forEach(clipData.items, function (item, key) {\r\n                if (clipData.items[key].type.match(/image.*/)) {\r\n                    // if it is a image form clipboard\r\n                    var img = clipData.items[key].getAsFile();\r\n                    // input image filename\r\n                    if (browser() !== 'Edge') {\r\n                        var imageFileName = 'image.png';\r\n                        // todo: generate hash sha256 for name\r\n                        imageFileName = window.prompt('Enter clipboard image file name: ', imageFileName); // todo: i18n \r\n                        img = twoSxcFile(img, imageFileName);\r\n                    }\r\n                    // todo: convert png to jpg\r\n                    vm.dropzone.processFile(img);\r\n                }\r\n            });\r\n        };\r\n\r\n\r\n        /**\r\n         * convert blob image to jpeg\r\n         * @param {any} file\r\n         * @param {any} quality\r\n         * @param {any} outputFormat\r\n         */\r\n        function convertImageFormat(file, quality, outputFormat) {\r\n\r\n            var mimeType;\r\n            if (outputFormat === 'png') {\r\n                mimeType = 'image/png';\r\n            } else if (outputFormat === 'webp') {\r\n                mimeType = 'image/webp';\r\n            } else {\r\n                mimeType = 'image/jpeg';\r\n            }\r\n\r\n            var img = new Image();\r\n            img.src = URL.createObjectURL(file);\r\n            URL.revokeObjectURL(img.src); // free up memory\r\n\r\n            var canvas = document.createElement('canvas'); // create a temp. canvas\r\n            canvas.width = img.width;\r\n            canvas.height = img.height;\r\n            var ctx = canvas.getContext('2d').drawImage(img, 0, 0);\r\n\r\n            // convert to File object, NOTE: we're using binary mime-type for the final Blob/File\r\n            canvas.toBlob(function (blob) {\r\n                file = new File([blob], file.name, { type: 'application/octet-stream' });\r\n            }, mimeType, quality / 100);\r\n        }\r\n\r\n\r\n        /**\r\n         * compress image to jpeg, png or webp\r\n         * @param {Image} sourceImgObj\r\n         * @param {integer} quality\r\n         * @param {string} outputFormat\r\n         */\r\n        function compress(sourceImgObj, quality, outputFormat) {\r\n\r\n            var mimeType;\r\n            if (outputFormat === 'png') {\r\n                mimeType = 'image/png';\r\n            } else if (outputFormat === 'webp') {\r\n                mimeType = 'image/webp';\r\n            } else {\r\n                mimeType = 'image/jpeg';\r\n            }\r\n\r\n            var canvas = document.createElement('canvas');\r\n            canvas.width = sourceImgObj.naturalWidth;\r\n            canvas.height = sourceImgObj.naturalHeight;\r\n            var ctx = canvas.getContext('2d').drawImage(sourceImgObj, 0, 0);\r\n\r\n            var newImageData = canvas.toDataURL(mimeType, quality / 100);\r\n            var resultImageObj = new Image();\r\n            resultImageObj.src = newImageData;\r\n            return resultImageObj;\r\n        }\r\n\r\n        /**\r\n         * creates new customized file\r\n         * @param {File} file\r\n         * @param {string} fileName\r\n         */\r\n        function twoSxcFile(file, fileName) {\r\n            var data = new FormData();\r\n            data.append('file', file, fileName);\r\n            var newFile = data.get('file');\r\n            return newFile;\r\n        }\r\n\r\n        /**\r\n         * Gets the browser name or returns an empty string if unknown. \r\n         * This function also caches the result to provide for any \r\n         * future calls this function has.\r\n         * https://stackoverflow.com/questions/9847580/how-to-detect-safari-chrome-ie-firefox-and-opera-browser\r\n         *\r\n         * @returns {string}\r\n         */\r\n        function browser() {\r\n            // Return cached result if avalible, else get result then cache it.\r\n            if (browser.prototype._cachedResult)\r\n                return browser.prototype._cachedResult;\r\n\r\n            // Opera 8.0+\r\n            var isOpera = (!!window.opr && !!opr.addons) || !!window.opera || navigator.userAgent.indexOf(' OPR/') >= 0;\r\n\r\n            // Firefox 1.0+\r\n            var isFirefox = typeof InstallTrigger !== 'undefined';\r\n\r\n            // Safari 3.0+ \"[object HTMLElementConstructor]\" \r\n            var isSafari = /constructor/i.test(window.HTMLElement) || (function (p) { return p.toString() === \"[object SafariRemoteNotification]\"; })(!window.safari || safari.pushNotification);\r\n\r\n            // Internet Explorer 6-11\r\n            var isIE = /*@cc_on!@*/false || !!document.documentMode;\r\n\r\n            // Edge 20+\r\n            var isEdge = !isIE && !!window.StyleMedia;\r\n\r\n            // Chrome 1+\r\n            var isChrome = !!window.chrome && !!window.chrome.webstore;\r\n\r\n            // Blink engine detection\r\n            var isBlink = (isChrome || isOpera) && !!window.CSS;\r\n\r\n            browser.prototype._cachedResult =\r\n                isOpera ? 'Opera' :\r\n                isFirefox ? 'Firefox' :\r\n                isSafari ? 'Safari' :\r\n                isChrome ? 'Chrome' :\r\n                isIE ? 'IE' :\r\n                isEdge ? 'Edge' :\r\n                isBlink ? 'Blink' :\r\n                \"Don't know\";\r\n\r\n            return browser.prototype._cachedResult;\r\n        }\r\n\r\n    }\r\n\r\n})();\r\n\n(function () {\r\n    /* jshint laxbreak:true*/\r\n\r\n    angular.module(\"Adam\")\r\n        /*@ngInject*/\r\n        .directive(\"adamBrowser\", function () {\r\n            return {\r\n                restrict: \"E\",\r\n                templateUrl: \"adam/browser.html\",\r\n\r\n                //replace: true,\r\n                transclude: false,\r\n                require: \"^dropzone\",\r\n                link: function postLink(scope, elem, attrs, dropzoneCtrl) {\r\n                    // connect this adam to the dropzone\r\n                    dropzoneCtrl.adam = scope.vm;       // so the dropzone controller knows what path etc.\r\n                    scope.vm.dropzone = dropzoneCtrl;   // so we can require an \"open file browse\" dialog\r\n                },\r\n\r\n                // todo: change \"scope\" to bindToController whenever I have time - http://blog.thoughtram.io/angularjs/2015/01/02/exploring-angular-1.3-bindToController.html\r\n                scope: {\r\n                    // Identity fields\r\n                    contentTypeName: \"=\",\r\n                    entityGuid: \"=\",\r\n                    fieldName: \"=\",\r\n\r\n                    // configuration general\r\n                    subFolder: \"=\",\r\n                    folderDepth: \"=\", \r\n                    metadataContentTypes: \"=\",\r\n                    allowAssetsInRoot: \"=\",\r\n                    showImagesOnly: \"=?\",\r\n                    adamModeConfig: \"=\",\r\n                    fileFilter: \"=?\",\r\n\r\n                    // binding and cross-component communication\r\n                    autoLoad: \"=\",\r\n                    updateCallback: \"=\",\r\n                    registerSelf: \"=\",\r\n\r\n                    // basic functionality\r\n                    enableSelect: \"=\",\r\n                    ngDisabled: \"=\"\r\n                },\r\n                controller: \"BrowserController\",\r\n                controllerAs: \"vm\"\r\n\r\n            };\r\n        });\r\n})();\n(function() {\r\n    /* jshint laxbreak:true*/\r\n    angular.module(\"Adam\")\r\n        /*@ngInject*/\r\n        .directive(\"dropzoneUploadPreview\", function () {\r\n            return {\r\n                restrict: \"E\",\r\n                templateUrl: \"adam/dropzone-upload-preview.html\",\r\n                replace: true,\r\n                transclude: false\r\n            };\r\n        });\r\n})();\n/* js/fileAppDirectives */\r\n(function () {\r\n    angular.module('Adam')\r\n        /*@ngInject*/\r\n        .directive('dropzone', [\"sxc\", \"tabId\", \"AppInstanceId\", \"ContentBlockId\", \"dragClass\", \"adamSvc\", \"$timeout\", \"$translate\", function (sxc, tabId, AppInstanceId, ContentBlockId, dragClass, adamSvc, $timeout, $translate) {\r\n\r\n            return {\r\n                restrict: 'C',\r\n                link: postLink,\r\n\r\n                // This controller is needed, because it needs an API which can talk to other directives\r\n                controller: controller\r\n            };\r\n\r\n\r\n            // this is the method called after linking the directive, which initializes Dropzone\r\n            function postLink(scope, element, attrs, controller) {\r\n                var header = scope.$parent.to.header;\r\n                var field = scope.$parent.options.key;\r\n                var entityGuid = header.Guid;\r\n                var svc = adamSvc(header.ContentTypeName, entityGuid, field, '', scope.$parent.vm.adamModeConfig);\r\n                var url = svc.url;\r\n\r\n                var config = {\r\n                    url: url,\r\n                    urlRoot: url,\r\n                    maxFilesize: 10000, // 10'000 MB = 10 GB, note that it will also be stopped on the server if it's larger than the really allowed sized\r\n                    paramName: 'uploadfile',\r\n                    maxThumbnailFilesize: 10,\r\n\r\n                    headers: {\r\n                        \"ModuleId\": AppInstanceId,\r\n                        \"TabId\": tabId,\r\n                        \"ContentBlockId\": ContentBlockId\r\n                    },\r\n\r\n                    dictDefaultMessage: '',\r\n                    addRemoveLinks: false,\r\n                    previewsContainer: '.field-' + field.toLowerCase() + ' .dropzone-previews',\r\n                    // we need a clickable, because otherwise the entire area is clickable. so i'm just making the preview clickable, as it's not important\r\n                    clickable: '.field-' + field.toLowerCase() + ' .invisible-clickable' // \" .dropzone-adam\"\r\n                };\r\n\r\n\r\n                var eventHandlers = {\r\n                    'addedfile': function (file) {\r\n                        // debugger;\r\n                        $timeout(function () {\r\n                            // anything you want can go here and will safely be run on the next digest.\r\n                            scope.$apply(function () { // this must run in a timeout\r\n                                scope.uploading = true;\r\n                            });\r\n                        });\r\n                    },\r\n\r\n                    'drop': function (event) {\r\n                        // debugger;\r\n                        console.log('stv: drop', event);\r\n                    },\r\n\r\n                    \"processing\": function (file) {\r\n                        // debugger;\r\n                        this.options.url = svc.uploadUrl(controller.adam.subFolder);\r\n                    },\r\n\r\n                    'success': function (file, response) {\r\n                        // debugger;\r\n                        if (response.Success) {\r\n                            svc.addFullPath(response); // calculate additional infos\r\n                            scope.$parent.afterUpload(response);\r\n                        } else {\r\n                            alert('Upload failed because: ' + response.Error);\r\n                        }\r\n                    },\r\n                    'error': function (file, error, xhr) {\r\n                        alert($translate.instant('Errors.AdamUploadError'));\r\n                    },\r\n\r\n                    \"queuecomplete\": function (file) {\r\n                        if (this.getUploadingFiles().length === 0 && this.getQueuedFiles().length === 0) {\r\n                            scope.uploading = false;\r\n                            controller.adam.refresh();\r\n                        }\r\n                    }\r\n                };\r\n\r\n                // delay building the dropszone till the DOM is ready\r\n                $timeout(function () {\r\n                    var dropzone = new Dropzone(element[0], config);\r\n\r\n                    angular.forEach(eventHandlers, function (handler, event) {\r\n                        dropzone.on(event, handler);\r\n                    });\r\n\r\n                    scope.processDropzone = function () { dropzone.processQueue(); };\r\n                    scope.resetDropzone = function () { dropzone.removeAllFiles(); };\r\n                    controller.openUpload = function () { dropzone.hiddenFileInput.click(); };\r\n                    controller.processFile = function (file) { dropzone.processFile(file); }; // needed for clipboard paste\r\n\r\n\r\n                    var pasteInstance;\r\n\r\n                    // pastableTextarea - for adam input\r\n                    pasteInstance = $(element[0]).children(\"div:first\").children(\"div.after-preview:first\").children(\"div:first\").children(\"input:first\");\r\n                    if (pasteInstance.length > 0) {\r\n                        pasteInstance.pastableTextarea();\r\n                        pasteInstance.on('pasteImage', function (ev, data) {\r\n                            pasteImageInDropzone(ev, data, dropzone);\r\n                        });\r\n\r\n                        // pastableNonInputable\r\n                        pasteInstance = $(element[0]);\r\n                        if (pasteInstance.length > 0) {\r\n                            pasteInstance.pastableNonInputable();\r\n                            pasteInstance.on('pasteImage', function (ev, data) {\r\n                                pasteImageInDropzone(ev, data, dropzone);\r\n                            });\r\n                        }\r\n\r\n                    }\r\n\r\n                    // pastableContenteditable - for tinymce\r\n                    pasteInstance = $(element[0]).children(\"div:first\").children(\"div[contenteditable]:first\");\r\n                    if (pasteInstance.length > 0) {\r\n                        pasteInstance.pastableContenteditable();\r\n                        pasteInstance.on('pasteImage', function (ev, data) {\r\n                            pasteImageInDropzone(ev, data, dropzone);\r\n                        });\r\n                    }\r\n\r\n                    \r\n\r\n\r\n                    //.on('pasteText', function (ev, data) {\r\n                    //    debugger;\r\n                    //    //$('<div class=\"result\"></div>').text('text: \"' + data.text + '\"').insertAfter(this);\r\n                    //}).on('pasteTextRich', function (ev, data) {\r\n                    //    debugger;\r\n                    //    //$('<div class=\"result\"></div>').text('rtf: \"' + data.text + '\"').insertAfter(this);\r\n                    //}).on('pasteTextHtml', function (ev, data) {\r\n                    //    debugger;\r\n                    //    //$('<div class=\"result\"></div>').text('html: \"' + data.text + '\"').insertAfter(this);\r\n                    //});\r\n\r\n\r\n                }, 0);\r\n\r\n                function pasteImageInDropzone(ev, data, dropzone) {\r\n                    var img = data.file;\r\n                    // input image filename\r\n                    if (browser() !== 'Edge') {\r\n                        var imageFileName = 'image.png';\r\n                        // todo: generate hash sha256 for name\r\n                        imageFileName = window.prompt('Enter clipboard image file name: ', imageFileName); // todo: i18n \r\n                        img = twoSxcFile(img, imageFileName);\r\n                    }\r\n                    // todo: convert png to jpg\r\n                    dropzone.processFile(img);\r\n                }\r\n\r\n                /**\r\n                 * creates new customized file\r\n                 * @param {File} file\r\n                 * @param {string} fileName\r\n                 */\r\n                function twoSxcFile(file, fileName) {\r\n                    var data = new FormData();\r\n                    data.append('file', file, fileName);\r\n                    var newFile = data.get('file');\r\n                    return newFile;\r\n                }\r\n\r\n                /**\r\n                 * Gets the browser name or returns an empty string if unknown. \r\n                 * This function also caches the result to provide for any \r\n                 * future calls this function has.\r\n                 * https://stackoverflow.com/questions/9847580/how-to-detect-safari-chrome-ie-firefox-and-opera-browser\r\n                 *\r\n                 * @returns {string}\r\n                 */\r\n                function browser() {\r\n                    // Return cached result if avalible, else get result then cache it.\r\n                    if (browser.prototype._cachedResult)\r\n                        return browser.prototype._cachedResult;\r\n\r\n                    // Opera 8.0+\r\n                    var isOpera = (!!window.opr && !!opr.addons) || !!window.opera || navigator.userAgent.indexOf(' OPR/') >= 0;\r\n\r\n                    // Firefox 1.0+\r\n                    var isFirefox = typeof InstallTrigger !== 'undefined';\r\n\r\n                    // Safari 3.0+ \"[object HTMLElementConstructor]\" \r\n                    var isSafari = /constructor/i.test(window.HTMLElement) || (function (p) { return p.toString() === \"[object SafariRemoteNotification]\"; })(!window.safari || safari.pushNotification);\r\n\r\n                    // Internet Explorer 6-11\r\n                    var isIE = /*@cc_on!@*/false || !!document.documentMode;\r\n\r\n                    // Edge 20+\r\n                    var isEdge = !isIE && !!window.StyleMedia;\r\n\r\n                    // Chrome 1+\r\n                    var isChrome = !!window.chrome && !!window.chrome.webstore;\r\n\r\n                    // Blink engine detection\r\n                    var isBlink = (isChrome || isOpera) && !!window.CSS;\r\n\r\n                    browser.prototype._cachedResult =\r\n                        isOpera ? 'Opera' :\r\n                            isFirefox ? 'Firefox' :\r\n                                isSafari ? 'Safari' :\r\n                                    isChrome ? 'Chrome' :\r\n                                        isIE ? 'IE' :\r\n                                            isEdge ? 'Edge' :\r\n                                                isBlink ? 'Blink' :\r\n                                                    \"Don't know\";\r\n\r\n                    return browser.prototype._cachedResult;\r\n                }\r\n\r\n            }\r\n\r\n\r\n\r\n            /*@ngInject*/\r\n            function controller() {\r\n                var vm = this;\r\n                vm.adam = {\r\n                    show: false,\r\n                    subFolder: '',\r\n                    refresh: function () { }\r\n                };\r\n\r\n            }\r\n\r\n        }]);\r\n\r\n\r\n})();\n// Generated by CoffeeScript 1.12.7\r\n\r\n/*\r\npaste.js is an interface to read data ( text / image ) from clipboard in different browsers. It also contains several hacks.\r\n\r\nhttps://github.com/layerssss/paste.js\r\n */\r\n\r\n(function () {\r\n    var $, Paste, createHiddenEditable, dataURLtoBlob, isFocusable;\r\n\r\n    // debugger;\r\n\r\n    $ = window.jQuery;\r\n\r\n    $.paste = function (pasteContainer) {\r\n        var pm;\r\n        if (typeof console !== \"undefined\" && console !== null) {\r\n            console.log(\"DEPRECATED: This method is deprecated. Please use $.fn.pastableNonInputable() instead.\");\r\n        }\r\n        pm = Paste.mountNonInputable(pasteContainer);\r\n        return pm._container;\r\n    };\r\n\r\n    $.fn.pastableNonInputable = function () {\r\n        // debugger;\r\n        var el, j, len, ref;\r\n        ref = this;\r\n        for (j = 0, len = ref.length; j < len; j++) {\r\n            el = ref[j];\r\n            if (el._pastable || $(el).is('textarea, input:text, [contenteditable]')) {\r\n                continue;\r\n            }\r\n            Paste.mountNonInputable(el);\r\n            el._pastable = true;\r\n        }\r\n        return this;\r\n    };\r\n\r\n    $.fn.pastableTextarea = function () {\r\n        var el, j, len, ref;\r\n        ref = this;\r\n        for (j = 0, len = ref.length; j < len; j++) {\r\n            el = ref[j];\r\n            if (el._pastable || $(el).is(':not(textarea, input:text)')) {\r\n                continue;\r\n            }\r\n            Paste.mountTextarea(el);\r\n            el._pastable = true;\r\n        }\r\n        return this;\r\n    };\r\n\r\n    $.fn.pastableContenteditable = function () {\r\n        var el, j, len, ref;\r\n        ref = this;\r\n        for (j = 0, len = ref.length; j < len; j++) {\r\n            el = ref[j];\r\n            if (el._pastable || $(el).is(':not([contenteditable])')) {\r\n                continue;\r\n            }\r\n            Paste.mountContenteditable(el);\r\n            el._pastable = true;\r\n        }\r\n        return this;\r\n    };\r\n\r\n    dataURLtoBlob = function (dataURL, sliceSize) {\r\n        var b64Data, byteArray, byteArrays, byteCharacters, byteNumbers, contentType, i, m, offset, ref, slice;\r\n        if (sliceSize == null) {\r\n            sliceSize = 512;\r\n        }\r\n        if (!(m = dataURL.match(/^data\\:([^\\;]+)\\;base64\\,(.+)$/))) {\r\n            return null;\r\n        }\r\n        ref = m, m = ref[0], contentType = ref[1], b64Data = ref[2];\r\n        byteCharacters = atob(b64Data);\r\n        byteArrays = [];\r\n        offset = 0;\r\n        while (offset < byteCharacters.length) {\r\n            slice = byteCharacters.slice(offset, offset + sliceSize);\r\n            byteNumbers = new Array(slice.length);\r\n            i = 0;\r\n            while (i < slice.length) {\r\n                byteNumbers[i] = slice.charCodeAt(i);\r\n                i++;\r\n            }\r\n            byteArray = new Uint8Array(byteNumbers);\r\n            byteArrays.push(byteArray);\r\n            offset += sliceSize;\r\n        }\r\n        return new Blob(byteArrays, {\r\n            type: contentType\r\n        });\r\n    };\r\n\r\n    createHiddenEditable = function () {\r\n        return $(document.createElement('div')).attr('contenteditable', true).attr('aria-hidden', true).attr('tabindex', -1).css({\r\n            width: 1,\r\n            height: 1,\r\n            position: 'fixed',\r\n            left: -100,\r\n            overflow: 'hidden',\r\n            opacity: 1e-17\r\n        });\r\n    };\r\n\r\n    isFocusable = function (element, hasTabindex) {\r\n        var fieldset, focusableIfVisible, img, map, mapName, nodeName;\r\n        map = void 0;\r\n        mapName = void 0;\r\n        img = void 0;\r\n        focusableIfVisible = void 0;\r\n        fieldset = void 0;\r\n        nodeName = element.nodeName.toLowerCase();\r\n        if ('area' === nodeName) {\r\n            map = element.parentNode;\r\n            mapName = map.name;\r\n            if (!element.href || !mapName || map.nodeName.toLowerCase() !== 'map') {\r\n                return false;\r\n            }\r\n            img = $('img[usemap=\\'#' + mapName + '\\']');\r\n            return img.length > 0 && img.is(':visible');\r\n        }\r\n        if (/^(input|select|textarea|button|object)$/.test(nodeName)) {\r\n            focusableIfVisible = !element.disabled;\r\n            if (focusableIfVisible) {\r\n                fieldset = $(element).closest('fieldset')[0];\r\n                if (fieldset) {\r\n                    focusableIfVisible = !fieldset.disabled;\r\n                }\r\n            }\r\n        } else if ('a' === nodeName) {\r\n            focusableIfVisible = element.href || hasTabindex;\r\n        } else {\r\n            focusableIfVisible = hasTabindex;\r\n        }\r\n        focusableIfVisible = focusableIfVisible || $(element).is('[contenteditable]');\r\n        return focusableIfVisible && $(element).is(':visible');\r\n    };\r\n\r\n    Paste = (function () {\r\n        Paste.prototype._target = null;\r\n\r\n        Paste.prototype._container = null;\r\n\r\n        Paste.mountNonInputable = function (nonInputable) {\r\n            var paste;\r\n            paste = new Paste(createHiddenEditable().appendTo(nonInputable), nonInputable);\r\n            $(nonInputable).on('click', (function (_this) {\r\n                // debugger;\r\n                return function (ev) {\r\n                    if (!isFocusable(ev.target, false)) {\r\n                        return paste._container.focus();\r\n                    }\r\n                };\r\n            })(this));\r\n            paste._container.on('focus', (function (_this) {\r\n                // debugger;\r\n                return function () {\r\n                    return $(nonInputable).addClass('pastable-focus');\r\n                };\r\n            })(this));\r\n            return paste._container.on('blur', (function (_this) {\r\n                // debugger;\r\n                return function () {\r\n                    return $(nonInputable).removeClass('pastable-focus');\r\n                };\r\n            })(this));\r\n        };\r\n\r\n        Paste.mountTextarea = function (textarea) {\r\n            var ctlDown, paste, ref, ref1;\r\n            if ((typeof DataTransfer !== \"undefined\" && DataTransfer !== null ? DataTransfer.prototype : void 0) && ((ref = Object.getOwnPropertyDescriptor) != null ? (ref1 = ref.call(Object, DataTransfer.prototype, 'items')) != null ? ref1.get : void 0 : void 0)) {\r\n                return this.mountContenteditable(textarea);\r\n            }\r\n            paste = new Paste(createHiddenEditable().insertBefore(textarea), textarea);\r\n            ctlDown = false;\r\n            $(textarea).on('keyup', function (ev) {\r\n                var ref2;\r\n                if ((ref2 = ev.keyCode) === 17 || ref2 === 224) {\r\n                    ctlDown = false;\r\n                }\r\n                return null;\r\n            });\r\n            $(textarea).on('keydown', function (ev) {\r\n                var ref2;\r\n                if ((ref2 = ev.keyCode) === 17 || ref2 === 224) {\r\n                    ctlDown = true;\r\n                }\r\n                if ((ev.ctrlKey != null) && (ev.metaKey != null)) {\r\n                    ctlDown = ev.ctrlKey || ev.metaKey;\r\n                }\r\n                if (ctlDown && ev.keyCode === 86) {\r\n                    paste._textarea_focus_stolen = true;\r\n                    paste._container.focus();\r\n                    paste._paste_event_fired = false;\r\n                    setTimeout((function (_this) {\r\n                        return function () {\r\n                            if (!paste._paste_event_fired) {\r\n                                $(textarea).focus();\r\n                                return paste._textarea_focus_stolen = false;\r\n                            }\r\n                        };\r\n                    })(this), 1);\r\n                }\r\n                return null;\r\n            });\r\n            $(textarea).on('paste', (function (_this) {\r\n                return function () { };\r\n            })(this));\r\n            $(textarea).on('focus', (function (_this) {\r\n                return function () {\r\n                    if (!paste._textarea_focus_stolen) {\r\n                        return $(textarea).addClass('pastable-focus');\r\n                    }\r\n                };\r\n            })(this));\r\n            $(textarea).on('blur', (function (_this) {\r\n                return function () {\r\n                    if (!paste._textarea_focus_stolen) {\r\n                        return $(textarea).removeClass('pastable-focus');\r\n                    }\r\n                };\r\n            })(this));\r\n            $(paste._target).on('_pasteCheckContainerDone', (function (_this) {\r\n                return function () {\r\n                    $(textarea).focus();\r\n                    return paste._textarea_focus_stolen = false;\r\n                };\r\n            })(this));\r\n            return $(paste._target).on('pasteText', (function (_this) {\r\n                return function (ev, data) {\r\n                    var content, curEnd, curStart;\r\n                    curStart = $(textarea).prop('selectionStart');\r\n                    curEnd = $(textarea).prop('selectionEnd');\r\n                    content = $(textarea).val();\r\n                    $(textarea).val(\"\" + content.slice(0, curStart) + data.text + content.slice(curEnd));\r\n                    $(textarea)[0].setSelectionRange(curStart + data.text.length, curStart + data.text.length);\r\n                    return $(textarea).trigger('change');\r\n                };\r\n            })(this));\r\n        };\r\n\r\n        Paste.mountContenteditable = function (contenteditable) {\r\n            var paste;\r\n            paste = new Paste(contenteditable, contenteditable);\r\n            $(contenteditable).on('focus', (function (_this) {\r\n                return function () {\r\n                    return $(contenteditable).addClass('pastable-focus');\r\n                };\r\n            })(this));\r\n            return $(contenteditable).on('blur', (function (_this) {\r\n                return function () {\r\n                    return $(contenteditable).removeClass('pastable-focus');\r\n                };\r\n            })(this));\r\n        };\r\n\r\n        function Paste(_container, _target) {\r\n            this._container = _container;\r\n            this._target = _target;\r\n            this._container = $(this._container);\r\n            this._target = $(this._target).addClass('pastable');\r\n            // debugger;\r\n            this._container.on('paste', (function (_this) {\r\n                // debugger;\r\n                return function (ev) {\r\n                    // debugger;\r\n                    var _i, clipboardData, file, fileType, item, j, k, l, len, len1, len2, pastedFilename, reader, ref, ref1, ref2, ref3, ref4, stringIsFilename, text;\r\n                    _this.originalEvent = (ev.originalEvent !== null ? ev.originalEvent : null);\r\n                    _this._paste_event_fired = true;\r\n                    if (((ref = ev.originalEvent) != null ? ref.clipboardData : void 0) != null) {\r\n                        clipboardData = ev.originalEvent.clipboardData;\r\n                        if (clipboardData.items) {\r\n                            pastedFilename = null;\r\n                            _this.originalEvent.pastedTypes = [];\r\n                            ref1 = clipboardData.items;\r\n                            for (j = 0, len = ref1.length; j < len; j++) {\r\n                                item = ref1[j];\r\n                                if (item.type.match(/^text\\/(plain|rtf|html)/)) {\r\n                                    _this.originalEvent.pastedTypes.push(item.type);\r\n                                }\r\n                            }\r\n                            ref2 = clipboardData.items;\r\n                            for (_i = k = 0, len1 = ref2.length; k < len1; _i = ++k) {\r\n                                item = ref2[_i];\r\n                                if (item.type.match(/^image\\//)) {\r\n                                    try {\r\n                                        var clipboardImageAsFile = item.getAsFile();\r\n                                        _this._target.trigger('pasteImage', {\r\n                                            file: clipboardImageAsFile,\r\n                                            originalEvent: _this.originalEvent\r\n                                        });\r\n                                    } catch (error) { }\r\n                                    ev.preventDefault();\r\n                                    break;\r\n                                }\r\n                                if (item.type === 'text/plain') {\r\n                                    if (_i === 0 && clipboardData.items.length > 1 && clipboardData.items[1].type.match(/^image\\//)) {\r\n                                        stringIsFilename = true;\r\n                                        fileType = clipboardData.items[1].type;\r\n                                    }\r\n                                    item.getAsString(function (string) {\r\n                                        if (stringIsFilename) {\r\n                                            pastedFilename = string;\r\n                                            return _this._target.trigger('pasteText', {\r\n                                                text: string,\r\n                                                isFilename: true,\r\n                                                fileType: fileType,\r\n                                                originalEvent: _this.originalEvent\r\n                                            });\r\n                                        } else {\r\n                                            return _this._target.trigger('pasteText', {\r\n                                                text: string,\r\n                                                originalEvent: _this.originalEvent\r\n                                            });\r\n                                        }\r\n                                    });\r\n                                }\r\n                                if (item.type === 'text/rtf') {\r\n                                    item.getAsString(function (string) {\r\n                                        return _this._target.trigger('pasteTextRich', {\r\n                                            text: string,\r\n                                            originalEvent: _this.originalEvent\r\n                                        });\r\n                                    });\r\n                                }\r\n                                if (item.type === 'text/html') {\r\n                                    item.getAsString(function (string) {\r\n                                        return _this._target.trigger('pasteTextHtml', {\r\n                                            text: string,\r\n                                            originalEvent: _this.originalEvent\r\n                                        });\r\n                                    });\r\n                                }\r\n                            }\r\n                        } else {\r\n                            if (-1 !== Array.prototype.indexOf.call(clipboardData.types, 'text/plain')) {\r\n                                text = clipboardData.getData('Text');\r\n                                setTimeout(function () {\r\n                                    return _this._target.trigger('pasteText', {\r\n                                        text: text,\r\n                                        originalEvent: _this.originalEvent\r\n                                    });\r\n                                }, 1);\r\n                            }\r\n                            //_this._checkImagesInContainer(function (src) {\r\n                            //    return _this._handleImage(src, _this.originalEvent);\r\n                            //});\r\n                        }\r\n                    }\r\n                    if (clipboardData = window.clipboardData) {\r\n                        if ((ref3 = (text = clipboardData.getData('Text'))) != null ? ref3.length : void 0) {\r\n                            setTimeout(function () {\r\n                                _this._target.trigger('pasteText', {\r\n                                    text: text,\r\n                                    originalEvent: _this.originalEvent\r\n                                });\r\n                                return _this._target.trigger('_pasteCheckContainerDone');\r\n                            }, 1);\r\n                        } else {\r\n                            ref4 = clipboardData.files;\r\n                            for (l = 0, len2 = ref4.length; l < len2; l++) {\r\n                                file = ref4[l];\r\n                                _this._target.trigger('pasteImage', {\r\n                                    file: file,\r\n                                    originalEvent: _this.originalEvent\r\n                                });\r\n                            }\r\n                            _this._checkImagesInContainer(function (src) { });\r\n                        }\r\n                    }\r\n                    return null;\r\n                };\r\n            })(this));\r\n\r\n        }\r\n\r\n        //Paste.prototype._handleImage = function (src, e, name) {\r\n        //    var loader;\r\n        //    if (src.match(/^webkit\\-fake\\-url\\:\\/\\//)) {\r\n        //        return this._target.trigger('pasteImageError', {\r\n        //            message: \"You are trying to paste an image in Safari, however we are unable to retieve its data.\"\r\n        //        });\r\n        //    }\r\n        //    this._target.trigger('pasteImageStart');\r\n        //    //loader = new Image();\r\n        //    //loader.crossOrigin = \"anonymous\";\r\n        //    //loader.onload = (function (_this) {\r\n        //    //    return function () {\r\n        //    //        var blob, canvas, ctx, dataURL;\r\n        //    //        canvas = document.createElement('canvas');\r\n        //    //        canvas.width = loader.width;\r\n        //    //        canvas.height = loader.height;\r\n        //    //        ctx = canvas.getContext('2d');\r\n        //    //        ctx.drawImage(loader, 0, 0, canvas.width, canvas.height);\r\n        //    //        dataURL = null;\r\n        //    //        try {\r\n        //    //            dataURL = canvas.toDataURL('image/png');\r\n        //    //            blob = dataURLtoBlob(dataURL);\r\n        //    //        } catch (error) { }\r\n        //    //        if (dataURL) {\r\n        //    //            _this._target.trigger('pasteImage', {\r\n        //    //                blob: blob,\r\n        //    //                dataURL: dataURL,\r\n        //    //                width: loader.width,\r\n        //    //                height: loader.height,\r\n        //    //                originalEvent: e,\r\n        //    //                name: name\r\n        //    //            });\r\n        //    //        }\r\n        //    //        return _this._target.trigger('pasteImageEnd');\r\n        //    //    };\r\n        //    //})(this);\r\n        //    //loader.onerror = (function (_this) {\r\n        //    //    return function () {\r\n        //    //        _this._target.trigger('pasteImageError', {\r\n        //    //            message: \"Failed to get image from: \" + src,\r\n        //    //            url: src\r\n        //    //        });\r\n        //    //        return _this._target.trigger('pasteImageEnd');\r\n        //    //    };\r\n        //    //})(this);\r\n        //    //return loader.src = src;\r\n        //};\r\n\r\n        Paste.prototype._checkImagesInContainer = function (cb) {\r\n            var img, j, len, ref, timespan;\r\n            timespan = Math.floor(1000 * Math.random());\r\n            ref = this._container.find('img');\r\n            for (j = 0, len = ref.length; j < len; j++) {\r\n                img = ref[j];\r\n                img[\"_paste_marked_\" + timespan] = true;\r\n            }\r\n            return setTimeout((function (_this) {\r\n                return function () {\r\n                    var k, len1, ref1;\r\n                    ref1 = _this._container.find('img');\r\n                    for (k = 0, len1 = ref1.length; k < len1; k++) {\r\n                        img = ref1[k];\r\n                        if (!img[\"_paste_marked_\" + timespan]) {\r\n                            cb(img.src);\r\n                            $(img).remove();\r\n                        }\r\n                    }\r\n                    return _this._target.trigger('_pasteCheckContainerDone');\r\n                };\r\n            })(this), 1);\r\n        };\r\n\r\n        /**\r\n         * creates new customized file\r\n         * @param {File} file\r\n         * @param {string} fileName\r\n         */\r\n        function twoSxcFile(file, fileName) {\r\n            var data = new FormData();\r\n            data.append('file', file, fileName);\r\n            var newFile = data.get('file');\r\n            return newFile;\r\n        }\r\n\r\n        /**\r\n         * Gets the browser name or returns an empty string if unknown. \r\n         * This function also caches the result to provide for any \r\n         * future calls this function has.\r\n         * https://stackoverflow.com/questions/9847580/how-to-detect-safari-chrome-ie-firefox-and-opera-browser\r\n         *\r\n         * @returns {string}\r\n         */\r\n        function browser() {\r\n            // Return cached result if avalible, else get result then cache it.\r\n            if (browser.prototype._cachedResult)\r\n                return browser.prototype._cachedResult;\r\n\r\n            // Opera 8.0+\r\n            var isOpera = (!!window.opr && !!opr.addons) || !!window.opera || navigator.userAgent.indexOf(' OPR/') >= 0;\r\n\r\n            // Firefox 1.0+\r\n            var isFirefox = typeof InstallTrigger !== 'undefined';\r\n\r\n            // Safari 3.0+ \"[object HTMLElementConstructor]\" \r\n            var isSafari = /constructor/i.test(window.HTMLElement) || (function (p) { return p.toString() === \"[object SafariRemoteNotification]\"; })(!window.safari || safari.pushNotification);\r\n\r\n            // Internet Explorer 6-11\r\n            var isIE = /*@cc_on!@*/false || !!document.documentMode;\r\n\r\n            // Edge 20+\r\n            var isEdge = !isIE && !!window.StyleMedia;\r\n\r\n            // Chrome 1+\r\n            var isChrome = !!window.chrome && !!window.chrome.webstore;\r\n\r\n            // Blink engine detection\r\n            var isBlink = (isChrome || isOpera) && !!window.CSS;\r\n\r\n            browser.prototype._cachedResult =\r\n                isOpera ? 'Opera' :\r\n                    isFirefox ? 'Firefox' :\r\n                        isSafari ? 'Safari' :\r\n                            isChrome ? 'Chrome' :\r\n                                isIE ? 'IE' :\r\n                                    isEdge ? 'Edge' :\r\n                                        isBlink ? 'Blink' :\r\n                                            \"Don't know\";\r\n\r\n            return browser.prototype._cachedResult;\r\n        }\r\n\r\n        return Paste;\r\n\r\n    })();\r\n\r\n}).call(this);\r\n\n\r\n(function () {\r\n\t\"use strict\";\r\n\r\n\t/* This app registers all field templates for 2sxc in the angularjs sxcFieldTemplates app */\r\n\r\n    angular.module(\"sxcFieldTemplates\", [\r\n        \"formly\",\r\n        \"formlyBootstrap\",\r\n        \"ui.bootstrap\",\r\n        \"ui.tree\",\r\n        \"2sxc4ng\",\r\n        \"SxcEditTemplates\",     // temp - was because of bad template-converter, remove once I update grunt\r\n        \"EavConfiguration\",\r\n        \"SxcServices\",\r\n        \"eavFieldTemplates\",\r\n        \"Adam\",\r\n        //\"ui.tinymce\",   // connector to tiny-mce for angular\r\n        \"oc.lazyLoad\"   // needed to lazy-load the MCE editor from the cloud\r\n    ]);\r\n\r\n})();\n// This is the service which allows opening dnn-bridge dialogs and processes the results\r\n\r\nangular.module(\"sxcFieldTemplates\")\r\n    /*@ngInject*/\r\n    .factory(\"dnnBridgeSvc\", [\"$uibModal\", \"$http\", \"promiseToastr\", function ($uibModal, $http, promiseToastr) {\r\n        var svc = {};\r\n        svc.open = function open(oldValue, params, callback) {\r\n            var type = \"pagepicker\";\r\n\r\n            var connector = {\r\n                params: params,\r\n                valueChanged: callback,\r\n                dialogType: type\r\n            };\r\n\r\n            connector.valueChanged = function valueChanged(value) {\r\n                connector.modalInstance.close();\r\n                callback(value);\r\n            };\r\n\r\n            connector.params.CurrentValue = oldValue;\r\n\r\n            console.log(\"before open page picker\");\r\n            console.log($uibModal);\r\n            connector.modalInstance = $uibModal.open({\r\n                templateUrl: \"fields/dnn-bridge/hyperlink-default-pagepicker.html\",\r\n                resolve: {\r\n                    bridge: function () {\r\n                        return connector;\r\n                    }\r\n                },\r\n                /*@ngInject*/\r\n                controller: [\"$scope\", \"bridge\", function ($scope, bridge) {\r\n                    $scope.bridge = bridge;\r\n                }],\r\n                windowClass: \"sxc-dialog-filemanager\"\r\n            });\r\n            console.log(\"after open page picker\");\r\n\r\n            return connector.modalInstance;\r\n        };\r\n\r\n\r\n        // handle short-ID links like file:17\r\n        svc.getUrlOfId = function(idCode, entityId) {\r\n            var linkLowered = idCode.toLowerCase();\r\n            if (linkLowered.indexOf(\"file:\") !== -1 || linkLowered.indexOf(\"page:\") !== -1)\r\n                return $http.get(\"dnn/Hyperlink/ResolveHyperlink?hyperlink=\" + encodeURIComponent(idCode));\r\n            return null;\r\n        };\r\n\r\n        return svc;\r\n\r\n    }]);\n\r\n// this is in charge of the iframe which shows the dnn-bridge components\r\n\r\n(function () {\r\n\t\"use strict\";\r\n\r\n\tangular.module(\"sxcFieldTemplates\")\r\n\r\n\r\n    /*@ngInject*/\r\n\t.directive(\"webFormsBridge\", [\"sxc\", \"portalRoot\", function (sxc, portalRoot) {\r\n\t    var webFormsBridgeUrl = portalRoot + \"Default.aspx?tabid=\" + $2sxc.urlParams.require(\"tid\") + \"&ctl=webformsbridge&mid=\" + sxc.id + \"&dnnprintmode=true&SkinSrc=%5bG%5dSkins%2f_default%2fNo+Skin&ContainerSrc=%5bG%5dContainers%2f_default%2fNo+Container\"; //\"&popUp=true\";\r\n\r\n\t\treturn {\r\n\t\t\trestrict: \"A\",\r\n\t\t\tscope: {\r\n\t\t\t\ttype: \"@bridgeType\",\r\n\t\t\t\tbridge: \"=webFormsBridge\",\r\n\t\t\t\tbridgeSyncHeight: \"@bridgeSyncHeight\"\r\n\t\t\t},\r\n\t\t\tlink: function (scope, elem, attrs) {\r\n\r\n\t\t\t    var params = \"\";\r\n\t\t\t    if (scope.bridge.params) {\r\n\t\t\t        params = Object.keys(scope.bridge.params).map(function (prop) {\r\n\t\t\t            if (scope.bridge.params[prop] === null || scope.bridge.params[prop] === '')\r\n\t\t\t                return;\r\n\t\t\t            return [prop, scope.bridge.params[prop]].map(encodeURIComponent).join(\"=\");\r\n\t\t\t        }).join(\"&\");\r\n\t\t\t    }\r\n\r\n\t\t\t    elem[0].src = webFormsBridgeUrl + \"&type=\" + scope.type + (scope.bridge.params ? \"&\" + params : \"\");\r\n\t\t\t\telem.on(\"load\", function () {\t\t\t\t\t\r\n\t\t\t\t    var w = elem[0].contentWindow || elem[0];\r\n                    // test if the connectBridge works, if not, it's usually a telerik-not-installed issue\r\n\t\t\t\t    if (!w.connectBridge)\r\n\t\t\t\t        return alert(\"can't connect to the dialog - you are probably running a new DNN (v.8+) and didn't activate the old Telerik components. Please install these in the host > extensions to get this to work\");\r\n\t\t\t\t    \r\n\t\t\t\t\tw.connectBridge(scope.bridge);\r\n\r\n\t\t\t\t\t// Sync height\r\n\t\t\t\t\tif (scope.bridgeSyncHeight === \"true\") {\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tvar resize = function () {\r\n\t\t\t\t\t\t\telem.css(\"height\", \"\");\r\n\t\t\t\t\t\t\telem.css(\"height\", w.document.body.scrollHeight + \"px\");\r\n\t\t\t\t\t\t};\r\n\r\n\t\t\t\t\t\t//w.$(w).resize(resize); // Performance issues when uncommenting this line...\r\n\t\t\t\t\t\tresize();\r\n\t\t\t\t\t\tw.$(w.document).ready(function() {\r\n\t\t\t\t\t\t\tresize();\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tw.$(w.document).on('triggerbridgeresize', function () {\r\n\t\t\t\t\t\t    window.setTimeout(resize, 0);\r\n\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t};\r\n\t}]);\r\n\r\n})();\n(function() {\r\n    \"use strict\";\r\n\r\n    angular.module(\"sxcFieldTemplates\")\r\n        .config([\"formlyConfigProvider\", \"defaultFieldWrappers\", function (formlyConfigProvider, defaultFieldWrappers) {\r\n\r\n            var wrappers = defaultFieldWrappers.slice(0); // copy the array\r\n            wrappers.splice(defaultFieldWrappers.indexOf(\"eavLocalization\"), 1); // remove the localization...\r\n\r\n            formlyConfigProvider.setType({\r\n                name: \"entity-content-blocks\",\r\n                templateUrl: \"fields/entity/entity-default.html\",\r\n                wrapper: wrappers, // [\"eavLabel\", \"bootstrapHasError\", \"collapsible\"],\r\n                controller: \"FieldTemplate-EntityContentBlockCtrl\"\r\n            });\r\n        }])\r\n        /*@ngInject*/\r\n        .controller(\"FieldTemplate-EntityContentBlockCtrl\", [\"$controller\", \"$scope\", \"$http\", \"$filter\", \"$translate\", \"$uibModal\", \"appId\", \"eavAdminDialogs\", \"eavDefaultValueService\", function($controller, $scope, $http, $filter, $translate, $uibModal, appId, eavAdminDialogs, eavDefaultValueService) {\r\n            $scope.to.settings.merged.EnableRemove = true;\r\n            $scope.to.settings.merged.AllowMultiValue = true; // for correct UI showing \"remove\"\r\n            $scope.to.settings.merged.EnableAddExisting = false; // disable manual select existing\r\n            $scope.to.settings.merged.EnableCreate = false;         // disable manual create\r\n            $scope.to.settings.merged.EnableEdit = false;\r\n            $scope.to.settings.merged.EntityType = \"ContentGroupReference\";\r\n            $scope.to.enableCollapseField = true;   // ui option to allow collapsing\r\n            $scope.to.collapseField = true;   // ui option to allow collapsing\r\n\r\n\r\n            // use \"inherited\" controller just like described in http://stackoverflow.com/questions/18461263/can-an-angularjs-controller-inherit-from-another-controller-in-the-same-module\r\n            $controller(\"FieldTemplate-EntityCtrl\", { $scope: $scope });\r\n\r\n            // do something with the values...\r\n            var vals = $scope.model[$scope.options.key].Values[0].Value;\r\n\r\n            //addCSSRule(\"div\", \"background-color: pink\");\r\n        }]);\r\n\r\n    function addCSSRule(selector, rules, index) {\r\n        var sheet = document.styleSheets[0];\r\n        if (\"insertRule\" in sheet) {\r\n            sheet.insertRule(selector + \"{\" + rules + \"}\", index);\r\n        }\r\n        else if (\"addRule\" in sheet) {\r\n            sheet.addRule(selector, rules, index);\r\n        }\r\n    }\r\n\r\n})();\n\r\n(function() {\r\n    'use strict';\r\n\r\n    angular.module('sxcFieldTemplates')\r\n        .config([\"formlyConfigProvider\", \"fieldWrappersWithPreview\", function (formlyConfigProvider, fieldWrappersWithPreview) {\r\n\r\n            formlyConfigProvider.setType({\r\n                name: 'hyperlink-default',\r\n                templateUrl: 'fields/hyperlink/hyperlink-default.html',\r\n                wrapper: fieldWrappersWithPreview,\r\n                controller: 'FieldTemplate-HyperlinkCtrl as vm'\r\n            });\r\n        }])\r\n        /*@ngInject*/\r\n        .controller('FieldTemplate-HyperlinkCtrl', [\"$uibModal\", \"$scope\", \"$http\", \"sxc\", \"adamSvc\", \"debugState\", \"dnnBridgeSvc\", \"fileType\", function ($uibModal, $scope, $http, sxc, adamSvc, debugState, dnnBridgeSvc, fileType) {\r\n\r\n            var vm = this;\r\n            vm.debug = debugState;\r\n            vm.testLink = '';\r\n\r\n            vm.isImage = function () { return fileType.isImage(vm.testLink); };\r\n            vm.thumbnailUrl = function thumbnailUrl(size, quote) {\r\n                var result = vm.testLink;\r\n                if (size === 1)\r\n                    result = result + '?w=64&h=64&mode=crop';\r\n                if (size === 2)\r\n                    result = result + '?w=500&h=400&mode=max';\r\n                var qt = quote ? '\"' : '';\r\n                return qt + result + qt;\r\n            };\r\n\r\n            vm.icon = function () { return fileType.getIconClass(vm.testLink); };\r\n            vm.tooltipUrl = function (str) { return str.replace(/\\//g, '/&#8203;'); };\r\n            vm.adamModeConfig = {\r\n                usePortalRoot: false\r\n            };\r\n\r\n            function ensureDefaultConfig() {\r\n                var merged = $scope.to.settings.merged;\r\n                if (merged.ShowAdam === undefined || merged.ShowAdam === null) merged.ShowAdam = true;\r\n                if (merged.Buttons === undefined || merged.Buttons === null) merged.Buttons = 'adam,more';\r\n            }\r\n\r\n            ensureDefaultConfig();\r\n\r\n            // Update test-link if necessary - both when typing or if link was set by dialogs\r\n            $scope.$watch('value.Value', function(newValue, oldValue) {\r\n                if (!newValue)\r\n                    return;\r\n\r\n                // handle short-ID links like file:17\r\n                var promise = dnnBridgeSvc.getUrlOfId(newValue);\r\n                if(promise)\r\n                    promise.then(function (result) {\r\n                        if (result.data) \r\n                            vm.testLink = result.data;\r\n                    });\r\n                else \r\n                    vm.testLink = newValue;\r\n            });\r\n\r\n            //#region dnn-page picker dialog\r\n\r\n            // the callback when something was selected\r\n            vm.processResultOfPagePicker = function (value) {\r\n                $scope.$apply(function() {\r\n                    // Convert to page:xyz format (if it wasn't cancelled)\r\n                    if (value)\r\n                        $scope.value.Value = 'page:' + value.id;\r\n                });\r\n            };\r\n\r\n            // open the dialog\r\n            vm.openPageDialog = function () {\r\n                dnnBridgeSvc.open(\r\n                    $scope.value.Value,\r\n                    {\r\n                        Paths: $scope.to.settings.merged ? $scope.to.settings.merged.Paths : '',\r\n                        FileFilter: $scope.to.settings.merged ? $scope.to.settings.merged.FileFilter : ''\r\n                    },\r\n                    vm.processResultOfPagePicker);\r\n            };\r\n            //#endregion dnn page picker\r\n\r\n          //#region new adam: callbacks only\r\n          vm.registerAdam = function(adam) {\r\n              vm.adam = adam;\r\n          };\r\n\r\n          vm.setValue = function (fileItem) {\r\n            // depending on settings, use the id or not\r\n            if ($scope.to.settings.merged.ServerResourceMapping &&\r\n              $scope.to.settings.merged.ServerResourceMapping === 'url')\r\n              $scope.value.Value = fileItem.fullPath // this is the one coming from the adam-browser\r\n                || fileItem.Path; // or the server request\r\n            else\r\n              $scope.value.Value = 'file:' + fileItem.Id;\r\n          };\r\n\r\n            $scope.afterUpload = vm.setValue;   // binding for dropzone\r\n\r\n            vm.toggleAdam = function toggle(usePortalRoot, imagesOnly) {\r\n                \r\n                vm.adam.toggle({\r\n                    showImagesOnly: imagesOnly,\r\n                    usePortalRoot: usePortalRoot\r\n                });\r\n            };\r\n\r\n            //#endregion\r\n\r\n\r\n        }]);\r\n\r\n\r\n})();\n\r\n(function() {\r\n    \"use strict\";\r\n\r\n    angular.module(\"sxcFieldTemplates\")\r\n        .config([\"formlyConfigProvider\", \"defaultFieldWrappersNoFloat\", function (formlyConfigProvider, defaultFieldWrappersNoFloat) {\r\n\r\n            formlyConfigProvider.setType({\r\n                name: \"hyperlink-library\",\r\n                templateUrl: \"fields/hyperlink/hyperlink-library.html\",\r\n                // todo: check if we could use the defaultFieldWrappers instead\r\n                wrapper: defaultFieldWrappersNoFloat,// [\"eavLabel\", \"bootstrapHasError\", \"eavLocalization\", \"collapsible\"],\r\n                controller: \"FieldTemplate-Library as vm\"\r\n            });\r\n\r\n        }])\r\n        /*@ngInject*/\r\n        .controller(\"FieldTemplate-Library\", [\"$uibModal\", \"$scope\", \"$http\", \"sxc\", \"adamSvc\", \"debugState\", function ($uibModal, $scope, $http, sxc, adamSvc, debugState) {\r\n\r\n            var vm = this;\r\n            vm.debug = debugState;\r\n            vm.modalInstance = null;\r\n            vm.testLink = \"\";\r\n\r\n            vm.adamModeConfig = {\r\n                usePortalRoot: false\r\n            };\r\n\r\n            //#region new adam: callbacks only\r\n            vm.registerAdam = function(adam) {\r\n                vm.adam = adam;\r\n            };\r\n            //vm.setValue = function(url) {\r\n            //    $scope.value.Value = url;\r\n            //};\r\n            $scope.afterUpload = function(fileItem) {};\r\n\r\n            vm.toggleAdam = function toggle() {\r\n                vm.adam.toggle();\r\n            };\r\n\r\n            //#endregion\r\n\r\n\r\n        }]);\r\n\r\n\r\n})();\n/*!\r\nMath.uuid.js (v1.4)\r\nhttp://www.broofa.com\r\nmailto:robert@broofa.com\r\n\r\nCopyright (c) 2010 Robert Kieffer\r\nDual licensed under the MIT and GPL licenses.\r\n*/\r\n\r\n/*\r\n * Generate a random uuid.\r\n *\r\n * USAGE: Math.uuid(length, radix)\r\n *   length - the desired number of characters\r\n *   radix  - the number of allowable values for each character.\r\n *\r\n * EXAMPLES:\r\n *   // No arguments  - returns RFC4122, version 4 ID\r\n *   >>> Math.uuid()\r\n *   \"92329D39-6F5C-4520-ABFC-AAB64544E172\"\r\n *\r\n *   // One argument - returns ID of the specified length\r\n *   >>> Math.uuid(15)     // 15 character ID (default base=62)\r\n *   \"VcydxgltxrVZSTV\"\r\n *\r\n *   // Two arguments - returns ID of the specified length, and radix. (Radix must be <= 62)\r\n *   >>> Math.uuid(8, 2)  // 8 character ID (base=2)\r\n *   \"01001010\"\r\n *   >>> Math.uuid(8, 10) // 8 character ID (base=10)\r\n *   \"47473046\"\r\n *   >>> Math.uuid(8, 16) // 8 character ID (base=16)\r\n *   \"098F4D35\"\r\n */\r\n(function () {\r\n    // Private array of chars to use\r\n    var CHARS = '0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz'.split('');\r\n\r\n    Math.uuid = function (len, radix) {\r\n        var chars = CHARS, uuid = [], i;\r\n        radix = radix || chars.length;\r\n\r\n        if (len) {\r\n            // Compact form\r\n            for (i = 0; i < len; i++) uuid[i] = chars[0 | Math.random() * radix];\r\n        } else {\r\n            // rfc4122, version 4 form\r\n            var r;\r\n\r\n            // rfc4122 requires these characters\r\n            uuid[8] = uuid[13] = uuid[18] = uuid[23] = '-';\r\n            uuid[14] = '4';\r\n\r\n            // Fill in random data.  At i==19 set the high bits of clock sequence as\r\n            // per rfc4122, sec. 4.1.5\r\n            for (i = 0; i < 36; i++) {\r\n                if (!uuid[i]) {\r\n                    r = 0 | Math.random() * 16;\r\n                    uuid[i] = chars[(i == 19) ? (r & 0x3) | 0x8 : r];\r\n                }\r\n            }\r\n        }\r\n\r\n        return uuid.join('');\r\n    };\r\n\r\n    // A more performant, but slightly bulkier, RFC4122v4 solution.  We boost performance\r\n    // by minimizing calls to random()\r\n    Math.uuidFast = function () {\r\n        var chars = CHARS, uuid = new Array(36), rnd = 0, r;\r\n        for (var i = 0; i < 36; i++) {\r\n            if (i == 8 || i == 13 || i == 18 || i == 23) {\r\n                uuid[i] = '-';\r\n            } else if (i == 14) {\r\n                uuid[i] = '4';\r\n            } else {\r\n                if (rnd <= 0x02) rnd = 0x2000000 + (Math.random() * 0x1000000) | 0;\r\n                r = rnd & 0xf;\r\n                rnd = rnd >> 4;\r\n                uuid[i] = chars[(i == 19) ? (r & 0x3) | 0x8 : r];\r\n            }\r\n        }\r\n        return uuid.join('');\r\n    };\r\n\r\n    // A more compact, but less performant, RFC4122v4 solution:\r\n    Math.uuidCompact = function () {\r\n        return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {\r\n            var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);\r\n            return v.toString(16);\r\n        });\r\n    };\r\n})();\n/* \r\n * Field: String - font-icon picker\r\n */\r\n\r\nangular.module(\"sxcFieldTemplates\")\r\n    .config([\"formlyConfigProvider\", \"fieldWrappersWithPreview\", function (formlyConfigProvider, fieldWrappersWithPreview) {\r\n\r\n        formlyConfigProvider.setType({\r\n            name: \"string-font-icon-picker\",\r\n            templateUrl: \"fields/string/string-font-icon-picker.html\",\r\n            wrapper: fieldWrappersWithPreview,\r\n            controller: \"FieldTemplate-String-Font-Icon-Picker as vm\"\r\n        });\r\n\r\n    }])\r\n    /*@ngInject*/\r\n    .controller(\"FieldTemplate-String-Font-Icon-Picker\", [\"$scope\", \"debugState\", \"$ocLazyLoad\", \"appRoot\", function ($scope, debugState, $ocLazyLoad, appRoot) {\r\n        var vm = angular.extend(this, {\r\n            iconFilter: \"\", // used for in-line search\r\n            prefix: \"\", // used to find the right css-classes\r\n            previewPrefix: \"\", // used to preview the icon, in addition to the built-in class\r\n            icons: [], // list of icons, to be filled\r\n            useTestValues: false, // to prefill with test-values, in case needed\r\n            selectorIsOpen: false\r\n    });\r\n\r\n\r\n        //#region icon css-class-methods\r\n        function getIconClasses(className) {\r\n            var charcount = className.length, foundList = [], duplicateDetector = {};\r\n            if (!className) return foundList;\r\n            for (var ssSet = 0; ssSet < document.styleSheets.length; ssSet++) {\r\n                var classes = document.styleSheets[ssSet].rules || document.styleSheets[ssSet].cssRules;\r\n                if(classes)\r\n                    for (var x = 0; x < classes.length; x++)\r\n                        if (classes[x].selectorText && classes[x].selectorText.substring(0, charcount) === className) {\r\n                            // prevent duplicate-add...\r\n                            var txt = classes[x].selectorText,\r\n                                icnClass = txt.substring(0, txt.indexOf(\":\")).replace(\".\", \"\");\r\n                            if (!duplicateDetector[icnClass]) {\r\n                                foundList.push({ rule: classes[x], 'class': icnClass });\r\n                                duplicateDetector[icnClass] = true;\r\n                            }\r\n                        }\r\n            }\r\n            return foundList;\r\n        }\r\n\r\n//#endregion\r\n\r\n        //#region load additional resources\r\n        function loadAdditionalResources(files) {\r\n            files = files || \"\";\r\n            var mapped = files.replace(\"[App:Path]\", appRoot)\r\n                .replace(/([\\w])\\/\\/([\\w])/g,   // match any double // but not if part of https or just \"//\" at the beginning\r\n                \"$1/$2\");\r\n            var fileList = mapped ? mapped.split(\"\\n\") : [];\r\n            return $ocLazyLoad.load(fileList);\r\n        }\r\n        //#endregion\r\n\r\n        vm.setIcon = function(newValue) {\r\n            $scope.value.Value = newValue;\r\n            vm.selectorIsOpen = false;\r\n            //$scope.status.isopen = false;\r\n            $scope.form.$setDirty();\r\n        };\r\n\r\n        vm.activate = function() {\r\n            // get configured\r\n            var controlSettings = $scope.to.settings[\"string-font-icon-picker\"];\r\n            vm.files = (controlSettings) ? controlSettings.Files || \"\" : \"\";\r\n            vm.prefix = (controlSettings) ? controlSettings.CssPrefix || \"\" : \"\";\r\n            vm.previewPrefix = (controlSettings) ? controlSettings.PreviewCss || \"\" : \"\";\r\n\r\n            if (vm.useTestValues)\r\n                angular.extend(vm, {\r\n                    iconFilter: \"\",\r\n                    prefix: \".glyphicon-\",\r\n                    previewPrefix: \"glyphicon\",\r\n                });\r\n\r\n            // load all additional css, THEN load the icons\r\n            loadAdditionalResources(vm.files).then(function() {\r\n                // load the icons\r\n                vm.icons = getIconClasses(vm.prefix);\r\n\r\n            });\r\n\r\n            vm.debug = debugState;\r\n            if (debugState.on) console.log($scope.options.templateOptions);\r\n        };\r\n\r\n        vm.activate();\r\n    }]);\n// This isn't fully nice, but it's the code used by the template picker elements\r\n// it's outsourced here, to ensure that code revisions are clear and api consistent\r\n// because the previous version had the code inside the field-config\r\n// and was highly dependent on the angular/formly API, which changes a bit from time to time\r\n// this makes it easier to keep it in sync\r\n\r\n// I'll have to think of a better way to provide/inject this in the future...\r\n\r\n// must find out if we're in App or Content before we do more...\r\n\r\n(function () {\r\n    var cs = {\r\n        init: function(context) {\r\n            cs.context = context;\r\n\r\n            // get angular injector to get a service\r\n            var inj = context.$injector;\r\n\r\n            var appDialogConfigSvc = inj.get(\"appDialogConfigSvc\");\r\n\r\n            appDialogConfigSvc.getDialogSettings().then(function(result) {\r\n                var config = result.data;\r\n                // if this is a content-app, disable two fields\r\n                if (config.IsContent) {\r\n                    //disable current field\r\n                    context.formVm.formFields[context.field.SortOrder].templateOptions.disabled = true;\r\n                    // do the same for the data-field (field 20)\r\n                    context.formVm.formFields[20].templateOptions.disabled = true;\r\n                }\r\n            });\r\n\r\n        }\r\n    };\r\n\r\n    window[\"2sxc-template-picker-custom-script-for-name-field\"] = cs;\r\n})();\n/* \r\n * Field: String - Dropdown\r\n */\r\n\r\nangular.module(\"sxcFieldTemplates\")\r\n    .config([\"formlyConfigProvider\", \"defaultFieldWrappers\", function(formlyConfigProvider, defaultFieldWrappers) {\r\n\r\n        formlyConfigProvider.setType({\r\n            name: \"string-template-picker\",\r\n            templateUrl: \"fields/string/string-template-picker.html\",\r\n            wrapper: defaultFieldWrappers,\r\n            controller: \"FieldTemplate-String-TemplatePicker\"\r\n        });\r\n\r\n    }])\r\n    /*@ngInject*/\r\n    .controller(\"FieldTemplate-String-TemplatePicker\", [\"$scope\", \"appAssetsSvc\", \"appId\", \"fieldMask\", function ($scope, appAssetsSvc, appId, fieldMask) {\r\n\r\n        function activate() {\r\n            // ensure settings are merged\r\n            if (!$scope.to.settings.merged)\r\n                $scope.to.settings.merged = {};\r\n\r\n            $scope.setFileConfig(\"Token\"); // use token setting as default, till the UI tells us otherwise\r\n\r\n            // clean up existing paths, because some used \"/\" and some \"\\\" for paths, so it wouldn't match in the drop-down\r\n            if ($scope.options && $scope.options.value())\r\n                angular.forEach($scope.options.value().Values, function(v, i) {\r\n                    v.Value = v.Value.replace(\"\\\\\", \"/\");\r\n                });\r\n            \r\n\r\n            // set change-watchers to the other values\r\n            $scope.typeWatcher = fieldMask(\"[Type]\", $scope, $scope.setFileConfig);\r\n            $scope.locWatcher = fieldMask(\"[Location]\", $scope, $scope.onLocationChange);\r\n\r\n            // create initial list for binding\r\n            $scope.templates = [];\r\n\r\n            $scope.svcApp = appAssetsSvc(appId, false);\r\n            $scope.svcGlobal = appAssetsSvc(appId, true);\r\n\r\n            $scope.onLocationChange(); // set initial file list\r\n            //$scope.templates = $scope.svcApp.liveList();\r\n        }\r\n\r\n        $scope.readyToUse = function() {\r\n            return $scope.typeWatcher.value && $scope.locWatcher.value; // check if these have real values inside\r\n        };\r\n\r\n        $scope.setFileConfig = function (type) {\r\n            var specs = {\r\n                \"Token\": { ext: \".html\", prefix: \"\", suggestion: \"yourfile.html\", body: \"<p>You successfully created your own template. Start editing it by hovering the \\\"Manage\\\" button and opening the \\\"Edit Template\\\" dialog.</p>\" },\r\n                \"C# Razor\": { ext: \".cshtml\", prefix: \"_\", suggestion: \"_yourfile.cshtml\", body: \"<p>You successfully created your own template. Start editing it by hovering the \\\"Manage\\\" button and opening the \\\"Edit Template\\\" dialog.</p>\" }\r\n            };\r\n            $scope.file = specs[type];\r\n\r\n        };\r\n\r\n        // when the watcher says the location changed, reset stuff\r\n        $scope.onLocationChange = function(loc) {\r\n            $scope.svcCurrent = (loc === \"Host File System\") \r\n                ? $scope.svcGlobal\r\n                : $scope.svcApp;\r\n\r\n            $scope.templates = $scope.svcCurrent.liveList();\r\n        };\r\n\r\n        // ask for a new file name and \r\n        $scope.add = function() {\r\n            var fileName = prompt(\"enter new file name\", $scope.file.suggestion); // todo: i18n\r\n\r\n            if (!fileName)\r\n                return;\r\n\r\n            // 1. check for folders\r\n            var path = \"\";\r\n            fileName = fileName.replace(\"\\\\\", \"/\");\r\n            var foundSlash = fileName.lastIndexOf(\"/\");\r\n            if (foundSlash > -1) {\r\n                path = fileName.substring(0, foundSlash + 1); // path with slash\r\n                fileName = fileName.substring(foundSlash + 1);\r\n            }\r\n\r\n            // 2. check if extension already provided, otherwise or if not perfect, just attach default\r\n            if (!fileName.endsWith($scope.file.ext))// fileName.indexOf($scope.fileExt) !== fileName.length - $scope.fileExt.length)\r\n                fileName += $scope.file.ext;\r\n\r\n            // 3. check if cshtmls have a \"_\" in the file name (not folder, must be the file name part)\r\n            if ($scope.file.prefix !== \"\" && fileName[0] !== $scope.file.prefix)\r\n                fileName = $scope.file.prefix + fileName;\r\n\r\n            var fullPath = path + fileName;\r\n            console.log(fullPath);\r\n\r\n            // 4. tell service to create it\r\n            $scope.svcCurrent.create(fullPath, $scope.file.body)\r\n                .then(function() {\r\n                    $scope.value.Value = fullPath; // set the dropdown to the new file\r\n                });\r\n        };\r\n\r\n        activate();\r\n\r\n    }])\r\n\r\n    // filter to only show files which are applicable to this\r\n    .filter(\"isValidFile\", function() {\r\n\r\n        // Create the return function\r\n        // set the required parameter name to **number**\r\n        return function(paths, ext) {\r\n            var out = [];\r\n            angular.forEach(paths, function(path) {\r\n                if (path.slice(path.length - ext.length) === ext)\r\n                    out.push(path);\r\n            });\r\n            return out;\r\n        };\r\n    });\r\n\n\r\n(function () {\r\n\t\"use strict\";\r\n\r\n\t/* This app registers all field templates for 2sxc in the angularjs sxcFieldTemplates app */\r\n\r\n    angular.module(\"sxcFieldTemplates\")\r\n        .config([\"formlyConfigProvider\", function(formlyConfigProvider) {\r\n\r\n            // for now identical with -adv, but later will change\r\n            formlyConfigProvider.setType({\r\n                name: \"string-wysiwyg-adv\",\r\n                templateUrl: \"fields/string/string-wysiwyg-adv.html\",\r\n                // todo: check if we could use the defaultFieldWrappers instead\r\n                wrapper: [\"eavLabel\", \"bootstrapHasError\", \"eavLocalization\", \"collapsible\"]\r\n            });\r\n\r\n\r\n        }]);\r\n\r\n})();\n\r\n(function () {\r\n\t\"use strict\";\r\n\r\n\t/* This app registers all field templates for 2sxc in the angularjs sxcFieldTemplates app */\r\n\r\n\tangular.module(\"sxcFieldTemplates\")\r\n\r\n    .config([\"formlyConfigProvider\", function (formlyConfigProvider) {\r\n\r\n        // for now identical with -adv, but later will change\r\n\t\tformlyConfigProvider.setType({\r\n\t\t\tname: \"string-wysiwyg-dnn\",\r\n\t\t\ttemplateUrl: \"fields/string/string-wysiwyg-dnn.html\",\r\n\t\t    // todo: check if we could use the defaultFieldWrappers instead\r\n\t\t\twrapper: [\"eavLabel\", \"bootstrapHasError\", \"eavLocalization\", \"collapsible\"],\r\n\t\t\tcontroller: \"FieldTemplate-WysiwygCtrl as vm\"\r\n\t\t});\r\n\r\n        \r\n\t}])\r\n\r\n\r\n    /*@ngInject*/\r\n\t.controller(\"FieldTemplate-WysiwygCtrl\", [\"$scope\", function ($scope) {\r\n\r\n\t\tvar vm = this;\r\n\r\n\t\t// Everything the WebForms bridge (iFrame) should have access to\r\n\t\tvm.bridge = {\r\n\t\t    initialValue: \"\",\r\n            initialReadOnly: false,\r\n\t\t    onChanged: function (newValue) {\r\n\t\t\t\t$scope.$apply(function () {\r\n\t\t\t\t\t$scope.value.Value = newValue;\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\tsetValue: function (value) { vm.bridge.initialValue = value; },\r\n\t\t\tsetReadOnly: function(readOnly) { vm.bridge.initialReadOnly = readOnly; }\r\n\t\t};\r\n\r\n\t\t$scope.$watch(\"value.Value\", function (newValue, oldValue) {\r\n\t\t\tif (newValue !== oldValue)\r\n\t\t\t\tvm.bridge.setValue(newValue);\r\n\t\t});\r\n\r\n\t\t$scope.$watch(\"to.disabled\", function (newValue, oldValue) {\r\n\t\t\tif (newValue !== oldValue)\r\n\t\t\t\tvm.bridge.setReadOnly(newValue);\r\n\t\t});\r\n\r\n\t}]);\r\n\r\n\r\n})();\n\r\n(function () {\r\n\t\"use strict\";\r\n\r\n    // Register in Angular Formly\r\n    FieldWysiwygTinyMceController.$inject = [\"$scope\", \"languages\", \"tinyMceHelpers\", \"tinyMceToolbars\", \"tinyMceConfig\", \"tinyMceAdam\", \"tinyMceDnnBridge\"];\r\n    angular.module(\"sxcFieldTemplates\")\r\n        .config([\"formlyConfigProvider\", \"defaultFieldWrappers\", function (formlyConfigProvider, defaultFieldWrappers) {\r\n            formlyConfigProvider.setType({\r\n                name: \"string-wysiwyg-tinymce\",\r\n                templateUrl: \"fields/string/string-wysiwyg-tinymce.html\",\r\n                wrapper: defaultFieldWrappers, \r\n                controller: \"FieldWysiwygTinyMce as vm\"\r\n            });\r\n        }])\r\n\r\n        .controller(\"FieldWysiwygTinyMce\", FieldWysiwygTinyMceController);\r\n\r\n    /*@ngInject*/\r\n    function FieldWysiwygTinyMceController($scope, languages, tinyMceHelpers, tinyMceToolbars, tinyMceConfig, tinyMceAdam, tinyMceDnnBridge) {\r\n        var vm = this;\r\n        vm.enableContentBlocks = true;\r\n\r\n        var settings = {\r\n            enableContentBlocks : false\r\n        };\r\n\r\n        vm.adamModeConfig = {\r\n            usePortalRoot: false\r\n        };\r\n\r\n        vm.activate = function () {\r\n\r\n            enableContentBlocksIfPossible(settings);\r\n\r\n            // initialize options and wire-up init-callback\r\n            $scope.tinymceOptions = angular.extend(tinyMceConfig.getDefaultOptions(settings), {\r\n                setup: tinyMceInitCallback\r\n            });\r\n\r\n            // add ADAM definition, so that the callback will be able to link up to this\r\n            tinyMceAdam.attachAdam(vm, $scope);\r\n\r\n            // add DNN Bridge, needed for webforms dnn-dialogs\r\n            tinyMceDnnBridge.attach(vm, $scope);\r\n\r\n            // check if it's an additionally translated language and load the translations\r\n            var lang2 = /* \"de\" */ languages.currentLanguage.substr(0, 2);\r\n            if (tinyMceConfig.languages.indexOf(lang2) >= 0)\r\n                angular.extend($scope.tinymceOptions, {\r\n                    language: lang2,\r\n                    language_url: \"../i18n/lib/tinymce/\" + lang2 + \".js\"\r\n                });\r\n\r\n            watchDisabled($scope);\r\n        };\r\n        vm.activate();\r\n\r\n        // callback event which tinyMce will execute when it's built the editor\r\n        function tinyMceInitCallback(editor) {\r\n            vm.editor = editor;\r\n            if ($scope.tinymceOptions.language)\r\n                tinyMceHelpers.addTranslations(editor, $scope.tinymceOptions.language);\r\n\r\n            tinyMceToolbars.addButtons(vm);\r\n            tinyMceAdam.addButtons(vm);\r\n\r\n            enableContentBlocksIfPossible(editor);\r\n        }\r\n\r\n        function watchDisabled(ngscope) {\r\n            // Monitor for changes on Disabled\r\n            ngscope.$watch(\"to.disabled\", function(newValue, oldValue) {\r\n                if (newValue !== oldValue && vm.editor !== null) {\r\n                    ngscope.tinymceOptions.readonly = newValue;\r\n                    ngscope.$broadcast(\"$tinymce:refresh\"); // Refresh tinymce instance to pick-up new readonly value\r\n                }\r\n            });\r\n        }\r\n\r\n        function enableContentBlocksIfPossible(settings) {\r\n            // quit if there are no following fields\r\n            if ($scope.fields.length === $scope.index + 1)\r\n                return;\r\n\r\n            var nextField = $scope.fields[$scope.index + 1];\r\n            if (nextField.type === \"entity-content-blocks\")\r\n                settings.enableContentBlocks = true;\r\n        }\r\n    }\r\n\r\n\r\n\r\n})();\r\n\r\n\r\n\nangular.module('sxcFieldTemplates')\r\n    /*@ngInject*/\r\n    .factory('tinyMceAdam', function () {\r\n        return {\r\n            attachAdam: attachAdam,\r\n            addButtons: addAdamButtons\r\n        };\r\n\r\n        function attachAdam(vm, $scope) {\r\n            vm.registerAdam = function (adam) {\r\n                vm.adam = adam;\r\n            };\r\n\r\n            vm.setValue = function (fileItem, modeImage) {\r\n              if (modeImage === undefined) // if not supplied, use the setting in the adam\r\n                modeImage = vm.adamModeImage;\r\n              var fileName = fileItem.Name.substr(0, fileItem.Name.lastIndexOf('.'));\r\n              vm.editor.insertContent(modeImage\r\n                ? '<img src=\"' + fileItem.fullPath + '\" + alt=\"' + fileName + '\">'\r\n                : '<a href=\"' + fileItem.fullPath + '\">' + fileName + '</a>');\r\n            };\r\n\r\n            // this is the event called by dropzone as something is dropped\r\n            $scope.afterUpload = function (fileItem) {\r\n                // debugger;\r\n                vm.setValue(fileItem, fileItem.Type === 'image');\r\n            };\r\n\r\n            vm.toggleAdam = function toggle(imagesOnly, usePortalRoot) {\r\n                vm.adamModeImage = imagesOnly;\r\n                vm.adam.toggle({\r\n                    showImagesOnly: imagesOnly,\r\n                    usePortalRoot: usePortalRoot\r\n                });\r\n                $scope.$apply();\r\n            };\r\n        }\r\n\r\n        function addAdamButtons(vm) {\r\n            var e = vm.editor;\r\n            // group with adam-link, dnn-link\r\n            e.addButton('linkfiles', {\r\n                type: 'splitbutton',\r\n                icon: ' eav-icon-file-pdf',\r\n                title: 'Link.AdamFile.Tooltip',\r\n                onclick: function () {\r\n                    vm.toggleAdam(false);\r\n                },\r\n                menu: [\r\n                    {\r\n                        text: 'Link.AdamFile',\r\n                        tooltip: 'Link.AdamFile.Tooltip',\r\n                        icon: ' eav-icon-file-pdf',\r\n                        onclick: function () {\r\n                            vm.toggleAdam(false, false);\r\n                        }\r\n                    }, {\r\n                        text: 'Link.DnnFile',\r\n                        tooltip: 'Link.DnnFile.Tooltip',\r\n                        icon: ' eav-icon-file',\r\n                        onclick: function () {\r\n                            vm.toggleAdam(false, true);\r\n                        }\r\n                    }\r\n                ]\r\n            });\r\n\r\n\r\n            // group with images (adam) - only in PRO mode\r\n            e.addButton('images', {\r\n                type: 'splitbutton',\r\n                text: '',\r\n                icon: 'image',\r\n                onclick: function () {\r\n                    vm.toggleAdam(true);\r\n                },\r\n                menu: [\r\n                    {\r\n                        text: 'Image.AdamImage',\r\n                        tooltip: 'Image.AdamImage.Tooltip',\r\n                        icon: 'image',\r\n                        onclick: function () { vm.toggleAdam(true); }\r\n                    }, {\r\n                        text: 'Image.DnnImage',\r\n                        tooltip: 'Image.DnnImage.Tooltip',\r\n                        icon: 'image',\r\n                        onclick: function () { vm.toggleAdam(true, true); }\r\n                    }, {\r\n                        text: 'Insert\\/edit image', // i18n tinyMce standard\r\n                        icon: 'image',\r\n                        onclick: function () { e.execCommand('mceImage'); }\r\n\r\n                    },\r\n                    // note: all these use i18n from tinyMce standard\r\n                    { icon: 'alignleft', tooltip: 'Align left', onclick: function () { e.execCommand('JustifyLeft'); } },\r\n                    { icon: 'aligncenter', tooltip: 'Align center', onclick: function () { e.execCommand('JustifyCenter'); } },\r\n                    { icon: 'alignright', tooltip: 'Align right', onclick: function () { e.execCommand('JustifyRight'); } }\r\n                ]\r\n            });\r\n\r\n        }\r\n    });\nangular.module(\"sxcFieldTemplates\")\r\n    /*@ngInject*/\r\n    .factory(\"tinyMceConfig\", [\"beta\", function (beta) {\r\n        var svc = {\r\n            // cdn root\r\n            cdnRoot: \"//cdn.tinymce.com/4\",\r\n            // these are the sizes we can auto-resize to\r\n            imgSizes: [100, 75, 70, 66, 60, 50, 40, 33, 30, 25, 10],\r\n\r\n            // the default language, in which we have all labels/translations\r\n            defaultLanguage: \"en\",\r\n\r\n            // all other languages\r\n            languages: \"de,es,fr,it,uk,nl\".split(\",\"),\r\n\r\n            // tinyMCE plugins we're using\r\n            plugins: [\r\n                \"code\", // allow view / edit source\r\n                \"contextmenu\", // right-click menu for things like insert, etc.\r\n                \"autolink\", // automatically convert www.xxx links to real links\r\n                \"tabfocus\", // get in an out of the editor with tab\r\n                \"image\", // image button and image-settings\r\n                \"link\", // link button + ctrl+k to add link\r\n                // \"autosave\",     // temp-backups the content in case the browser crashes, allows restore\r\n                \"paste\", // enables paste as text from word etc. https://www.tinymce.com/docs/plugins/paste/\r\n                \"anchor\", // allows users to set an anchor inside the text\r\n                \"charmap\", // character map https://www.tinymce.com/docs/plugins/visualchars/\r\n                \"hr\", // hr\r\n                \"media\", // video embed\r\n                \"nonbreaking\", // add button to insert &nbsp; https://www.tinymce.com/docs/plugins/nonbreaking/\r\n                \"searchreplace\", // search/replace https://www.tinymce.com/docs/plugins/searchreplace/\r\n                \"table\", // https://www.tinymce.com/docs/plugins/searchreplace/\r\n                \"lists\", // should fix bug with fonts in list-items (https://github.com/tinymce/tinymce/issues/2330),\r\n                \"textpattern\" // enable typing like \"1. text\" to create lists etc.\r\n            ],\r\n            \r\n            validateAlso: '@[class]' // allow classes on all elements, \r\n                    + ',i' // allow i elements (allows icon-font tags like <i class=\"fa fa-...\">)\r\n                    + \",hr[sxc|guid]\" // experimental: allow inline content-blocks\r\n        };\r\n\r\n        function buildModes(settings) {\r\n            // the WYSIWYG-modes we offer, standard with simple toolbar and advanced with much more\r\n            modes = {\r\n                standard: {\r\n                    menubar: false,\r\n                    toolbar: \" undo redo removeformat \"\r\n                        + \"| bold formatgroup \"\r\n                        + \"| h1 h2 hgroup \"\r\n                        + \"| listgroup \"\r\n                        + \"| linkfiles linkgroup \"\r\n                        + \"| \" + (settings.enableContentBlocks ? \" addcontentblock \" : \"\")+ \"modeadvanced \",\r\n                    contextmenu: \"charmap hr\" + (settings.enableContentBlocks ? \" addcontentblock\" : \"\")\r\n                },\r\n                advanced: {\r\n                    menubar: true,\r\n                    toolbar: \" undo redo removeformat \"\r\n                        + \"| styleselect \"\r\n                        + \"| bold italic \"\r\n                        + \"| h1 h2 hgroup \"\r\n                        + \"| bullist numlist outdent indent \"\r\n                        + \"| images linkfiles linkgrouppro \"\r\n                        + \"| code modestandard \",\r\n                    contextmenu: \"link image | charmap hr adamimage\"\r\n                }\r\n            };\r\n            return modes;\r\n        }\r\n\r\n        svc.getDefaultOptions = function (settings) {\r\n            var modes = buildModes(settings);\r\n            return {\r\n                baseURL: svc.cdnRoot,\r\n                inline: true, // use the div, not an iframe\r\n                automatic_uploads: false, // we're using our own upload mechanism\r\n                modes: modes, // for later switch to another mode\r\n                menubar: modes.standard.menubar, // basic menu (none)\r\n                toolbar: modes.standard.toolbar, // basic toolbar\r\n                plugins: svc.plugins.join(\" \"),\r\n                contextmenu: modes.standard.contextmenu, //\"link image | charmap hr adamimage\",\r\n                autosave_ask_before_unload: false,\r\n                paste_as_text: true,\r\n                extended_valid_elements: svc.validateAlso,\r\n                //'@[class]' // allow classes on all elements, \r\n                //+ ',i' // allow i elements (allows icon-font tags like <i class=\"fa fa-...\">)\r\n                //+ \",hr[sxc|guid]\", // experimental: allow inline content-blocks\r\n                custom_elements: \"hr\",\r\n\r\n                // Url Rewriting in images and pages\r\n                //convert_urls: false,  // don't use this, would keep the domain which is often a test-domain\r\n                relative_urls: false, // keep urls with full path so starting with a \"/\" - otherwise it would rewrite them to a \"../../..\" syntax\r\n                default_link_target: \"_blank\", // auto-use blank as default link-target\r\n                object_resizing: false, // don't allow manual scaling of images\r\n\r\n                // General looks\r\n                skin: \"lightgray\",\r\n                theme: \"modern\",\r\n                // statusbar: true,    // doesn't work in inline :(\r\n\r\n                language: svc.defaultLanguage,\r\n\r\n                debounce: false // DONT slow-down model updates - otherwise we sometimes miss the last changes\r\n            };\r\n        };\r\n\r\n        return svc;\r\n    }]);\nangular.module(\"sxcFieldTemplates\")\r\n    /*@ngInject*/\r\n    .factory(\"tinyMceDnnBridge\", [\"dnnBridgeSvc\", function (dnnBridgeSvc) {\r\n        return {\r\n            attach: attach\r\n        };\r\n\r\n        function attach(vm, $scope) {\r\n\r\n            // the callback when something was selected\r\n            vm.processResultOfDnnBridge = function (value) {\r\n                $scope.$apply(function () {\r\n                    if (!value) return;\r\n\r\n                    var previouslySelected = vm.editor.selection.getContent();\r\n                    \r\n                    var promise = dnnBridgeSvc.getUrlOfId(\"page:\" + (value.id || value.FileId)); // id on page, FileId on file\r\n                    return promise.then(function (result) {\r\n                        vm.editor.insertContent(\"<a href=\\\"\" + result.data + \"\\\">\" + (previouslySelected || value.name) + \"</a>\");\r\n                    });\r\n\r\n                });\r\n            };\r\n\r\n            // open the dialog - note: strong dependency on the buttons, not perfect here\r\n            vm.openDnnDialog = function (type) {\r\n                dnnBridgeSvc.open(\"\", { Paths: null, FileFilter: null }, vm.processResultOfDnnBridge);\r\n            };\r\n\r\n        }\r\n\r\n    }]);\nangular.module(\"sxcFieldTemplates\")\r\n    /*@ngInject*/\r\n    .factory(\"tinyMceHelpers\", [\"$translate\", \"tinyMceConfig\", function ($translate, tinyMceConfig) {\r\n        var svc = {\r\n            addTranslations: initLangResources\r\n        };\r\n\r\n        // Initialize the tinymce resources which we translate ourselves\r\n        function initLangResources(editor, language) {\r\n            var primaryLan = tinyMceConfig.defaultLanguage;\r\n            var keys = [], mceTranslations = {}, prefix = \"Extension.TinyMce.\", pLen = prefix.length;\r\n\r\n            // find all relevant keys by querying the primary language\r\n            var all = $translate.getTranslationTable(primaryLan);\r\n            // ReSharper disable once MissingHasOwnPropertyInForeach\r\n            for (var key in all)\r\n                if (key.indexOf(prefix) === 0)\r\n                    keys.push(key);\r\n\r\n            var translations = $translate.instant(keys);\r\n\r\n            for (var k = 0; k < keys.length; k++)\r\n                mceTranslations[keys[k].substring(pLen)] = translations[keys[k]];\r\n            tinymce.addI18n(language, mceTranslations);\r\n        }\r\n        return svc;\r\n    }]);\nangular.module(\"sxcFieldTemplates\")\r\n    /*@ngInject*/\r\n    .factory(\"tinyMceToolbars\", [\"tinyMceConfig\", function (tinyMceConfig) {\r\n        var svc = {\r\n            addButtons: addTinyMceToolbarButtons\r\n        };\r\n\r\n        function addTinyMceToolbarButtons(vm) {\r\n            var editor = vm.editor;\r\n            //#region helpers like initOnPostRender(name)\r\n\r\n            // helper function to add activate/deactivate to buttons like alignleft, alignright etc.\r\n            function initOnPostRender(name) { // copied/modified from https://github.com/tinymce/tinymce/blob/ddfa0366fc700334f67b2c57f8c6e290abf0b222/js/tinymce/classes/ui/FormatControls.js#L232-L249\r\n                return function () {\r\n                    var self = this; // keep ref to the current button?\r\n\r\n                    function watchChange() {\r\n                        editor.formatter.formatChanged(name, function (state) {\r\n                            self.active(state);\r\n                        });\r\n                    }\r\n\r\n                    if (editor.formatter)\r\n                        watchChange();\r\n                    else\r\n                        editor.on(\"init\", watchChange());\r\n                };\r\n            }\r\n\r\n            //#endregion\r\n\r\n            //#region register formats\r\n\r\n            // the method that will register all formats - like img-sizes\r\n            function registerTinyMceFormats(editor, vm) {\r\n                var imgformats = {};\r\n                for (var is = 0; is < tinyMceConfig.imgSizes.length; is++)\r\n                    imgformats[\"imgwidth\" + tinyMceConfig.imgSizes[is]] = [{ selector: \"img\", collapsed: false, styles: { 'width': tinyMceConfig.imgSizes[is] + \"%\" } }];\r\n                editor.formatter.register(imgformats);\r\n            }\r\n\r\n            // call register once the editor-object is ready\r\n            editor.on('init', function () {\r\n                registerTinyMceFormats(editor, vm);\r\n            });\r\n\r\n            //#endregion\r\n\r\n            //// group with adam-link, dnn-link\r\n            //editor.addButton(\"linkfiles\", {\r\n            //    type: \"splitbutton\",\r\n            //    icon: \" eav-icon-file-pdf\",\r\n            //    title: \"Link.AdamFile.Tooltip\",\r\n            //    onclick: function () {\r\n            //        vm.toggleAdam(false);\r\n            //    },\r\n            //    menu: [\r\n            //        {\r\n            //            text: \"Link.AdamFile\",\r\n            //            tooltip: \"Link.AdamFile.Tooltip\",\r\n            //            icon: \" eav-icon-file-pdf\",\r\n            //            onclick: function () {\r\n            //                vm.toggleAdam(false);\r\n            //            }\r\n            //        }, {\r\n            //            text: \"Link.DnnFile\",\r\n            //            tooltip: \"Link.DnnFile.Tooltip\",\r\n            //            icon: \" eav-icon-file\",\r\n            //            onclick: function () {\r\n            //                vm.openDnnDialog(\"documentmanager\");\r\n            //            }\r\n            //        }\r\n            //    ]\r\n            //});\r\n\r\n            //#region link group with web-link, page-link, unlink, anchor\r\n            var linkgroup = {\r\n                type: \"splitbutton\",\r\n                icon: \"link\",\r\n                title: \"Link\",\r\n                onPostRender: initOnPostRender(\"link\"),\r\n                onclick: function () {\r\n                    editor.execCommand(\"mceLink\");\r\n                },\r\n\r\n                menu: [\r\n                { icon: \"link\", text: \"Link\", onclick: function () { editor.execCommand(\"mceLink\"); } },\r\n                {\r\n                    text: \"Link.Page\",\r\n                    tooltip: \"Link.Page.Tooltip\",\r\n                    icon: \" eav-icon-sitemap\",\r\n                    onclick: function () {\r\n                        vm.openDnnDialog(\"pagepicker\");\r\n                    }\r\n                }\r\n                ]\r\n            };\r\n            var linkgroupPro = angular.copy(linkgroup);\r\n            linkgroupPro.menu.push({ icon: \" eav-icon-anchor\", text: \"Anchor\", tooltip: \"Link.Anchor.Tooltip\", onclick: function () { editor.execCommand(\"mceAnchor\"); } });\r\n            editor.addButton(\"linkgroup\", linkgroup);\r\n            editor.addButton(\"linkgrouppro\", linkgroupPro);\r\n            //#endregion\r\n\r\n            // group with images (adam) - only in PRO mode\r\n            editor.addButton(\"images\", {\r\n                type: \"splitbutton\",\r\n                text: \"\",\r\n                icon: \"image\",\r\n                onclick: function () {\r\n                    vm.toggleAdam(true);\r\n                },\r\n                menu: [\r\n                    {\r\n                        text: \"Image.AdamImage\",\r\n                        tooltip: \"Image.AdamImage.Tooltip\",\r\n                        icon: \"image\",\r\n                        onclick: function () { vm.toggleAdam(true); }\r\n                    }, {\r\n                        text: \"Image.DnnImage\",\r\n                        tooltip: \"Image.DnnImage.Tooltip\",\r\n                        icon: \"image\",\r\n                        onclick: function () { vm.toggleAdam(true, true); }\r\n                    }, {\r\n                        text: \"Insert\\/edit image\", // i18n tinyMce standard\r\n                        icon: \"image\",\r\n                        onclick: function () { editor.execCommand(\"mceImage\"); }\r\n\r\n                    },\r\n                    // note: all these use i18n from tinyMce standard\r\n                    { icon: \"alignleft\", tooltip: \"Align left\", onclick: function () { editor.execCommand(\"JustifyLeft\"); } },\r\n                    { icon: \"aligncenter\", tooltip: \"Align center\", onclick: function () { editor.execCommand(\"JustifyCenter\"); } },\r\n                    { icon: \"alignright\", tooltip: \"Align right\", onclick: function () { editor.execCommand(\"JustifyRight\"); } }\r\n                ]\r\n            });\r\n\r\n            // drop-down with italic, strikethrough, ...\r\n            editor.addButton(\"formatgroup\", {\r\n                type: \"splitbutton\",\r\n                tooltip: \"Italic\",  // will be autotranslated\r\n                text: \"\",\r\n                icon: \"italic\",\r\n                cmd: \"italic\",\r\n                onPostRender: initOnPostRender(\"italic\"),\r\n                menu: [\r\n                    { icon: \"strikethrough\", text: \"Strikethrough\", onclick: function () { editor.execCommand(\"strikethrough\"); } },\r\n                    { icon: \"superscript\", text: \"Superscript\", onclick: function () { editor.execCommand(\"superscript\"); } },\r\n                    { icon: \"subscript\", text: \"Subscript\", onclick: function () { editor.execCommand(\"subscript\"); } }\r\n                ]\r\n\r\n            });\r\n\r\n            // drop-down with italic, strikethrough, ...\r\n            editor.addButton(\"listgroup\", {\r\n                type: \"splitbutton\",\r\n                tooltip: \"Numbered list\",  // official tinymce key\r\n                text: \"\",\r\n                icon: \"numlist\",\r\n                cmd: \"InsertOrderedList\",\r\n                onPostRender: initOnPostRender(\"numlist\"),  // for unknown reasons, this just doesn't activate correctly :( - neither does the bullist\r\n                menu: [\r\n                    { icon: \"bullist\", text: \"Bullet list\", onPostRender: initOnPostRender(\"bullist\"), onclick: function () { editor.execCommand(\"InsertUnorderedList\"); } },\r\n                    { icon: \"outdent\", text: \"Outdent\", onclick: function () { editor.execCommand(\"Outdent\"); } },\r\n                    { icon: \"indent\", text: \"Indent\", onclick: function () { editor.execCommand(\"Indent\"); } }\r\n                ]\r\n\r\n            });\r\n\r\n            //#region mode switching and the buttons for it\r\n            function switchModes(mode) {\r\n                editor.settings.toolbar = editor.settings.modes[mode].toolbar;\r\n                editor.settings.menubar = editor.settings.modes[mode].menubar;\r\n                // editor.settings.contextmenu = editor.settings.modes[mode].contextmenu; - doesn't work at the moment\r\n\r\n                editor.theme.panel.remove();    // kill current toolbar\r\n                editor.theme.renderUI(editor);\r\n                editor.execCommand(\"mceFocus\");\r\n\r\n                // focus away...\r\n                document.getElementById(\"dummyfocus\").focus();\r\n\r\n                // ...and focus back a bit later\r\n                setTimeout(function () {\r\n                    editor.focus();\r\n                }, 100);\r\n            }\r\n\r\n            editor.addButton(\"modestandard\", {\r\n                icon: \" eav-icon-cancel\",\r\n                tooltip: \"SwitchMode.Standard\",\r\n                onclick: function () { switchModes(\"standard\"); }\r\n            });\r\n\r\n            editor.addButton(\"modeadvanced\", {\r\n                icon: \" eav-icon-pro\",\r\n                tooltip: \"SwitchMode.Pro\",\r\n                onclick: function () { switchModes(\"advanced\"); }\r\n            });\r\n            //#endregion\r\n\r\n            //#region h1, h2, etc. buttons, inspired by http://blog.ionelmc.ro/2013/10/17/tinymce-formatting-toolbar-buttons/\r\n            // note that the complex array is needede because auto-translate only happens if the string is identical\r\n            [[\"pre\", \"Preformatted\", \"Preformatted\"],\r\n                [\"p\", \"Paragraph\", \"Paragraph\"],\r\n                [\"code\", \"Code\", \"Code\"],\r\n                [\"h1\", \"Heading 1\", \"H1\"],\r\n                [\"h2\", \"Heading 2\", \"H2\"],\r\n                [\"h3\", \"Heading 3\", \"H3\"],\r\n                [\"h4\", \"Heading 4\", \"Heading 4\"],\r\n                [\"h5\", \"Heading 5\", \"Heading 5\"],\r\n                [\"h6\", \"Heading 6\", \"Heading 6\"]].forEach(function (tag) {\r\n                    editor.addButton(tag[0], {\r\n                        tooltip: tag[1],\r\n                        text: tag[2],\r\n                        onclick: function () { editor.execCommand(\"mceToggleFormat\", false, tag[0]); },\r\n                        onPostRender: function () {\r\n                            var self = this,\r\n                                setup = function () {\r\n                                    editor.formatter.formatChanged(tag[0], function (state) {\r\n                                        self.active(state);\r\n                                    });\r\n                                };\r\n                            var x = editor.formatter ? setup() : editor.on(\"init\", setup);\r\n                        }\r\n                    });\r\n                });\r\n\r\n            // group of buttons with an h3 to start and showing h4-6 + p\r\n            editor.addButton(\"hgroup\", angular.extend({}, editor.buttons.h3,\r\n            {\r\n                type: \"splitbutton\",\r\n                menu: [\r\n                    editor.buttons.h4,\r\n                    editor.buttons.h5,\r\n                    editor.buttons.h6,\r\n                    editor.buttons.p\r\n                ]\r\n            }));\r\n            //#endregion\r\n\r\n            // #region inside content\r\n            editor.addButton(\"addcontentblock\", {\r\n                icon: \" eav-icon-content-block\",\r\n                classes: \"btn-addcontentblock\",\r\n                tooltip: \"ContentBlock.Add\",\r\n                onclick: function() {\r\n                    var guid = Math.uuid().toLowerCase(); // requires the uuid-generator to be included\r\n                    \r\n                    vm.editor.insertContent(\"<hr sxc=\\\"sxc-content-block\\\" guid=\\\"\" + guid + \"\\\" />\");\r\n                }\r\n            });\r\n            // #endregion\r\n\r\n            //#region image alignment / size buttons\r\n            editor.addButton(\"alignimgleft\", { icon: \" eav-icon-align-left\", tooltip: \"Align left\", cmd: \"JustifyLeft\", onPostRender: initOnPostRender(\"alignleft\") });\r\n            editor.addButton(\"alignimgcenter\", { icon: \" eav-icon-align-center\", tooltip: \"Align center\", cmd: \"justifycenter\", onPostRender: initOnPostRender(\"aligncenter\") });\r\n            editor.addButton(\"alignimgright\", { icon: \" eav-icon-align-right\", tooltip: \"Align right\", cmd: \"justifyright\", onPostRender: initOnPostRender(\"alignright\") });\r\n\r\n            var imgMenuArray = [];\r\n            function makeImgFormatCall(size) { return function () { editor.formatter.apply(\"imgwidth\" + size); }; }\r\n            for (var is = 0; is < tinyMceConfig.imgSizes.length; is++) {\r\n                var config = {\r\n                    icon: \" eav-icon-resize-horizontal\",\r\n                    tooltip: tinyMceConfig.imgSizes[is] + \"%\",\r\n                    text: tinyMceConfig.imgSizes[is] + \"%\",\r\n                    onclick: makeImgFormatCall(tinyMceConfig.imgSizes[is]),\r\n                    onPostRender: initOnPostRender(\"imgwidth\" + tinyMceConfig.imgSizes[is])\r\n                };\r\n                editor.addButton(\"imgresize\" + tinyMceConfig.imgSizes[is], config);\r\n                imgMenuArray.push(config);\r\n            }\r\n\r\n            editor.addButton(\"resizeimg100\", {\r\n                icon: \" eav-icon-resize-horizontal\", tooltip: \"100%\",\r\n                onclick: function () { editor.formatter.apply(\"imgwidth100\"); },\r\n                onPostRender: initOnPostRender(\"imgwidth100\")\r\n            });\r\n\r\n            // group of buttons to resize an image 100%, 50%, etc.\r\n            editor.addButton(\"imgresponsive\", angular.extend({}, editor.buttons.resizeimg100,\r\n            { type: \"splitbutton\", menu: imgMenuArray }));\r\n            //#endregion\r\n\r\n            //#region my context toolbars for links, images and lists (ul/li)\r\n            function makeTagDetector(tagWeNeedInTheTagPath) {\r\n                return function tagDetector(currentElement) {\r\n                    // check if we are in a tag within a specific tag\r\n                    var selectorMatched = editor.dom.is(currentElement, tagWeNeedInTheTagPath) && editor.getBody().contains(currentElement);\r\n                    return selectorMatched;\r\n                };\r\n            }\r\n\r\n            editor.addContextToolbar(makeTagDetector(\"a\"), \"link unlink\");\r\n            editor.addContextToolbar(makeTagDetector(\"img\"), \"image | alignimgleft alignimgcenter alignimgright imgresponsive | removeformat | remove\");\r\n            editor.addContextToolbar(makeTagDetector(\"li,ol,ul\"), \"bullist numlist | outdent indent\");\r\n            //#endregion\r\n        }\r\n\r\n        return svc;\r\n    }]);\nangular.module(\"SxcEditTemplates\", []).run([\"$templateCache\", function($templateCache) {$templateCache.put(\"adam/adam-hint.html\",\"<div class=\\\"small pull-right\\\">\\r\\n    <span style=\\\"opacity: 0.5\\\">drop files here -</span>\\r\\n    <a href=\\\"http://2sxc.org/help?tag=adam\\\" target=\\\"_blank\\\" uib-tooltip=\\\"ADAM is the Automatic Digital Assets Manager - click to discover more\\\">\\r\\n        <i class=\\\"eav-icon-apple\\\"></i>\\r\\n        Adam\\r\\n    </a>\\r\\n    <span style=\\\"opacity: 0.5\\\"> is sponsored with\\r\\n    <i class=\\\"eav-icon-heart\\\"></i> by\\r\\n    <a tabindex=\\\"-1\\\" href=\\\"http://2sic.com/\\\" target=\\\"_blank\\\">\\r\\n        2sic.com\\r\\n    </a>\\r\\n    </span>\\r\\n</div>\\r\\n\");\n$templateCache.put(\"adam/browser.html\",\"<div ng-if=\\\"vm.show\\\" ng-class=\\\"\\'adam-scope-\\' + (vm.adamModeConfig.usePortalRoot ? \\'site\\' : field)\\\">\\r\\n    <!-- info for dropping stuff here -->\\r\\n    <div class=\\\"dz-preview dropzone-adam\\\" ng-disabled=\\\"vm.disabled\\\" uib-tooltip=\\\"{{\\'Edit.Fields.Hyperlink.Default.AdamUploadLabel\\' | translate }}\\\" ng-click=\\\"vm.openUpload()\\\">\\r\\n        <div class=\\\"dz-image adam-browse-background-icon adam-browse-background\\\" xstyle=\\\"background-color: whitesmoke\\\">\\r\\n            <i class=\\\"eav-icon-up-circled2\\\"></i>\\r\\n            <div class=\\\"adam-short-label\\\">upload to<i ng-class=\\\"vm.adamModeConfig.usePortalRoot ? \\'eav-icon-globe\\' : \\'eav-icon-apple\\'\\\" style=\\\"font-size: larger\\\"></i></div>\\r\\n        </div>\\r\\n    </div>\\r\\n    \\r\\n    <!-- stv: this is temp for prototip -->\\r\\n    <input type=\\\"text\\\" ng-paste=\\\"copyPasted($event)\\\">\\r\\n\\r\\n    <!-- add folder - not always shown -->\\r\\n    <div ng-show=\\\"vm.allowCreateFolder() || vm.debug.on\\\" class=\\\"dz-preview\\\" ng-disabled=\\\"vm.disabled\\\" ng-click=\\\"vm.addFolder()\\\">\\r\\n        <div class=\\\"dz-image adam-browse-background-icon adam-browse-background\\\">\\r\\n            <div class=\\\"\\\">\\r\\n                <i class=\\\"eav-icon-folder-empty\\\"></i>\\r\\n                <div class=\\\"adam-short-label\\\">new folder</div>\\r\\n            </div>\\r\\n        </div>\\r\\n        <div class=\\\"adam-background adam-browse-background-icon\\\">\\r\\n            <i class=\\\"eav-icon-plus\\\" style=\\\"font-size: 2em; top: 13px; position: relative;\\\"></i>\\r\\n        </div>\\r\\n        <div class=\\\"dz-details\\\" style=\\\"opacity: 1\\\">\\r\\n\\r\\n        </div>\\r\\n    </div>\\r\\n\\r\\n    <!-- browse up a folder - not always shown -->\\r\\n    <div ng-show=\\\"vm.showFolders || vm.debug.on\\\" class=\\\"dz-preview\\\" ng-disabled=\\\"vm.disabled\\\" ng-if=\\\"vm.folders.length > 0\\\" ng-click=\\\"vm.goUp()\\\">\\r\\n        <div class=\\\"dz-image  adam-browse-background-icon adam-browse-background\\\">\\r\\n            <i class=\\\"eav-icon-folder-empty\\\"></i>\\r\\n            <div class=\\\"adam-short-label\\\">up</div>\\r\\n        </div>\\r\\n        <div class=\\\"adam-background adam-browse-background-icon\\\">\\r\\n            <i class=\\\"eav-icon-level-up\\\" style=\\\"font-size: 2em; top: 13px; position: relative;\\\"></i>\\r\\n        </div>\\r\\n    </div>\\r\\n\\r\\n    <!-- folder list - not always shown -->\\r\\n    <div ng-show=\\\"vm.showFolders || vm.debug.on\\\" class=\\\"dz-preview\\\" ng-repeat=\\\"item in vm.items | filter: { IsFolder: true } | filter: { Name: \\'!2sxc\\' } | filter: { Name: \\'!adam\\' } | orderBy:\\'Name\\'\\\"\\r\\n         ng-click=\\\"vm.goIntoFolder(item)\\\">\\r\\n        <div class=\\\"dz-image adam-blur adam-browse-background-icon adam-browse-background\\\">\\r\\n            <i class=\\\"eav-icon-folder-empty\\\"></i>\\r\\n            <div class=\\\"short-label\\\">{{ item.Name }}</div>\\r\\n        </div>\\r\\n\\r\\n        <div class=\\\"dz-details file-type-{{item.Type}}\\\">\\r\\n            <span ng-click=\\\"vm.del(item)\\\" stop-event=\\\"click\\\" class=\\\"adam-delete-button\\\"><i class=\\\"eav-icon-cancel\\\"></i></span>\\r\\n            <span ng-click=\\\"vm.rename(item)\\\" stop-event=\\\"click\\\" class=\\\"adam-rename-button\\\"><i class=\\\"eav-icon-pencil\\\"></i></span>\\r\\n            <div class=\\\"adam-full-name-area\\\">\\r\\n                <div class=\\\"adam-full-name\\\">{{ item.Name }}</div>\\r\\n            </div>\\r\\n        </div>\\r\\n\\r\\n        <span class=\\\"adam-tag\\\" ng-class=\\\"{\\'metadata-exists\\': item.MetadataId > 0}\\\"\\r\\n              ng-click=\\\"vm.editMetadata(item)\\\"\\r\\n              ng-if=\\\"vm.getMetadataType(item)\\\"\\r\\n              stop-event=\\\"click\\\"\\r\\n              uib-tooltip=\\\"{{vm.getMetadataType(item)}}:{{item.MetadataId}}\\\">\\r\\n            <i class=\\\"eav-icon-tag\\\" style=\\\"font-size: larger\\\"></i>\\r\\n        </span>\\r\\n    </div>\\r\\n\\r\\n\\r\\n    <!-- files -->\\r\\n    <div class=\\\"dz-preview\\\" ng-class=\\\"{ \\'dz-success\\': value.Value.toLowerCase() == \\'file:\\' + item.Id }\\\" ng-repeat=\\\"item in (vm.items | filter: vm.fileEndingFilter | filter: { IsFolder: false }) | filter: (vm.showImagesOnly ? {Type: \\'image\\'} : {})  | orderBy:\\'Name\\'\\\" ng-click=\\\"vm.select(item)\\\" ng-disabled=\\\"vm.disabled || !vm.enableSelect\\\">\\r\\n        <div ng-if=\\\"item.Type !== \\'image\\'\\\" class=\\\"dz-image adam-blur  adam-browse-background-icon adam-browse-background\\\">\\r\\n            <i ng-class=\\\"vm.icon(item)\\\"></i>\\r\\n            <div class=\\\"adam-short-label\\\">{{ item.Name }}</div>\\r\\n        </div>\\r\\n        <div ng-if=\\\"item.Type === \\'image\\'\\\" class=\\\"dz-image\\\">\\r\\n            <img data-dz-thumbnail=\\\"\\\" alt=\\\"{{ item.Id + \\':\\' + item.Name\\r\\n}}\\\" ng-src=\\\"{{ item.fullPath + \\'?w=120&h=120&mode=crop\\' }}\\\">\\r\\n        </div>\\r\\n\\r\\n\\r\\n\\r\\n        <div class=\\\"dz-details file-type-{{item.Type}}\\\">\\r\\n            <span ng-click=\\\"vm.del(item)\\\" stop-event=\\\"click\\\" class=\\\"adam-delete-button\\\"><i class=\\\"eav-icon-cancel\\\"></i></span>\\r\\n            <span ng-click=\\\"vm.rename(item)\\\" stop-event=\\\"click\\\" class=\\\"adam-rename-button\\\"><i class=\\\"eav-icon-pencil\\\"></i></span>\\r\\n            <div class=\\\"adam-full-name-area\\\">\\r\\n                <div class=\\\"adam-full-name\\\">{{ item.Name }}</div>\\r\\n            </div>\\r\\n            <div class=\\\"dz-filename adam-short-label\\\">\\r\\n                <span>#{{ item.Id }} - {{ (item.Size / 1024).toFixed(0) }} kb</span>\\r\\n            </div>\\r\\n            <a class=\\\"adam-link-button\\\" target=\\\"_blank\\\" ng-href=\\\"{{ item.fullPath }}\\\">\\r\\n                <i class=\\\"eav-icon-link-ext\\\" style=\\\"font-size: larger\\\"></i>\\r\\n            </a>\\r\\n        </div>\\r\\n\\r\\n        <span class=\\\"adam-tag\\\" ng-class=\\\"{\\'metadata-exists\\': item.MetadataId > 0}\\\"\\r\\n              ng-click=\\\"vm.editMetadata(item)\\\"\\r\\n              ng-if=\\\"vm.getMetadataType(item)\\\"\\r\\n              stop-event=\\\"click\\\"\\r\\n              uib-tooltip=\\\"{{vm.getMetadataType(item)}}:{{item.MetadataId}}\\\">\\r\\n            <i class=\\\"eav-icon-tag\\\" style=\\\"font-size: larger\\\"></i>\\r\\n        </span>\\r\\n\\r\\n\\r\\n        <div class=\\\"dz-success-mark\\\">\\r\\n            <svg width=\\\"54px\\\" height=\\\"54px\\\" viewBox=\\\"0 0 54 54\\\" version=\\\"1.1\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\" xmlns:xlink=\\\"http://www.w3.org/1999/xlink\\\" xmlns:sketch=\\\"http://www.bohemiancoding.com/sketch/ns\\\">\\r\\n                <title>Check</title>\\r\\n                <defs></defs>\\r\\n                <g id=\\\"Page-1\\\" stroke=\\\"none\\\" stroke-width=\\\"1\\\" fill=\\\"none\\\" fill-rule=\\\"evenodd\\\" sketch:type=\\\"MSPage\\\">\\r\\n                    <path d=\\\"M23.5,31.8431458 L17.5852419,25.9283877 C16.0248253,24.3679711 13.4910294,24.366835 11.9289322,25.9289322 C10.3700136,27.4878508 10.3665912,30.0234455 11.9283877,31.5852419 L20.4147581,40.0716123 C20.5133999,40.1702541 20.6159315,40.2626649 20.7218615,40.3488435 C22.2835669,41.8725651 24.794234,41.8626202 26.3461564,40.3106978 L43.3106978,23.3461564 C44.8771021,21.7797521 44.8758057,19.2483887 43.3137085,17.6862915 C41.7547899,16.1273729 39.2176035,16.1255422 37.6538436,17.6893022 L23.5,31.8431458 Z M27,53 C41.3594035,53 53,41.3594035 53,27 C53,12.6405965 41.3594035,1 27,1 C12.6405965,1 1,12.6405965 1,27 C1,41.3594035 12.6405965,53 27,53 Z\\\" id=\\\"Oval-2\\\" stroke-opacity=\\\"0.198794158\\\" stroke=\\\"#747474\\\" fill-opacity=\\\"0.816519475\\\" fill=\\\"#FFFFFF\\\" sketch:type=\\\"MSShapeGroup\\\"></path>\\r\\n                </g>\\r\\n            </svg>\\r\\n        </div>\\r\\n    </div>\\r\\n\\r\\n</div>\");\n$templateCache.put(\"adam/dropzone-upload-preview.html\",\"<div ng-show=\\\"uploading\\\">\\r\\n    <div class=\\\"dropzone-previews\\\">\\r\\n    </div>\\r\\n    <span class=\\\"invisible-clickable\\\" data-note=\\\"just a fake, invisible area for dropzone\\\"></span>\\r\\n</div>\");\n$templateCache.put(\"fields/dnn-bridge/hyperlink-default-pagepicker.html\",\"<div>\\r\\n\t<div class=\\\"modal-header\\\">\\r\\n\t\t<h3 class=\\\"modal-title\\\" translate=\\\"Edit.Fields.Hyperlink.PagePicker.Title\\\"></h3>\\r\\n\t</div>\\r\\n\t<div class=\\\"modal-body\\\" style=\\\"height:370px; width:600px\\\">\\r\\n\t\t<iframe style=\\\"width:100%; height: 350px; border: 0;\\\" web-forms-bridge=\\\"bridge\\\" bridge-type=\\\"pagepicker\\\" bridge-sync-height=\\\"false\\\"></iframe>\\r\\n\t</div>\\r\\n\t<div class=\\\"modal-footer\\\"></div>\\r\\n</div>\");\n$templateCache.put(\"fields/hyperlink/hyperlink-default.html\",\"<div class=\\\"dropzone\\\">\\r\\n    <div class=\\\"clearfix\\\">\\r\\n        <div ng-if=\\\"value.Value && vm.isImage()\\\"\\r\\n             class=\\\"thumbnail-before-input\\\"\\r\\n             ng-style=\\\"{ \\'background-image\\': \\'url(\\' + vm.thumbnailUrl(1, true) + \\')\\' }\\\"\\r\\n             ng-mouseover=\\\"vm.showPreview = true\\\"\\r\\n             ng-mouseleave=\\\"vm.showPreview = false\\\">\\r\\n        </div>\\r\\n\\r\\n        <div ng-if=\\\"value.Value && !vm.isImage()\\\"\\r\\n           class=\\\"thumbnail-before-input icon-before-input\\\">\\r\\n            <a href=\\\"{{vm.testLink}}\\\"\\r\\n               target=\\\"_blank\\\" tabindex=\\\"-1\\\"\\r\\n               tooltip-html=\\\"{{vm.tooltipUrl(vm.testLink)}}\\\"\\r\\n               tooltip-placement=\\\"right\\\"\\r\\n               ng-class=\\\"vm.icon()\\\">\\r\\n            </a>            \\r\\n        </div>\\r\\n        <div ng-if=\\\"!value.Value\\\"\\r\\n             class=\\\"thumbnail-before-input empty-placeholder\\\">\\r\\n        </div>\\r\\n        <div class=\\\"after-preview\\\">\\r\\n            <div class=\\\"input-group\\\" uib-dropdown>\\r\\n                <input type=\\\"text\\\" class=\\\"form-control input-lg\\\" ng-model=\\\"value.Value\\\" uib-tooltip=\\\"{{\\'Edit.Fields.Hyperlink.Default.Tooltip1\\' | translate }}\\r\\n{{\\'Edit.Fields.Hyperlink.Default.Tooltip2\\' | translate }}\\r\\nADAM - sponsored with  by 2sic.com\\\">\\r\\n                <span class=\\\"input-group-btn\\\" style=\\\"vertical-align: top;\\\">\\r\\n                    <div style=\\\"width: 6px;\\\"></div>\\r\\n                    <button ng-if=\\\"to.settings[\\'merged\\'].Buttons.indexOf(\\'adam\\') > -1\\\" type=\\\"button\\\" class=\\\"btn btn-default icon-field-button\\\" ng-disabled=\\\"to.disabled\\\" uib-tooltip=\\\"{{\\'Edit.Fields.Hyperlink.Default.AdamUploadLabel\\' | translate }}\\\" ng-click=\\\"vm.toggleAdam()\\\">\\r\\n                        <i class=\\\"eav-icon-apple\\\"></i>\\r\\n                    </button>\\r\\n                    <button ng-if=\\\"to.settings[\\'merged\\'].Buttons.indexOf(\\'page\\') > -1\\\" type=\\\"button\\\" class=\\\"btn btn-default icon-field-button\\\" ng-disabled=\\\"to.disabled\\\" uib-tooltip=\\\"{{\\'Edit.Fields.Hyperlink.Default.PageLabel\\' | translate }}\\\" ng-click=\\\"vm.openPageDialog()\\\">\\r\\n                        <i class=\\\"eav-icon-sitemap\\\"></i>\\r\\n                    </button>\\r\\n                    <button ng-if=\\\"to.settings[\\'merged\\'].Buttons.indexOf(\\'more\\') > -1\\\" tabindex=\\\"-1\\\" type=\\\"button\\\" class=\\\"btn btn-default uib-dropdown-toggle icon-field-button\\\" uib-dropdown-toggle ng-disabled=\\\"to.disabled\\\">\\r\\n                        <i class=\\\"eav-icon-options\\\"></i>\\r\\n                    </button>\\r\\n                </span>\\r\\n                <ul class=\\\"dropdown-menu pull-right\\\" uib-dropdown-menu role=\\\"menu\\\">\\r\\n                    <li role=\\\"menuitem\\\" ng-if=\\\"to.settings[\\'merged\\'].ShowAdam\\\"><a class=\\\"dropzone-adam\\\" ng-click=\\\"vm.toggleAdam(false)\\\" href=\\\"javascript:void(0);\\\"><i class=\\\"eav-icon-apple\\\"></i> <span translate=\\\"Edit.Fields.Hyperlink.Default.MenuAdam\\\"></span></a></li>\\r\\n                    <li role=\\\"menuitem\\\" ng-if=\\\"to.settings[\\'merged\\'].ShowPagePicker\\\"><a ng-click=\\\"vm.openPageDialog()\\\" href=\\\"javascript:void(0)\\\"><i class=\\\"eav-icon-sitemap\\\" xicon=\\\"home\\\"></i> <span translate=\\\"Edit.Fields.Hyperlink.Default.MenuPage\\\"></span></a></li>\\r\\n                    <li role=\\\"menuitem\\\" ng-if=\\\"to.settings[\\'merged\\'].ShowImageManager\\\"><a ng-click=\\\"vm.toggleAdam(true, true)\\\" href=\\\"javascript:void(0)\\\"><i class=\\\"eav-icon-file-image\\\" xicon=\\\"picture\\\"></i> <span translate=\\\"Edit.Fields.Hyperlink.Default.MenuImage\\\"></span></a></li>\\r\\n                    <li role=\\\"menuitem\\\" ng-if=\\\"to.settings[\\'merged\\'].ShowFileManager\\\"><a ng-click=\\\"vm.toggleAdam(true, false)\\\" href=\\\"javascript:void(0)\\\"><i class=\\\"eav-icon-file\\\" xicon=\\\"file\\\"></i> <span translate=\\\"Edit.Fields.Hyperlink.Default.MenuDocs\\\"></span></a></li>\\r\\n                </ul>\\r\\n            </div>\\r\\n            <div ng-if=\\\"vm.showPreview\\\" style=\\\"position: relative\\\">\\r\\n                <div style=\\\"position: absolute; z-index: 100; background: white; top: 10px; text-align: center; left: 0; right: 0;\\\">\\r\\n                    <img ng-src=\\\"{{vm.thumbnailUrl(2)}}\\\" />\\r\\n                </div>\\r\\n            </div>\\r\\n\\r\\n            <adam-hint class=\\\"field-hints\\\"></adam-hint>\\r\\n            <div ng-if=\\\"value.Value\\\" class=\\\"field-hints\\\">\\r\\n                <a href=\\\"{{vm.testLink}}\\\" target=\\\"_blank\\\" tabindex=\\\"-1\\\" tooltip-html=\\\"{{vm.tooltipUrl(vm.testLink)}}\\\">\\r\\n                    <span>&nbsp;... {{vm.testLink.substr(vm.testLink.lastIndexOf(\\\"/\\\"), 100)}}</span>\\r\\n                </a>\\r\\n            </div>\\r\\n        </div>\\r\\n    </div>\\r\\n\\r\\n    <div>\\r\\n        <!-- The ADAM file browser, requires the uploader wrapped around it -->\\r\\n        <adam-browser content-type-name=\\\"to.header.ContentTypeName\\\"\\r\\n                      entity-guid=\\\"to.header.Guid\\\"\\r\\n                      field-name=\\\"options.key\\\"\\r\\n                      auto-load=\\\"false\\\"\\r\\n                      folder-depth=\\\"0\\\"\\r\\n                      sub-folder=\\\"\\\"\\r\\n                      update-callback=\\\"vm.setValue\\\"\\r\\n                      register-self=\\\"vm.registerAdam\\\"\\r\\n                      adam-mode-config=\\\"vm.adamModeConfig\\\"\\r\\n                      ng-disabled=\\\"to.disabled\\\"\\r\\n                      file-filter=\\\"to.settings[\\'merged\\'].FileFilter\\\"></adam-browser>\\r\\n\\r\\n        <!-- the preview of the uploader -->\\r\\n        <dropzone-upload-preview></dropzone-upload-preview>\\r\\n\\r\\n    </div>\\r\\n</div>\");\n$templateCache.put(\"fields/hyperlink/hyperlink-library.html\",\"<div>\\r\\n    <div class=\\\"dropzone\\\">\\r\\n        <!-- The ADAM file browser, requires the uploader wrapped around it -->\\r\\n        <adam-browser\\r\\n            content-type-name=\\\"to.header.ContentTypeName\\\"\\r\\n            entity-guid=\\\"to.header.Guid\\\"\\r\\n            field-name=\\\"options.key\\\"\\r\\n            auto-load=\\\"true\\\"\\r\\n            sub-folder=\\\"\\\"\\r\\n            folder-depth=\\\"to.settings.merged.FolderDepth\\\"\\r\\n            metadata-content-types=\\\"to.settings.merged.MetadataContentTypes\\\"\\r\\n            allow-assets-in-root=\\\"to.settings.merged.allowAssetsInRoot\\\"\\r\\n            enable-select=\\\"false\\\"\\r\\n            update-callback=\\\"vm.setValue\\\"\\r\\n            register-self=\\\"vm.registerAdam\\\"\\r\\n            adam-mode-config=\\\"vm.adamModeConfig\\\">\\r\\n        </adam-browser>\\r\\n\\r\\n\\r\\n        <!-- the preview of the uploader -->\\r\\n        <dropzone-upload-preview></dropzone-upload-preview>\\r\\n\\r\\n    </div>\\r\\n</div>\");\n$templateCache.put(\"fields/string/string-font-icon-picker.html\",\"<div>\\r\\n    <div uib-dropdown uib-keyboard-nav auto-close=\\\"outsideClick\\\" is-open=\\\"vm.selectorIsOpen\\\">\\r\\n        <div class=\\\"thumbnail-before-input icon-preview\\\">\\r\\n            <button type=\\\"button\\\" class=\\\"\\\" uib-tooltip=\\\"{{value.Value}}\\\" uib-dropdown-toggle>\\r\\n                <i class=\\\"{{vm.previewPrefix}} {{value.Value}}\\\" ng-show=\\\"value.Value\\\"></i>\\r\\n                <span ng-show=\\\"!value.Value\\\">&nbsp;&nbsp;</span>\\r\\n            </button>\\r\\n        </div>\\r\\n        <div class=\\\"input-group\\\" uib-dropdown-toggle>\\r\\n            <input type=\\\"text\\\" class=\\\"form-control input-lg\\\" ng-model=\\\"value.Value\\\" ng-disabled=\\\"false\\\" >\\r\\n        </div>\\r\\n        <!-- the search ui -->\\r\\n        <ul class=\\\"dropdown-menu icons-menu-columns\\\" role=\\\"menu\\\" uib-dropdown-menu>\\r\\n            <li class=\\\"input-group\\\">\\r\\n                <span class=\\\"input-group-addon btn-default btn\\\" ng-click=\\\"vm.selectorIsOpen = false; value.Value = \\'\\'\\\">\\r\\n                    <i class=\\\"eav-icon-cancel\\\"></i>\\r\\n                </span>\\r\\n                <input type=\\\"search\\\" ng-model=\\\"vm.iconFilter\\\" class=\\\"form-control input-lg\\\" placeholder=\\\"search...\\\" />\\r\\n            </li>\\r\\n\\r\\n            <li ng-repeat=\\\"icn in vm.icons\\\" role=\\\"menuitem\\\"\\r\\n                ng-show=\\\"icn.class.indexOf(vm.iconFilter) !== -1\\\">\\r\\n                <a ng-click=\\\"vm.setIcon(icn.class)\\\" xng-click=\\\"value.Value = icn.class; vm.selectorIsOpen = false;\\\">\\r\\n                    <i class=\\\"{{vm.previewPrefix}} {{icn.class}}\\\"></i> <span uib-tooltip=\\\"{{icn.class}}\\\">...{{icn.class.substring(vm.prefix.length-1,25)}}</span>\\r\\n                </a>\\r\\n            </li>\\r\\n        </ul>\\r\\n    </div>\\r\\n    <div ng-if=\\\"vm.debug.on\\\">Infos: found {{vm.icons.length}} items for prefix \\\"{{vm.prefix}}\\\" and will use \\\"{{vm.previewPrefix}}\\\" as a preview class. Selected is \\\"{{value.Value}}\\\" and files are: {{vm.files}}</div>\\r\\n</div> \");\n$templateCache.put(\"fields/string/string-template-picker.html\",\"<div>\\r\\n    <div class=\\\"input-group\\\">\\r\\n\\r\\n        <select class=\\\"form-control input-material material\\\"\\r\\n                ng-model=\\\"value.Value\\\"\\r\\n                ng-disabled=\\\"!readyToUse()\\\">\\r\\n            <option value=\\\"\\\">(no file selected)</option>\\r\\n            <option ng-repeat=\\\"item in templates | isValidFile:file.ext\\\"\\r\\n                    ng-selected=\\\"{{item == value.Value}}\\\"\\r\\n                    value=\\\"{{item}}\\\">\\r\\n                {{item}}\\r\\n            </option>\\r\\n        </select>\\r\\n        <span class=\\\"input-group-btn\\\" style=\\\"vertical-align: top;\\\">\\r\\n            <button class=\\\"btn btn-default icon-field-button\\\" type=\\\"button\\\" ng-click=\\\"add()\\\" ng-disabled=\\\"!readyToUse()\\\">\\r\\n                <span class=\\\"eav-icon-plus\\\"></span>\\r\\n            </button>\\r\\n        </span>\\r\\n    </div>\\r\\n</div>\");\n$templateCache.put(\"fields/string/string-wysiwyg-adv.html\",\"<div>\\r\\n    this would be an advanced, configurable WYSIWYG. It does not exist yet :). \\r\\n</div>\");\n$templateCache.put(\"fields/string/string-wysiwyg-dnn.html\",\"<iframe style=\\\"width:100%; border: 0;\\\" web-forms-bridge=\\\"vm.bridge\\\" bridge-type=\\\"wysiwyg\\\" bridge-sync-height=\\\"true\\\"></iframe>\");\n$templateCache.put(\"fields/string/string-wysiwyg-tinymce.html\",\"<div>\\r\\n    <div class=\\\"dropzone\\\">\\r\\n        <div> <!-- needed because after a refresh, the editor can\\'t be placed at the same location -->\\r\\n            <div ui-tinymce=\\\"tinymceOptions\\\" ng-model=\\\"value.Value\\\" class=\\\"field-string-wysiwyg-mce-box\\\"></div>\\r\\n        </div>\\r\\n\\r\\n        <!-- the ADAM file browser requires the uploader wrapped around it -->\\r\\n        <adam-browser content-type-name=\\\"to.header.ContentTypeName\\\"\\r\\n                      entity-guid=\\\"to.header.Guid\\\"\\r\\n                      field-name=\\\"options.key\\\"\\r\\n                      auto-load=\\\"false\\\"\\r\\n                      folder-depth=\\\"0\\\"\\r\\n                      sub-folder=\\\"\\\"\\r\\n                      update-callback=\\\"vm.setValue\\\"\\r\\n                      register-self=\\\"vm.registerAdam\\\"\\r\\n                      show-images-only=\\\"vm.adamModeImage\\\"\\r\\n                      ng-disabled=\\\"to.disabled\\\" adam-mode-config=\\\"vm.adamModeConfig\\\"></adam-browser>\\r\\n\\r\\n        <!-- dummy item to set focus on in script-->\\r\\n        <span id=\\\"dummyfocus\\\" tabindex=\\\"-1\\\"></span>\\r\\n\\r\\n        <!-- the preview of the uploader -->\\r\\n        <dropzone-upload-preview></dropzone-upload-preview>\\r\\n        <adam-hint class=\\\"field-hints\\\"></adam-hint>\\r\\n\\r\\n    </div>\\r\\n</div>\");}]);"],"sourceRoot":"/source/"}
function processInstallMessage(e,t,n,a){var l=/^(http|https):\/\/((gettingstarted|[a-z]*)\.)?(2sexycontent|2sxc)\.org(\/.*)?$/gi;if(!l.test(e.origin))return void console.error("can't execute, wrong source domain");var r=JSON.parse(e.data);if(t=Number(t),r.moduleId===t)if("install"===r.action){for(var o=r.packages,s="",i=0;i<o.length;i++)s+="- "+o[i].displayName+"\n";confirm("Do you want to install these packages?\n\n"+s+"\nThis could take 10 to 60 seconds per package, please don't reload the page while it's installing. You will see a message once it's done and progess is logged to the JS-console.")&&(n.show=!0,n.label=".....",runOneInstallJob(o,0,n,a))}else"resize"===r.action&&resizeIFrame(t,r.height)}function resizeIFrame(e,t){document.getElementById("frGettingStarted").style.height=t+10+"px"}function runOneInstallJob(e,t,n,a){var l=e[t];return console.log(l.displayName+"("+t+") started"),n.label=l.displayName,a.get("app/installer/installpackage",{params:{packageUrl:l.url}}).then(function(r){console.log(l.displayName+"("+t+") completed"),t+1<e.length?runOneInstallJob(e,t+1,n,a):(alert("Done installing. If you saw no errors, everything worked."),window.top.location.reload())},function(e){var t="Something went wrong while installing '"+l.displayName+"': "+status;if(e.responseText&&""!==e.responseText){var n=JSON.parse(e.responseText);n.messages?t=t+" - "+n.messages[0].Message:n.Message&&(t=t+" - "+n.Message)}t+=" (you might find more informations about the error in the DNN event log).",alert(t)})}!function(){angular.module("2sxc.view",["2sxc4ng","EavAdminUi","pascalprecht.translate","SxcInpageTemplates","EavConfiguration","ui.bootstrap"]).config(["$translatePartialLoaderProvider",function(e){e.addPart("sxc-admin")}])}(),function(){var e=angular.module("2sxc.view");e.factory("moduleApiService",["$http",function(e){return{getSelectableApps:function(){return e.get("View/Module/GetSelectableApps")},setAppId:function(t){return e.get("View/Module/SetAppId",{params:{appId:t}})},getSelectableContentTypes:function(){return e.get("View/Module/GetSelectableContentTypes").then(function(e){return e.data&&e.data.length&&angular.forEach(e.data,function(e,t){e.Label=e.Metadata&&e.Metadata.Label?e.Metadata.Label:e.Name}),e})},getSelectableTemplates:function(){return e.get("View/Module/GetSelectableTemplates")},gettingStartedUrl:function(){return e.get("View/Module/RemoteInstallDialogUrl",{params:{dialog:"gettingstarted"}})}}}])}(),function(){var e=angular.module("2sxc.view");e.factory("contentBlockLink",function(){return function(e){var t=window.frameElement;return t.vm=e,{dialogContainer:t,window:window.parent,sxc:t.sxc,contentBlock:t.sxc.manage.contentBlock,dashInfo:t.getAdditionalDashboardConfig}}}),e.controller("TemplateSelectorCtrl",["$scope","$interval","moduleApiService","AppInstanceId","sxc","$filter","$q","$window","$translate","$sce","contentBlockLink","$http",function(e,t,n,a,l,r,o,s,i,p,c,d){function m(){I.progressIndicator.updater=t(function(){},200)}var u="_LayoutElement",g=-1,f=e,v=n,I=this;I.apps=[],I.contentTypes=[],I.templates=[];var h=c(I),T=I.dashInfo=h.dashInfo();I.isContentApp=T.isContent,I.supportsAjax=I.isContentApp||T.supportsAjax,I.showAdvanced=T.user.canDesign,I.templateId=T.templateId,I.undoTemplateId=T.templateId,I.contentTypeId=T.contentTypeId,I.undoContentTypeId=I.contentTypeId,I.appId=0!==I.dashInfo.appId?I.dashInfo.appId:null,I.savedAppId=I.dashInfo.appId,I.showRemoteInstaller=!1,I.remoteInstallerUrl="",I.loading=0,I.progressIndicator={show:!1,label:"..."},I.filteredTemplates=function(e){if(0===I.templates.length)return I.templates;var t={IsHidden:!1};I.isContentApp&&(t=angular.extend(t,{ContentTypeStaticName:e===u?"":e}));var n=r("filter")(I.templates,t,!0);return n},I.reloadTemplatesAndContentTypes=function(){I.loading++;var e=v.getSelectableContentTypes(),t=v.getSelectableTemplates();return o.all([e,t]).then(function(e){function t(e){var t=I.contentTypes.filter(e);t&&t[0]&&t[0].IsHidden&&(t[0].IsHidden=!1)}I.contentTypes=e[0].data||[],I.templates=e[1].data||[],t(function(e){return e.StaticName===I.contentTypeId}),t(function(e){return e.TemplateId===I.templateId});var n=r("filter")(I.templates,{TemplateId:I.templateId},!0);if(n&&n[0]&&(n[0].IsHidden=!1),r("filter")(I.templates,{ContentTypeStaticName:""},!0).length>0){var a={StaticName:u,Name:i.instant("TemplatePicker.LayoutElement"),IsHidden:!1};a.Label=a.Name,I.contentTypes.push(a)}I.contentTypes=r("orderBy")(I.contentTypes,"Name"),I.loading--})},f.$watch("vm.templateId",function(e,t){if(e!==t){if(I.supportsAjax)return I.renderTemplate(e);h.contentBlock.templateId=I.templateId,I.persistTemplate(!1).then(function(){return h.window.location.reload()})}}),f.$watch("vm.contentTypeId",function(e,t){if(e!==t){var n=I.filteredTemplates(e)[0].TemplateId;I.templateId!==n&&null!==n&&(I.templateId=n)}}),f.$watch("vm.appId",function(e,t){if(e!==t&&null!==e){if(e===g)return I.appImport();var n=r("filter")(I.apps,{AppId:e})[0];v.setAppId(e).then(function(){n.SupportsAjaxReload?I.reInitAll(!0):h.window.location.reload()})}}),I.manageApps=function(){h.sxc.manage.run("zone")},I.appSettings=function(){h.sxc.manage.run("app")},I.appImport=function(){h.sxc.manage.run("app-import")},I.cancelTemplateChange=h.contentBlock._cancelTemplateChange,I.persistTemplate=h.contentBlock.persistTemplate,I.renderTemplate=h.contentBlock.reload,I.reInitAll=h.contentBlock.reloadAndReInitialize,I.appStore=function(){window.open("http://2sxc.org/en/apps")},I.show=function(e){if(void 0!==e&&(I.dashInfo.templateChooserVisible=e),I.dashInfo.templateChooserVisible){var t=[];null!==I.appId&&t.push(I.reloadTemplatesAndContentTypes()),I.isContentApp||0!==I.apps.length||t.push(I.loadApps()),o.all(t).then(I.externalInstaller.showIfConfigIsEmpty)}},I.externalInstaller={showIfConfigIsEmpty:function(){var e=I.isContentApp?0===I.templates.length:0===I.appCount;e&&I.externalInstaller.setup()},configureCallback:function(){window.addEventListener("message",function(e){processInstallMessage(e,a,I.progressIndicator,d)},!1)},setup:function(){v.gettingStartedUrl().then(function(e){e.data&&(I.externalInstaller.configureCallback(),I.showRemoteInstaller=!0,m(),I.remoteInstallerUrl=p.trustAsResourceUrl(e.data),console.log(e.data))})}},I.toggle=function(){I.dashInfo.templateChooserVisible?I.cancelTemplateChange():I.show(!0)},I.loadApps=function(){return v.getSelectableApps().then(function(e){I.apps=e.data,I.appCount=e.data.length,I.showAdvanced&&I.apps.push({Name:"TemplatePicker.Install",AppId:g})})},I.activate=function(){I.show(!0)},I.activate()}])}(),angular.module("SxcInpageTemplates",[]).run(["$templateCache",function(e){e.put("template-selector/template-selector.html",'\r\n\r\n<div class="sc-selectors-wrapper">\r\n    <div class="sc-selectors">\r\n        <!-- App Selector - only relevant in App-Mode -->\r\n        <div ng-show="!vm.isContentApp" style="overflow:hidden;">\r\n            <select ng-model="vm.appId" class="sc-selector-app input-lg pull-left"\r\n                    ng-options="a.AppId as (a.Name.indexOf(\'TemplatePicker.\') === 0 ? \'[+] \' + (a.Name | translate) : a.Name) for a in vm.apps"\r\n                    ng-disabled="vm.dashInfo.hasContent">\r\n                <option value="" ng-disabled="vm.appId != null" translate="TemplatePicker.AppPickerDefault"></option>\r\n            </select>\r\n            <span>\r\n                    <span ng-if="vm.showAdvanced && !vm.isContentApp">\r\n                        <button type="button" class="btn btn-default"\r\n                                ng-show="vm.appId != null"\r\n                                ng-click="vm.appSettings();"\r\n                                title="{{ \'TemplatePicker.App\' | translate }}">\r\n                            <i class="icon-eav-settings"></i>\r\n                        </button>\r\n                        <button type="button" class="btn btn-default"\r\n                                ng-click="vm.appImport();"\r\n                                title="{{ \'TemplatePicker.Install\' | translate }}">\r\n                            <i class="icon-eav-plus"></i>\r\n                        </button>\r\n                        <button type="button" class="btn btn-default"\r\n                                ng-click="vm.appStore();"\r\n                                title="{{ \'TemplatePicker.Catalog\' | translate }}">\r\n                            <i class="icon-eav-cart-arrow-down"></i>\r\n                        </button>\r\n                        <button type="button" class="btn btn-default"\r\n                                ng-click="vm.manageApps();"\r\n                                title="{{ \'TemplatePicker.Zone\' | translate }}">\r\n                            <i class="icon-eav-manage"></i>\r\n                        </button>\r\n\r\n                    </span>\r\n                </span>\r\n\r\n        </div>\r\n\r\n\r\n        <!-- Content Type selector, only for Content-Mode -->\r\n        <select ng-show="vm.isContentApp" ng-model="vm.contentTypeId"\r\n                class="input-lg"\r\n                ng-options="c.StaticName as c.Label for c in vm.contentTypes | filter: { IsHidden : false } | orderBy: \'Label\'"\r\n                ng-disabled="vm.dashInfo.hasContent || vm.dashInfo.isList">\r\n            <option ng-disabled="vm.contentTypeId != \'\'" value="" translate="TemplatePicker.ContentTypePickerDefault"></option>\r\n        </select>\r\n\r\n        <!-- View / template selector -->\r\n        <div>\r\n            <select ng-show="vm.isContentApp ? vm.contentTypeId != 0 : (vm.savedAppId != null)" \r\n                    x="( && vm.filteredTemplates().length > 1)"\r\n                    ng-disabled="vm.templateId && vm.filteredTemplates().length <= 1"\r\n                    class="input-lg pull-left"\r\n                    ng-model="vm.templateId"\r\n                    ng-options="t.TemplateId as t.Name for t in vm.filteredTemplates(vm.contentTypeId)"></select>\r\n\r\n            <button ng-show="vm.templateId != null && vm.savedTemplateId != vm.templateId"\r\n                    class="btn btn-primary"\r\n                    ng-click="vm.persistTemplate(false, false);"\r\n                    title="{{ \'TemplatePicker.Save\' | translate }}"\r\n                    type="button">\r\n                <i class="icon-eav-ok"></i>\r\n            </button>\r\n            <button ng-show="vm.undoTemplateId != null"\r\n                    class="btn btn-default"\r\n                    ng-click="vm.cancelTemplateChange();"\r\n                    type="button"\r\n                    title="{{ \'TemplatePicker.\' + (vm.isContentApp ? \'Cancel\' : \'Close\') | translate }}">\r\n                <i class="icon-eav-cancel"></i>\r\n            </button>\r\n        </div>\r\n    </div>\r\n\r\n\r\n\r\n    <div class="sc-loading" ng-show="vm.loading">\r\n        <i class="icon-eav-spinner animate-spin"></i>\r\n    </div>\r\n\r\n    <!-- the auto-installer IFrame, with spinner and everything -->\r\n    <div style="position: relative;" ng-if="vm.showRemoteInstaller">\r\n        <iframe id="frGettingStarted" ng-src="{{vm.remoteInstallerUrl}}" width="100%" height="300px"></iframe>\r\n        <div class="sc-loading" id="pnlLoading" ng-if="vm.progressIndicator.show">\r\n            <i class="icon-eav-spinner animate-spin"></i>\r\n            <br/>\r\n            <br/>\r\n            <span class="sc-loading-label">\r\n                    installing <span id="packageName">{{vm.progressIndicator.label}}</span>\r\n                </span>\r\n        </div>\r\n    </div>\r\n</div>\r\n')}]);
//# sourceMappingURL=inpage-dialogs.min.js.map

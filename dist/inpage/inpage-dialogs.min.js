function processInstallMessage(e,t,n,a){var l=/^(http|https):\/\/((gettingstarted|[a-z]*)\.)?(2sexycontent|2sxc)\.org(\/.*)?$/gi;if(!l.test(e.origin))return void console.error("can't execute, wrong source domain");var o=JSON.parse(e.data);if(t=Number(t),o.moduleId===t)if("install"===o.action){for(var s=o.packages,r="",i=0;i<s.length;i++)r+="- "+s[i].displayName+"\n";confirm("Do you want to install these packages?\n\n"+r+"\nThis could take 10 to 60 seconds per package, please don't reload the page while it's installing. You will see a message once it's done and progess is logged to the JS-console.")&&(n.show=!0,n.label=".....",runOneInstallJob(s,0,n,a))}else"resize"===o.action&&resizeIFrame(t,o.height)}function resizeIFrame(e,t){document.getElementById("frGettingStarted").style.height=t+10+"px"}function runOneInstallJob(e,t,n,a){var l=e[t];return console.log(l.displayName+"("+t+") started"),n.label=l.displayName,a.get("app-sys/installer/installpackage",{params:{packageUrl:l.url}}).then(function(o){console.log(l.displayName+"("+t+") completed"),t+1<e.length?runOneInstallJob(e,t+1,n,a):(alert("Done installing. If you saw no errors, everything worked."),window.top.location.reload())},function(e){var t="Something went wrong while installing '"+l.displayName+"': "+status;if(e.responseText&&""!==e.responseText){var n=JSON.parse(e.responseText);n.messages?t=t+" - "+n.messages[0].Message:n.Message&&(t=t+" - "+n.Message)}t+=" (you might find more informations about the error in the DNN event log).",alert(t)})}!function(){angular.module("2sxc.view",["2sxc4ng","EavAdminUi","pascalprecht.translate","SxcInpageTemplates","EavConfiguration","ui.bootstrap"]).config(["$translatePartialLoaderProvider",function(e){e.addPart("sxc-admin")}])}(),function(){var e=angular.module("2sxc.view");e.factory("moduleApiService",["$http",function(e){return{getSelectableApps:function(){return e.get("View/Module/GetSelectableApps")},setAppId:function(t){return e.get("View/Module/SetAppId",{params:{appId:t}})},getSelectableContentTypes:function(){return e.get("View/Module/GetSelectableContentTypes").then(function(e){return e.data&&e.data.length&&angular.forEach(e.data,function(e,t){e.Label=e.Metadata&&e.Metadata.Label?e.Metadata.Label:e.Name}),e})},getSelectableTemplates:function(){return e.get("View/Module/GetSelectableTemplates")},gettingStartedUrl:function(){return e.get("View/Module/RemoteInstallDialogUrl",{params:{dialog:"gettingstarted"}})}}}])}(),function(){var e=angular.module("2sxc.view");e.factory("contentBlockLink",function(){return function(e){var t=window.frameElement;return t.vm=e,{dialogContainer:t,window:window.parent,sxc:t.sxc,contentBlock:t.sxc.manage.contentBlock,dashInfo:t.getAdditionalDashboardConfig}}}),e.controller("TemplateSelectorCtrl",["$scope","$interval","moduleApiService","AppInstanceId","sxc","$filter","$q","$window","$translate","$sce","contentBlockLink","$http",function(e,t,n,a,l,o,s,r,i,p,c,d){function m(){h.progressIndicator.updater=t(function(){},200)}function u(){return h.form.$dirty}var g="_LayoutElement",f=-1,v=e,I=n,h=this;h.apps=[],h.contentTypes=[],h.templates=[];var T=c(h),b=h.dashInfo=T.dashInfo();h.isContentApp=b.isContent,h.supportsAjax=h.isContentApp||b.supportsAjax,h.showAdvanced=b.user.canDesign,h.templateId=b.templateId,h.undoTemplateId=b.templateId,h.contentTypeId=b.contentTypeId,h.undoContentTypeId=h.contentTypeId,h.appId=0!==h.dashInfo.appId?h.dashInfo.appId:null,h.savedAppId=h.dashInfo.appId,h.showRemoteInstaller=!1,h.remoteInstallerUrl="",h.isDirty=u,h.loading=0,h.progressIndicator={show:!1,label:"..."},h.filteredTemplates=function(e){if(0===h.templates.length)return h.templates;var t={IsHidden:!1};h.isContentApp&&(t=angular.extend(t,{ContentTypeStaticName:e===g?"":e}));var n=o("filter")(h.templates,t,!0);return n},h.reloadTemplatesAndContentTypes=function(){h.loading++;var e=I.getSelectableContentTypes(),t=I.getSelectableTemplates();return s.all([e,t]).then(function(e){function t(e){var t=h.contentTypes.filter(e);t&&t[0]&&t[0].IsHidden&&(t[0].IsHidden=!1)}h.contentTypes=e[0].data||[],h.templates=e[1].data||[],t(function(e){return e.StaticName===h.contentTypeId}),t(function(e){return e.TemplateId===h.templateId});var n=o("filter")(h.templates,{TemplateId:h.templateId},!0);if(n&&n[0]&&(n[0].IsHidden=!1),o("filter")(h.templates,{ContentTypeStaticName:""},!0).length>0){var a={StaticName:g,Name:i.instant("TemplatePicker.LayoutElement"),IsHidden:!1};a.Label=a.Name,h.contentTypes.push(a)}h.contentTypes=o("orderBy")(h.contentTypes,"Name"),h.loading--})},v.$watch("vm.templateId",function(e,t){if(e!==t){if(h.supportsAjax)return h.renderTemplate(e);T.contentBlock.templateId=h.templateId,h.persistTemplate(!1).then(function(){return T.window.location.reload()})}}),v.$watch("vm.contentTypeId",function(e,t){if(e!==t){var n=h.filteredTemplates(e)[0].TemplateId;h.templateId!==n&&null!==n&&(h.templateId=n)}}),v.$watch("vm.appId",function(e,t){if(e!==t&&null!==e){if(e===f)return h.appImport();var n=o("filter")(h.apps,{AppId:e})[0];I.setAppId(e).then(function(){n.SupportsAjaxReload?h.reInitAll(!0):T.window.location.reload()})}}),h.manageApps=function(){T.sxc.manage.run("zone")},h.appSettings=function(){T.sxc.manage.run("app")},h.appImport=function(){T.sxc.manage.run("app-import")},h.cancelTemplateChange=T.contentBlock._cancelTemplateChange,h.persistTemplate=T.contentBlock.persistTemplate,h.renderTemplate=T.contentBlock.reload,h.reInitAll=T.contentBlock.reloadAndReInitialize,h.appStore=function(){window.open("http://2sxc.org/en/apps")},h.show=function(e){if(void 0!==e&&(h.dashInfo.templateChooserVisible=e),h.dashInfo.templateChooserVisible){var t=[];null!==h.appId&&t.push(h.reloadTemplatesAndContentTypes()),h.isContentApp||0!==h.apps.length||t.push(h.loadApps()),s.all(t).then(h.externalInstaller.showIfConfigIsEmpty)}},h.externalInstaller={showIfConfigIsEmpty:function(){var e=h.isContentApp?0===h.templates.length:0===h.appCount;e&&h.externalInstaller.setup()},configureCallback:function(){window.addEventListener("message",function(e){processInstallMessage(e,a,h.progressIndicator,d)},!1)},setup:function(){I.gettingStartedUrl().then(function(e){e.data&&(h.externalInstaller.configureCallback(),h.showRemoteInstaller=!0,m(),h.remoteInstallerUrl=p.trustAsResourceUrl(e.data),console.log(e.data))})}},h.toggle=function(){h.dashInfo.templateChooserVisible?h.cancelTemplateChange():h.show(!0)},h.loadApps=function(){return I.getSelectableApps().then(function(e){h.apps=e.data,h.appCount=e.data.length,h.showAdvanced&&h.apps.push({Name:"TemplatePicker.Install",AppId:f})})},h.activate=function(){h.show(!0)},h.activate()}])}(),angular.module("SxcInpageTemplates",[]).run(["$templateCache",function(e){e.put("template-selector/template-selector.html",'<div class="sc-selectors-wrapper">\r\n    <ng-form name="vm.form">\r\n        <div class="sc-selectors">\r\n            <!-- App Selector - only relevant in App-Mode -->\r\n            <div ng-show="!vm.isContentApp" style="overflow:hidden;">\r\n                <select ng-model="vm.appId" class="sc-selector-app input-lg pull-left" ng-options="a.AppId as (a.Name.indexOf(\'TemplatePicker.\') === 0 ? \'[+] \' + (a.Name | translate) : a.Name) for a in vm.apps"\r\n                    ng-disabled="vm.dashInfo.hasContent">\r\n                <option value="" ng-disabled="vm.appId != null" translate="TemplatePicker.AppPickerDefault"></option>\r\n            </select>\r\n                <span>\r\n                <span ng-if="vm.showAdvanced && !vm.isContentApp">\r\n                    <button type="button" class="btn btn-default"\r\n                            ng-show="vm.appId != null"\r\n                            ng-click="vm.appSettings();"\r\n                            title="{{ \'TemplatePicker.App\' | translate }}">\r\n                        <i class="eav-icon-settings"></i>\r\n                    </button>\r\n                    <button type="button" class="btn btn-default"\r\n                            ng-click="vm.appImport();"\r\n                            title="{{ \'TemplatePicker.Install\' | translate }}">\r\n                        <i class="eav-icon-plus"></i>\r\n                    </button>\r\n                    <button type="button" class="btn btn-default"\r\n                            ng-click="vm.appStore();"\r\n                            title="{{ \'TemplatePicker.Catalog\' | translate }}">\r\n                        <i class="eav-icon-cart-arrow-down"></i>\r\n                    </button>\r\n                    <button type="button" class="btn btn-default"\r\n                            ng-click="vm.manageApps();"\r\n                            title="{{ \'TemplatePicker.Zone\' | translate }}">\r\n                        <i class="eav-icon-manage"></i>\r\n                    </button>\r\n                </span>\r\n                </span>\r\n            </div>\r\n\r\n            <!-- content type selector, only for content-mode -->\r\n            <select ng-show="vm.isContentApp" ng-model="vm.contentTypeId" class="input-lg" ng-options="c.StaticName as c.Label for c in vm.contentTypes | filter: { IsHidden : false } | orderBy: \'Label\'"\r\n                ng-disabled="vm.dashInfo.hasContent || vm.dashInfo.isList">\r\n            <option ng-disabled="vm.contentTypeId != \'\'" value="" translate="TemplatePicker.ContentTypePickerDefault"></option>\r\n        </select>\r\n            \r\n            <!-- view / template selector -->\r\n            <div>\r\n                <select ng-show="vm.isContentApp ? vm.contentTypeId != 0 : (vm.savedAppId != null)" x="( && vm.filteredTemplates().length > 1)"\r\n                    ng-disabled="vm.templateId && vm.filteredTemplates().length <= 1" class="input-lg pull-left" ng-model="vm.templateId"\r\n                    ng-options="t.TemplateId as t.Name for t in vm.filteredTemplates(vm.contentTypeId)"></select>\r\n\r\n                <button ng-show="vm.templateId != null && vm.savedTemplateId != vm.templateId" class="btn btn-primary" ng-click="vm.persistTemplate(false, false);"\r\n                    title="{{ \'TemplatePicker.Save\' | translate }}" type="button">\r\n                <i class="eav-icon-ok"></i>\r\n            </button>\r\n                <button ng-show="vm.undoTemplateId != null" class="btn btn-default" ng-click="vm.cancelTemplateChange();" type="button" title="{{ \'TemplatePicker.\' + (vm.isContentApp ? \'Cancel\' : \'Close\') | translate }}">\r\n                <i class="eav-icon-cancel"></i>\r\n            </button>\r\n            </div>\r\n        </div>\r\n    </ng-form>\r\n\r\n    <div class="sc-loading" ng-show="vm.loading">\r\n        <i class="eav-icon-spinner animate-spin"></i>\r\n    </div>\r\n\r\n    <!-- the auto-installer iframe, with spinner and everything -->\r\n    <div style="position: relative;" ng-if="vm.showRemoteInstaller">\r\n        <iframe id="frGettingStarted" ng-src="{{vm.remoteInstallerUrl}}" width="100%" height="300px"></iframe>\r\n        <div class="sc-loading" id="pnlLoading" ng-if="vm.progressIndicator.show">\r\n            <i class="eav-icon-spinner animate-spin"></i>\r\n            <br>\r\n            <br>\r\n            <span class="sc-loading-label">\r\n                installing <span id="packageName">{{vm.progressIndicator.label}}</span>\r\n            </span>\r\n        </div>\r\n    </div>\r\n</div>')}]);
//# sourceMappingURL=inpage-dialogs.min.js.map

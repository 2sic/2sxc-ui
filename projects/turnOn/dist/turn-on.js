(()=>{"use strict";var t={309:(t,n,r)=>{r.d(n,{sv:()=>N,vQ:()=>w,qb:()=>c,kf:()=>l,nr:()=>D,ef:()=>e,Vp:()=>o,cM:()=>u,kX:()=>i});var e="turn-on",o="turn-on-skip",i="window",s="turn-on: ";function u(t,n,r){window.debugTurnOn&&(r?console.log(s+t,n,r):n?console.log(s+t,n):console.log(s+t))}var a,c=function(t,n,r,e,o){void 0===e&&(e="not set"),this.type=t,this.ready=n,this.message=r,this.name=e,this.result=o,this.attempts=0},f=(a=function(t,n){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)},function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}a(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}),l=function(t){function n(n){var r=this;n||(n=[]);var e=function(t){return!!Array.isArray(t)&&t.filter((function(t){return t.ready})).length==t.length}(n),o=0===n.length?"no conditions provided":e?"all ok":"some conditions did not complete";return(r=t.call(this,"summary",e,o,"Summary")||this).details=n,r}return f(n,t),n}(c),h="window-key";function p(t){return t?t===i?function(){return new c(h,!0,"no keys except maybe windows found",t)}:function(){var n=v.test(t);return n.success?new c(h,!0,"all keys matched",t,n.result):new c(h,!1,"Not all keys matched yet. So far '"+n.matchedKey+"' worked.",t)}:function(){return new c(h,!0,"empty key",t)}}function g(t){var n=t.toString();return n&&n.length>25&&(n=n.substr(0,25)),function(){return new c("fn",t(),"",n)}}var d=function(){return(d=Object.assign||function(t){for(var n,r=1,e=arguments.length;r<e;r++)for(var o in n=arguments[r])Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o]);return t}).apply(this,arguments)},y="named fn",w=function(){function t(){}return t.prototype.make=function(t){return"function"==typeof t?g(t):"string"==typeof t?t.endsWith("()")?function(t){if(!t.endsWith("()"))throw"Tried to create Function-Name condition but that requires it to end with (), got "+t;var n,r=p(t.substring(0,t.length-2));return function(){if(!n){var t=r();if(!t.ready)return d(d({},t),{type:y});if("function"!=typeof t.result)return d(d({},t),{type:y});n=g(t.result)}return d(d({},n()),{type:y})}}(t):p(t):void 0},t}(),v=function(){function t(t,n,r,e,o){this.success=t,this.result=n,this.parts=r,this.partsFound=e,this.matchedKey=o}return t.test=function(n){if(!n)return new t(!0,null,0,0);var r=n.split(".");if(r[0]!==i)throw"Key must start with '"+i+".' but it's '"+n+"'";if(1==r.length)return new t(!0,null,1,1);for(var e=window,o=i,s=1;s<r.length;s++){var u=r[s];if(o+="."+u,!(e=e[u]))return new t(!1,null,r.length,s,o)}return new t(!0,e,r.length,r.length)},t}(),m="9-error",b=function(){function t(t,n,r){this.tag=t,this.config=n,this.turnOn=r,this.syncDom()}return t.prototype.syncDom=function(){u("syncDom",this);var t=this.tag;t.getAttribute(o)||t.setAttribute(o,"skip");var n=JSON.stringify(this.config);t.getAttribute(e)!==n&&t.setAttribute(e,n)},t.prototype.progress=function(t){this.config.progress=t,this.syncDom()},t.prototype.error=function(t){throw this.config.progress=m,this.config.error=t,this.syncDom(),this.config.error},t}(),O="error",k="debug",j="reject",E="turnOn",P=function(){this.interval=100,this.attempts=100,this.log=O,this.failure=j,this.name=E},A=function(){return(A=Object.assign||function(t){for(var n,r=1,e=arguments.length;r<e;r++)for(var o in n=arguments[r])Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o]);return t}).apply(this,arguments)},T=function(){function t(){}return t.createError=function(t){return{await:[],debug:!1,run:"",progress:m,error:t}},t.load=function(n){var r,e;try{r=JSON.parse(n)}catch(n){return t.createError("detected configuration but cannot parse to json.")}try{e=t.stabilize(r)}catch(n){return t.createError("Error loading configuration, reason unknown.")}return e},t.stabilize=function(n){var r,e;if(!n)return t.createError("No config data found to process");if(!n.run)return t.createError("Config didn't contain 'run' - it's required.");if(!n.run.startsWith("window"))return t.createError("run command must start with 'window.' but is:"+n.run);if(!n.run.endsWith("()"))return t.createError("run must be a function name and end with () but it's:"+n.run);var o=Array.isArray(n.await)?n.await:n.await?[n.await]:[];o.push(n.run.substring(0,n.run.length-2));var i=null!==(r=null==n?void 0:n.debug)&&void 0!==r&&r?k:O;return{await:o,debug:null!==(e=n.debug)&&void 0!==e&&e,run:n.run,progress:"1-loaded",data:n.data||{},settings:A(A(A({},new P),{log:i}),n.settings)}},t}(),S=function(){function t(t){this.root=t,this.tags=new Array}return t.prototype.tryToLoadTag=function(t){var n,r,i=null===(n=null==t?void 0:t.getAttribute)||void 0===n?void 0:n.call(t,e);if(i){var s=null===(r=null==t?void 0:t.getAttribute)||void 0===r?void 0:r.call(t,o);if(u("skip",s),s)return u("skip");u("attr",i);var a=T.load(i);a.progress!==m?(u("stable config"),this.add(t,a)):console.error(a.error,t,i)}},t.prototype.add=function(t,n){u("add",t,n);var r=new b(t,n);this.tags.push(r),function(t,n){var r=n.config;u("convert to turnon");var e=t.new(r.settings);r.settings=e.settings;var o=e.await(r.await);n.progress("2-watching"),o.then((function(){var t=r.run;if(u("turn on success - will try to run "+t),n.progress("3-running"),t.endsWith("()")){var e=v.test(t.substr(0,t.length-2));e.success?"function"==typeof e.result?((0,e.result)(x(x({},r),{tag:n})),n.progress("4-completed")):n.error("Got "+e.partsFound+" but it's not a function"):n.error("Tried to find object parts for "+e.matchedKey+" but didn't get anything.")}else n.error("run should end with () but doesn't - can't continue")}))}(this.root,r)},t.prototype.updateTags=function(){u("updateTags: "+this.tags.length),this.tags.forEach((function(t){return t.syncDom()}))},t}(),x=function(){return(x=Object.assign||function(t){for(var n,r=1,e=arguments.length;r<e;r++)for(var o in n=arguments[r])Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o]);return t}).apply(this,arguments)};console.log("hello!");var _={attributes:!1,childList:!0,subtree:!0},D=function(){function t(t){this.tagManager=t,this.scanExistingDom()}return t.prototype.scanExistingDom=function(){var t=this;u("scanExistingDom");var n=document.querySelectorAll("[turn-on]");u("tags:",n),n.forEach((function(n){return t.tagManager.tryToLoadTag(n)}))},t.prototype.activateObserver=function(){var t=this;u("load"),new MutationObserver((function(n){u("turnOn mutation"),n.forEach((function(n){"childList"==n.type&&(u("hit children"),n.addedNodes.forEach((function(n){return t.tagManager.tryToLoadTag(n)})))}))})).observe(document.documentElement,_)},t}(),M=function(){return(M=Object.assign||function(t){for(var n,r=1,e=arguments.length;r<e;r++)for(var o in n=arguments[r])Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o]);return t}).apply(this,arguments)},L="promise",N=function(){function t(t,n){this.lastStatus=new c(L,!1,"condition not checked yet"),this.attempts=0,this.innerCheck=t,this.settings=n}return t.prototype.innerCheck=function(){return new c(L,!0,"no condition defined")},t.prototype.check=function(){return!0===this.lastStatus.ready||(this.lastStatus=this.innerCheck()),this.lastStatus},t.prototype.asPromise=function(){var t=this,n=function(r,e){var o=t.check();!0!==o.ready?t.attempts++>=t.settings.attempts?r(M(M({},o),{message:"tried up to max attempts: "+o.message,attempts:t.attempts})):setTimeout(n,t.settings.interval,r,e):r(M(M({},o),{attempts:t.attempts}))};return new Promise(n)},t}(),C=function(){return(C=Object.assign||function(t){for(var n,r=1,e=arguments.length;r<e;r++)for(var o in n=arguments[r])Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o]);return t}).apply(this,arguments)},W=function(){function t(n){this.settings=new P,this._conditionMaker=new w,"string"==typeof n&&(n={name:n}),n&&(this.settings=C(C({},this.settings),n)),t.count++}return t.prototype.new=function(n){return new t(n)},t.prototype.await=function(n){var r=this,e=(Array.isArray(n)?n:[n]).map((function(t){if(Promise.resolve(t)===t)return n=t,new Promise((function(t,r){n.then((function(n){t(new c("bool-promise",!1!==n,"from promise"))})).catch((function(t){return r(t)}))}));var n,e=r._conditionMaker.make(t);return new N(e,r.settings).asPromise()})),o=this,i=t.count;return new Promise((function(t,n){Promise.all(e).then((function(r){var e=new l(r);if((window.debugTurnOn||o.settings.log===k||!e.ready&&"silent"!==o.settings.log)&&o.logStatusList(e.ready,i,o.settings,r),!0!==e.ready)switch(o.settings.failure){case j:n(e);break;case"resolve":t(e);break;case"silent":return}else t(new l(r))}))}))},t.prototype.logStatusList=function(t,n,r,e){console.log("turn-on: #"+n+" "+(r.name!==E?'"'+r.name+'" ':"")+(t?"success!":"couldn't complete because some conditions were not met. See details: "),e)},t.count=0,t}(),q=function(){function t(){this.tagManager=new S(this),this.loader=new D(this.tagManager),console.log("turnOn v0.1 active - it will help boot scripts when ready - set window.debugTurnOn = true for debugging")}return t.prototype.new=function(t){return new W(t)},t}();window.turnOn||(window.turnOn=new q),window.turnOn.loader.activateObserver()}},n={};function r(e){if(n[e])return n[e].exports;var o=n[e]={exports:{}};return t[e](o,o.exports,r),o.exports}r.d=(t,n)=>{for(var e in n)r.o(n,e)&&!r.o(t,e)&&Object.defineProperty(t,e,{enumerable:!0,get:n[e]})},r.o=(t,n)=>Object.prototype.hasOwnProperty.call(t,n),r(309)})();
//# sourceMappingURL=turn-on.js.map
var __extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])};return function(e,o){function r(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r)}}(),ToSic;!function(t){var e;!function(t){var e=function(){function t(t,e,o){this.controller=t,this.id=e,this.cbid=o}return t.prototype.get=function(t,e,o,r){this.request(t,e,o,r,"GET")},t.prototype.post=function(t,e,o,r){this.request(t,e,o,r,"POST")},t.prototype["delete"]=function(t,e,o,r){this.request(t,e,o,r,"DELETE")},t.prototype.put=function(t,e,o,r){this.request(t,e,o,r,"PUT")},t.prototype.request=function(t,e,o,r,n){if("object"!=typeof e&&"undefined"!=typeof e&&(e={id:e}),"string"==typeof t){var i=t.split("/"),a=i[0],c=i[1];""!==a&&""!==c||alert("Error: controller or action not defined. Will continue with likely errors."),t={controller:a,action:c,params:e,data:o,url:i.length>2?t:null,preventAutoFail:r}}var s={method:null===n?"POST":n,params:null,preventAutoFail:!1};t=$.extend({},s,t);var l=$.ServicesFramework(this.id),u=$.ajax({type:t.method,dataType:t.dataType||"json",async:!0,data:JSON.stringify(t.data),contentType:"application/json",url:this.getActionUrl(t),beforeSend:function(t){t.setRequestHeader("ContentBlockId",this.cbid),l.setModuleHeaders(t)}});return t.preventAutoFail||u.fail(this.controller.showDetailedHttpError),u},t.prototype.getActionUrl=function(t){var e=$.ServicesFramework(this.id),o=t.url?this.controller.resolveServiceUrl(t.url):e.getServiceRoot("2sxc")+"app/auto/api/"+t.controller+"/"+t.action;return o+(null===t.params?"":"?"+$.param(t.params))},t}();t.SxcWebApiWithInternals=e}(e=t.Sxc||(t.Sxc={}))}(ToSic||(ToSic={}));var ToSic;!function(t){var e;!function(t){var e=function(){function t(t){this.controller=t,this.source=void 0,this["in"]={},this.List=[]}return t.prototype.sourceUrl=function(t){var e=this.controller.resolveServiceUrl("app-sys/appcontent/GetContentBlockData");return"string"==typeof t&&(e+="&"+t),e},t.prototype.load=function(t){var e=this;return t&&t.List?this.controller.data:(t||(t={}),t.url||(t.url=this.controller.data.sourceUrl()),t.origSuccess=t.success,t.success=function(o){for(var r in o)o.hasOwnProperty(r)&&null!==o[r].List&&(e.controller.data["in"][r]=o[r],e.controller.data["in"][r].name=r);e.controller.data["in"].Default&&(e.List=e["in"].Default.List),t.origSuccess&&t.origSuccess(e),e.controller.isLoaded=!0,e.controller.lastRefresh=new Date,e._triggerLoaded()},t.error=function(t){alert(t.statusText)},t.preventAutoFail=!0,this.source=t,this.reload())},t.prototype.reload=function(){return this.controller.webApi.get(this.source).then(this.source.success,this.source.error),this},t.prototype.on=function(t,e){return $(this).bind("2scLoad",e)[0]._triggerLoaded()},t.prototype._triggerLoaded=function(){return this.controller.isLoaded?$(this).trigger("2scLoad",[this])[0]:this},t.prototype.one=function(t,e){return this.controller.isLoaded?(e({},this),this):$(this).one("2scLoad",e)[0]},t}();t.SxcDataWithInternals=e}(e=t.Sxc||(t.Sxc={}))}(ToSic||(ToSic={}));var ToSic;!function(t){var e;!function(e){var o=function(){function e(e,o,r){this.id=e,this.cbid=o,this.dnnSf=r,this.serviceScopes=["app","app-sys","app-api","app-query","app-content","eav","view","dnn"],this.serviceRoot=r(e).getServiceRoot("2sxc"),this.webApi=new t.Sxc.SxcWebApiWithInternals(this,e,o)}return e.prototype.resolveServiceUrl=function(t){var e=t.split("/")[0].toLowerCase();return-1===this.serviceScopes.indexOf(e)?t:this.serviceRoot+e+"/"+t.substring(t.indexOf("/")+1)},e.prototype.showDetailedHttpError=function(t){if(window.console&&console.log(t),404===t.status&&t.config&&t.config.url&&t.config.url.indexOf("/dist/i18n/")>-1)return window.console&&console.log("just fyi: failed to load language resource; will have to use default"),t;if(0===t.status||-1===t.status)return t;var e="Had an error talking to the server (status "+t.status+").",o=t.responseText?JSON.parse(t.responseText):t.data;if(o){var r=o.Message;r&&(e+="\nMessage: "+r);var n=o.MessageDetail||o.ExceptionMessage;n&&(e+="\nDetail: "+n),n&&0===n.indexOf("No action was found")&&(n.indexOf("that matches the name")>0?e+="\n\nTip from 2sxc: you probably got the action-name wrong in your JS.":n.indexOf("that matches the request.")>0&&(e+="\n\nTip from 2sxc: Seems like the parameters are the wrong amount or type.")),r&&0===r.indexOf("Controller")&&r.indexOf("not found")>0&&(e+="\n\nTip from 2sxc: you probably spelled the controller name wrong or forgot to remove the word 'controller' from the call in JS. To call a controller called 'DemoController' only use 'Demo'.")}return e+="\n\nif you are an advanced user you can learn more about what went wrong - discover how on 2sxc.org/help?tag=debug",alert(e),t},e}();e.SxcInstance=o;var r=function(t){function e(e,o,r,n){var i=t.call(this,e,o,n)||this;i.id=e,i.cbid=o,i.$2sxc=r,i.dnnSf=n,i.manage=null;try{r._manage&&r._manage.initInstance(i)}catch(a){throw a}return r._translateInit&&i.manage&&r._translateInit(i.manage),i}return __extends(e,t),e.prototype.isEditMode=function(){return this.manage&&this.manage._isEditMode()},e}(o);e.SxcInstanceWithEditing=r;var n=function(t){function o(o,r,n,i,a){var c=t.call(this,o,r,i,a)||this;return c.id=o,c.cbid=r,c.cacheKey=n,c.$2sxc=i,c.dnnSf=a,c.source=null,c.isLoaded=!1,c.lastRefresh=null,c.data=new e.SxcDataWithInternals(c),c}return __extends(o,t),o.prototype.recreate=function(t){return t&&delete this.$2sxc._controllers[this.cacheKey],this.$2sxc(this.id,this.cbid)},o}(r);e.SxcInstanceWithInternals=n}(e=t.Sxc||(t.Sxc={}))}(ToSic||(ToSic={}));var ToSic;!function(t){var e;!function(e){function o(e,o){var r=window.$2sxc;if(!r._controllers)throw"$2sxc not initialized yet";if("object"==typeof e){var i=n(e);e=i[0],o=i[1]}o||(o=e);var a=e+":"+o;return r._controllers[a]?r._controllers[a]:(r._data[a]||(r._data[a]={}),r._controllers[a]=new t.Sxc.SxcInstanceWithInternals(e,o,a,r,$.ServicesFramework))}function r(){var e=new t.Sxc.UrlParamManager,r={load:"true"===e.get("debug"),uncache:e.get("sxcver")},n={_controllers:{},sysinfo:{version:"09.05.00",description:"The 2sxc Controller object - read more about it on 2sxc.org"},beta:{},_data:{},totalPopup:new t.Sxc.TotalPopup,urlParams:e,debug:r,parts:{getUrl:function(t,e){var o=e||!r.load?t:t.replace(".min","");return r.uncache&&-1===o.indexOf("sxcver")&&(o=o+(-1===o.indexOf("?")?"?":"&")+"sxcver="+r.uncache),o}}};for(var i in n)n.hasOwnProperty(i)&&(o[i]=n[i]);return o}function n(t){var e=$(t).closest(".sc-content-block")[0];if(!e)return null;var o=e.getAttribute("data-cb-instance"),r=e.getAttribute("data-cb-id");return o&&r?[o,r]:null}e.SxcController=o,e.buildSxcController=r}(e=t.Sxc||(t.Sxc={}))}(ToSic||(ToSic={}));var ToSic;!function(t){var e;!function(t){var e=function(){function t(){this.frame=void 0,this.callback=void 0}return t.prototype.open=function(t,e){for(var o=10000010,r=window;r!==window.top&&10000100>o;)o++,r=r.parent;var n=document.createElement("div");n.setAttribute("style"," top: 0;left: 0;width: 100%;height: 100%; position:fixed; z-index:"+o),document.body.appendChild(n);var i=document.createElement("iframe");i.setAttribute("allowtransparency","true"),i.setAttribute("style","top: 0;left: 0;width: 100%;height: 100%;"),i.setAttribute("src",t),n.appendChild(i),document.body.className+=" sxc-popup-open",this.frame=i,this.callback=e},t.prototype.close=function(){if(this.frame){document.body.className=document.body.className.replace("sxc-popup-open","");var t=this.frame;t.parentNode.parentNode.removeChild(t.parentNode),this.callback()}},t.prototype.closeThis=function(){window.parent.$2sxc.totalPopup.close()},t}();t.TotalPopup=e}(e=t.Sxc||(t.Sxc={}))}(ToSic||(ToSic={}));var ToSic;!function(t){var e;!function(t){var e=function(){function t(){}return t.prototype.get=function(t){t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var e,o=new RegExp("[\\?&]"+t+"=([^&#]*)","i"),r=o.exec(location.search);if(null===r){var n=new RegExp("[#&]"+t+"=([^&#]*)","i");r=n.exec(location.hash)}if(null===r){var i=window.location.pathname.match(new RegExp("/"+t+"/([^/]+)","i"));i&&i.length>1&&(e=i.reverse()[0])}else e=r[1];return null===e||void 0===e?"":decodeURIComponent(e.replace(/\+/g," "))},t.prototype.require=function(t){var e=this.get(t);if(""===e){var o="Required parameter ("+t+") missing from url - cannot continue";throw alert(o),o}return e},t}();t.UrlParamManager=e}(e=t.Sxc||(t.Sxc={}))}(ToSic||(ToSic={})),window.$2sxc||(window.$2sxc=ToSic.Sxc.buildSxcController());
//# sourceMappingURL=2sxc.api.min.js.map

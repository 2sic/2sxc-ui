!function(){window.$2sxc||(window.$2sxc=function(e,t){if("object"==typeof e)return window.$2sxc.autoFind(e);t||(t=e);var a=e+":"+t;if($2sxc._controllers[a])return $2sxc._controllers[a];$2sxc._data[a]||($2sxc._data[a]={});var r=$2sxc._controllers[a]={serviceScopes:["app","app-api","app-query","app-content","eav","view","dnn"],serviceRoot:$.ServicesFramework(e).getServiceRoot("2sxc"),resolveServiceUrl:function(e){var t=e.split("/")[0].toLowerCase();return-1===r.serviceScopes.indexOf(t)?e:r.serviceRoot+t+"/"+e.substring(e.indexOf("/")+1)},data:{sourceUrl:function(e){var t=r.resolveServiceUrl("app/appcontent/GetContentBlockData");return"string"==typeof e&&(t+="&"+e),t},"in":{},List:[],controller:null,load:function(e){return e&&e.List?(r.data.setData(e),r.data):(e||(e={}),e.url||(e.url=r.data.sourceUrl()),e.origSuccess=e.success,e.success=function(t){for(var a in t)t.hasOwnProperty(a)&&null!==t[a].List&&(r.data["in"][a]=t[a],r.data["in"][a].name=a);r.data["in"].Default&&(r.List=r.data["in"].Default.List),e.origSuccess&&e.origSuccess(r.data),r.isLoaded=!0,r.lastRefresh=new Date,r.data._triggerLoaded()},e.error=function(e){alert(e.statusText)},e.preventAutoFail=!0,r.data.source=e,r.data.reload())},reload:function(){return r.webApi.get(r.data.source).then(r.data.source.success,r.data.source.error),r.data},on:function(e,t){return $(r.data).bind("2scLoad",t)[0]._triggerLoaded()},_triggerLoaded:function(){return r.isLoaded?$(r.data).trigger("2scLoad",[r.data])[0]:r.data},one:function(e,t){return r.isLoaded?(t({},r.data),r.data):$(r.data).one("2scLoad",t)[0]}},id:e,cbid:t,cacheKey:a,source:null,isLoaded:!1,lastRefresh:null,manage:null,isEditMode:function(){return r.manage&&r.manage._isEditMode()},recreate:function(){return delete $2sxc._controllers[a],$2sxc(r.id,r.cbid)},webApi:{get:function(e,t,a,n){return r.webApi._action(e,t,a,n,"GET")},post:function(e,t,a,n){return r.webApi._action(e,t,a,n,"POST")},"delete":function(e,t,a,n){return r.webApi._action(e,t,a,n,"DELETE")},put:function(e,t,a,n){return r.webApi._action(e,t,a,n,"PUT")},_action:function(a,n,o,c,s){if("object"!=typeof n&&"undefined"!=typeof n&&(n={id:n}),"string"==typeof a){var i=a.split("/"),l=i[0],u=i[1];""!==l&&""!==u||alert("Error: controller or action not defined. Will continue with likely errors."),a={controller:l,action:u,params:n,data:o,url:i.length>2?a:null,preventAutoFail:c}}var d={method:null===s?"POST":s,params:null,preventAutoFail:!1};a=$.extend({},d,a);var p=$.ServicesFramework(e),f=$.ajax({type:a.method,dataType:a.dataType||"json",async:!0,data:JSON.stringify(a.data),contentType:"application/json",url:r.webApi.getActionUrl(a),beforeSend:function(e){e.setRequestHeader("ContentBlockId",t),p.setModuleHeaders(e)}});return a.preventAutoFail||f.fail(r.showDetailedHttpError),f},getActionUrl:function(t){var a=$.ServicesFramework(e),n=t.url?r.resolveServiceUrl(t.url):a.getServiceRoot("2sxc")+"app-api/"+t.controller+"/"+t.action;return n+(null===t.params?"":"?"+$.param(t.params))}},showDetailedHttpError:function(e){if(window.console&&console.log(e),404===e.status&&e.config&&e.config.url&&e.config.url.indexOf("/dist/i18n/")>-1)return window.console&&console.log("just fyi: failed to load language resource; will have to use default"),e;if(0===e.status||-1===e.status)return e;var t="Had an error talking to the server (status "+e.status+").",a=e.responseText?JSON.parse(e.responseText):e.data;if(a){var r=a.Message;r&&(t+="\nMessage: "+r);var n=a.MessageDetail||a.ExceptionMessage;n&&(t+="\nDetail: "+n),n&&0===n.indexOf("No action was found")&&(n.indexOf("that matches the name")>0?t+="\n\nTip from 2sxc: you probably got the action-name wrong in your JS.":n.indexOf("that matches the request.")>0&&(t+="\n\nTip from 2sxc: Seems like the parameters are the wrong amount or type.")),r&&0===r.indexOf("Controller")&&r.indexOf("not found")>0&&(t+="\n\nTip from 2sxc: you probably spelled the controller name wrong or forgot to remove the word 'controller' from the call in JS. To call a controller called 'DemoController' only use 'Demo'.")}return t+="\n\nif you are an advanced user you can learn more about what went wrong - discover how on 2sxc.org/help?tag=debug",alert(t),e}};try{r.manage=null,$2sxc._manage&&$2sxc._manage.attach(r)}catch(n){throw n}return $2sxc._translateInit&&r.manage&&$2sxc._translateInit(r.manage),r.data.controller=r,r},$2sxc._controllers={},$2sxc.name="The 2sxc Controller object",$2sxc.beta={},$2sxc._data={},$2sxc.totalPopup={open:function(e,t){for(var a=1500,r=window;r!==window.top&&1600>a;)a++,r=r.parent;var n=document.createElement("div");n.setAttribute("style"," top: 0;left: 0;width: 100%;height: 100%; position:fixed; z-index:"+a),document.body.appendChild(n);var o=document.createElement("iframe");o.setAttribute("allowtransparency","true"),o.setAttribute("style","top: 0;left: 0;width: 100%;height: 100%;"),o.setAttribute("src",e),n.appendChild(o),document.body.className+=" sxc-popup-open",$2sxc.totalPopup.frame=o,$2sxc.totalPopup.callback=t},close:function(){if($2sxc.totalPopup.frame){document.body.className=document.body.className.replace("sxc-popup-open","");var e=$2sxc.totalPopup.frame;e.parentNode.parentNode.removeChild(e.parentNode),$2sxc.totalPopup.callback()}},closeThis:function(){window.parent.$2sxc.totalPopup.close()}},$2sxc.urlParams={get:function(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"=([^&#]*)","i"),a=t.exec(location.search);if(null===a){var r=new RegExp("[#&]"+e+"=([^&#]*)","i");a=r.exec(location.hash)}if(null===a){var n=window.location.pathname.match(new RegExp("/"+e+"/([^/]+)","i"));n&&n.length>1&&(a=n.reverse()[0])}else a=a[1];return null===a||void 0===a?"":decodeURIComponent(a.replace(/\+/g," "))},require:function(e){var t=$2sxc.urlParams.get(e);if(""===t){var a="Required parameter ("+e+") missing from url - cannot continue";throw alert(a),a}return t}},$2sxc.debug={load:"true"===$2sxc.urlParams.get("debug"),uncache:$2sxc.urlParams.get("sxcver")},$2sxc.parts={getUrl:function(e,t){var a=t||!$2sxc.debug.load?e:e.replace(".min","");return $2sxc.debug.uncache&&-1===a.indexOf("sxcver")&&(a=a+(-1===a.indexOf("?")?"?":"&")+"sxcver="+$2sxc.debug.uncache),a}},$2sxc.autoFind=function(e){var t=$(e).closest(".sc-content-block")[0];if(!t)return null;var a=t.getAttribute("data-cb-instance"),r=t.getAttribute("data-cb-id");return a&&r?$2sxc(a,r):null},$2sxc.system={finishUpgrade:function(e){var t=$2sxc(e);$.ajax({type:"get",url:t.resolveServiceUrl("view/module/finishinstallation"),beforeSend:$.ServicesFramework(t.id).setModuleHeaders}).success(function(){alert("Upgrade ok, restarting the CMS and reloading..."),location.reload()}),alert("starting upgrade. This could take a few minutes. You'll see an 'ok' when it's done. Please wait...")}})}();
//# sourceMappingURL=2sxc.api.min.js.map

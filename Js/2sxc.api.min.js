var __extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function o(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}(),ToSic;!function(t){var e;!function(t){function e(e,r){var n=window.$2sxc;if(!n._controllers)throw"$2sxc not initialized yet";if("object"==typeof e){var i=o(e);e=i[0],r=i[1]}r||(r=e);var a=e+":"+r;return n._controllers[a]?n._controllers[a]:(n._data[a]||(n._data[a]={}),n._controllers[a]=new t.SxcInstanceWithInternals(e,r,a,n,$.ServicesFramework))}function r(){var r=new t.UrlParamManager,o={load:"true"===r.get("debug"),uncache:r.get("sxcver")},n={_controllers:{},sysinfo:{version:"09.05.02",description:"The 2sxc Controller object - read more about it on 2sxc.org"},beta:{},_data:{},totalPopup:new t.TotalPopup,urlParams:r,debug:o,parts:{getUrl:function(t,e){var r=e||!o.load?t:t.replace(".min","");return o.uncache&&-1===r.indexOf("sxcver")&&(r=r+(-1===r.indexOf("?")?"?":"&")+"sxcver="+o.uncache),r}}};for(var i in n)n.hasOwnProperty(i)&&(e[i]=n[i]);return e}function o(t){var e=$(t).closest(".sc-content-block")[0];if(!e)return null;var r=e.getAttribute("data-cb-instance"),o=e.getAttribute("data-cb-id");return r&&o?[r,o]:null}t.buildSxcController=r}(e=t.Sxc||(t.Sxc={}))}(ToSic||(ToSic={}));var ToSic;!function(t){var e;!function(t){var e=function(){function t(t){this.controller=t,this.source=void 0,this["in"]={},this.List=[]}return t.prototype.sourceUrl=function(t){var e=this.controller.resolveServiceUrl("app-sys/appcontent/GetContentBlockData");return"string"==typeof t&&(e+="&"+t),e},t.prototype.load=function(t){var e=this;return t&&t.List?this.controller.data:(t||(t={}),t.url||(t.url=this.controller.data.sourceUrl()),t.origSuccess=t.success,t.success=function(r){for(var o in r)r.hasOwnProperty(o)&&null!==r[o].List&&(e.controller.data["in"][o]=r[o],e.controller.data["in"][o].name=o);e.controller.data["in"].Default&&(e.List=e["in"].Default.List),t.origSuccess&&t.origSuccess(e),e.controller.isLoaded=!0,e.controller.lastRefresh=new Date,e._triggerLoaded()},t.error=function(t){alert(t.statusText)},t.preventAutoFail=!0,this.source=t,this.reload())},t.prototype.reload=function(){return this.controller.webApi.get(this.source).then(this.source.success,this.source.error),this},t.prototype.on=function(t,e){return $(this).bind("2scLoad",e)[0]._triggerLoaded()},t.prototype._triggerLoaded=function(){return this.controller.isLoaded?$(this).trigger("2scLoad",[this])[0]:this},t.prototype.one=function(t,e){return this.controller.isLoaded?(e({},this),this):$(this).one("2scLoad",e)[0]},t}();t.SxcDataWithInternals=e}(e=t.Sxc||(t.Sxc={}))}(ToSic||(ToSic={}));var ToSic;!function(t){var e;!function(t){var e=function(){function e(e,r,o){this.id=e,this.cbid=r,this.dnnSf=o,this.serviceScopes=["app","app-sys","app-api","app-query","app-content","eav","view","dnn"],this.serviceRoot=o(e).getServiceRoot("2sxc"),this.webApi=new t.SxcWebApiWithInternals(this,e,r)}return e.prototype.resolveServiceUrl=function(t){var e=t.split("/")[0].toLowerCase();return-1===this.serviceScopes.indexOf(e)?t:this.serviceRoot+e+"/"+t.substring(t.indexOf("/")+1)},e.prototype.showDetailedHttpError=function(t){if(window.console&&console.log(t),404===t.status&&t.config&&t.config.url&&t.config.url.indexOf("/dist/i18n/")>-1)return window.console&&console.log("just fyi: failed to load language resource; will have to use default"),t;if(0===t.status||-1===t.status)return t;var e="Had an error talking to the server (status "+t.status+").",r=t.responseText?JSON.parse(t.responseText):t.data;if(r){var o=r.Message;o&&(e+="\nMessage: "+o);var n=r.MessageDetail||r.ExceptionMessage;n&&(e+="\nDetail: "+n),n&&0===n.indexOf("No action was found")&&(n.indexOf("that matches the name")>0?e+="\n\nTip from 2sxc: you probably got the action-name wrong in your JS.":n.indexOf("that matches the request.")>0&&(e+="\n\nTip from 2sxc: Seems like the parameters are the wrong amount or type.")),o&&0===o.indexOf("Controller")&&o.indexOf("not found")>0&&(e+="\n\nTip from 2sxc: you probably spelled the controller name wrong or forgot to remove the word 'controller' from the call in JS. To call a controller called 'DemoController' only use 'Demo'.")}return e+="\n\nif you are an advanced user you can learn more about what went wrong - discover how on 2sxc.org/help?tag=debug",alert(e),t},e}();t.SxcInstance=e;var r=function(t){function e(e,r,o,n){var i=t.call(this,e,r,n)||this;i.id=e,i.cbid=r,i.$2sxc=o,i.dnnSf=n,i.manage=null;try{o._manage&&o._manage.initInstance(i)}catch(a){throw a}return o._translateInit&&i.manage&&o._translateInit(i.manage),i}return __extends(e,t),e.prototype.isEditMode=function(){return this.manage&&this.manage._isEditMode()},e}(e);t.SxcInstanceWithEditing=r;var o=function(e){function r(r,o,n,i,a){var c=e.call(this,r,o,i,a)||this;return c.id=r,c.cbid=o,c.cacheKey=n,c.$2sxc=i,c.dnnSf=a,c.source=null,c.isLoaded=!1,c.lastRefresh=null,c.data=new t.SxcDataWithInternals(c),c}return __extends(r,e),r.prototype.recreate=function(t){return t&&delete this.$2sxc._controllers[this.cacheKey],this.$2sxc(this.id,this.cbid)},r}(r);t.SxcInstanceWithInternals=o}(e=t.Sxc||(t.Sxc={}))}(ToSic||(ToSic={}));var ToSic;!function(t){var e;!function(t){var e=function(){function t(){this.frame=void 0,this.callback=void 0}return t.prototype.open=function(t,e){for(var r=10000010,o=window;o!==window.top&&10000100>r;)r++,o=o.parent;var n=document.createElement("div");n.setAttribute("style"," top: 0;left: 0;width: 100%;height: 100%; position:fixed; z-index:"+r),document.body.appendChild(n);var i=document.createElement("iframe");i.setAttribute("allowtransparency","true"),i.setAttribute("style","top: 0;left: 0;width: 100%;height: 100%;"),i.setAttribute("src",t),n.appendChild(i),document.body.className+=" sxc-popup-open",this.frame=i,this.callback=e},t.prototype.close=function(){if(this.frame){document.body.className=document.body.className.replace("sxc-popup-open","");var t=this.frame;t.parentNode.parentNode.removeChild(t.parentNode),this.callback()}},t.prototype.closeThis=function(){window.parent.$2sxc.totalPopup.close()},t}();t.TotalPopup=e}(e=t.Sxc||(t.Sxc={}))}(ToSic||(ToSic={}));var ToSic;!function(t){var e;!function(t){var e=function(){function t(){}return t.prototype.get=function(t){t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var e,r=new RegExp("[\\?&]"+t+"=([^&#]*)","i"),o=r.exec(location.search);if(null===o){var n=new RegExp("[#&]"+t+"=([^&#]*)","i");o=n.exec(location.hash)}if(null===o){var i=window.location.pathname.match(new RegExp("/"+t+"/([^/]+)","i"));i&&i.length>1&&(e=i.reverse()[0])}else e=o[1];return null===e||void 0===e?"":decodeURIComponent(e.replace(/\+/g," "))},t.prototype.require=function(t){var e=this.get(t);if(""===e){var r="Required parameter ("+t+") missing from url - cannot continue";throw alert(r),r}return e},t}();t.UrlParamManager=e}(e=t.Sxc||(t.Sxc={}))}(ToSic||(ToSic={}));var ToSic;!function(t){var e;!function(t){var e=function(){function t(t,e,r){this.controller=t,this.id=e,this.cbid=r}return t.prototype.get=function(t,e,r,o){return this.request(t,e,r,o,"GET")},t.prototype.post=function(t,e,r,o){return this.request(t,e,r,o,"POST")},t.prototype["delete"]=function(t,e,r,o){return this.request(t,e,r,o,"DELETE")},t.prototype.put=function(t,e,r,o){return this.request(t,e,r,o,"PUT")},t.prototype.request=function(t,e,r,o,n){if("object"!=typeof e&&"undefined"!=typeof e&&(e={id:e}),"string"==typeof t){var i=t.split("/"),a=i[0],c=i[1];""!==a&&""!==c||alert("Error: controller or action not defined. Will continue with likely errors."),t={controller:a,action:c,params:e,data:r,url:i.length>2?t:null,preventAutoFail:o}}var s={method:null===n?"POST":n,params:null,preventAutoFail:!1};t=$.extend({},s,t);var l=$.ServicesFramework(this.id),u=$.ajax({type:t.method,dataType:t.dataType||"json",async:!0,data:JSON.stringify(t.data),contentType:"application/json",url:this.getActionUrl(t),beforeSend:function(t){t.setRequestHeader("ContentBlockId",this.cbid),l.setModuleHeaders(t)}});return t.preventAutoFail||u.fail(this.controller.showDetailedHttpError),u},t.prototype.getActionUrl=function(t){var e=$.ServicesFramework(this.id),r=t.url?this.controller.resolveServiceUrl(t.url):e.getServiceRoot("2sxc")+"app/auto/api/"+t.controller+"/"+t.action;return r+(null===t.params?"":"?"+$.param(t.params))},t}();t.SxcWebApiWithInternals=e}(e=t.Sxc||(t.Sxc={}))}(ToSic||(ToSic={})),window.$2sxc||(window.$2sxc=ToSic.Sxc.buildSxcController());
//# sourceMappingURL=2sxc.api.min.js.map
